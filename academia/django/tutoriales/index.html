<!DOCTYPE html>
<html lang="es" class="no-js">
  <head>
    
    
    
    

    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      <meta http-equiv="x-ua-compatible" content="ie=edge">
      
        <meta name="description" content="Recopilación de tutoriales interesantes sobre este framework web.">
      
      
        <link rel="canonical" href="https://docs.hektorprofe.net/academia/django/tutoriales/">
      
      
        <meta name="author" content="Héctor Costa Guzman">
      
      <link rel="shortcut icon" href="/favicon.ico">
    
    
      
        <title>Tutoriales | Django | Academia | Hektor Profe</title>
      
    
    <link rel="stylesheet" href="../../../assets/stylesheets/application.2.css">
    
      
        <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700|Roboto+Mono">
        <style>body,input{font-family:"Roboto","Helvetica Neue",Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono","Courier New",Courier,monospace}</style>
      
    
    
    <link rel="stylesheet" href="/assets/stylesheets/tingle.min.css">
<style>
@font-face{font-family:"Material Icons";font-style:normal;font-weight:400;src:local("Material Icons"),local("MaterialIcons-Regular"),url("/assets/fonts/specimen/MaterialIcons-Regular.woff2") format("woff2"),url("/assets/fonts/specimen/MaterialIcons-Regular.woff") format("woff"),url("/assets/fonts/specimen/MaterialIcons-Regular.ttf") format("truetype")}
[data-md-color-primary="grey"] .md-header { background-color: #191A1D }
[data-md-color-primary="grey"] .md-tabs { background-color: #222831 }
.md-footer-nav { background-color: #222831; }
.md-footer-meta { background-color: #191A1D }
html [data-md-color-primary="grey"] .md-nav--primary .md-nav__title--site { background-color: #191A1D; }
.mini{ display: none; } .maxi{ display: block; }
.embed-container { position: relative; padding-bottom: 56.25%;height: 0; overflow: hidden; max-width: 100%; height: auto; margin-bottom: 0; } 
.embed-container iframe, .embed-container object, .embed-container embed { position: absolute; top: 0; left: 0; width: 100%; height: 100%; }
.md-nav__link:focus, .md-nav__link:hover { color: #018dc5; }
.headerlink{ color: #018dc5 !important; }
.md-footer-links__highlight a{ color: #777 !important; }
.md-footer-links__highlight a:hover{ color: #ddd !important; }
.visible{ display: inherit !important; }
/*.md-tabs { display: none !important; }*/
.nav__btn, .nav__logo{ transition: 0.3s; }
.nav__btn:hover{ color: #aaa; }
.nav__logo:hover{ opacity:.7; }
.nav__logo {max-width: 225px !important; }
img:not([src]){visibility:hidden;}
img.click{opacity: 0.96;box-shadow:rgb(79, 82, 92) -4px 4px}
img.click:hover{opacity: 1;box-shadow:rgb(10, 172, 237) -4px 4px}
.button { background-color: #36bf2d; border: none; color: white !important; padding: 20px 0px; text-align: center; text-decoration: none; display: block; font-size: 97%; width: 100%; font-weight: bold;}
.button:hover { background-color: #4CAF50; color: white; }
.animated.delay-1dot5s {animation-delay: 1.5s;}
.md-icon--search { display:inline-block!important}
a.headerlink{ display: none !important; }
small.edited { display: block; text-align: right; }
#cookie-bar { padding: 1.8rem 1.25rem !important; background: #191A1D  !important; box-shadow:rgba(0, 0, 0, 0.2) 4px 4px 8px 8px; }
#cookie-bar-prompt-logo{ display: none !important; }
div.my-img{text-align:center;margin-top:20px}
@media (max-width: 76.1875em){ .mini{ display: block; } .maxi{ display: none;} /*.md-nav__link[for="nav-1"] { display: none; }*/ }
@media (min-width: 1599.9px){ .md-header-nav__button.md-logo img { height: 37.5px !important; width: 220px; } }
@media (min-width: 1999.9px){ .md-header-nav__button.md-logo img { height: 40px !important; width: 240px; } }
/* Rectificación footer en paginas pequeñas de altura */
@media (max-width: 1599.8px){ .md-container {height: calc(100% - 48px)} }
@media (min-width: 1599.9px){ .md-container {height: calc(100% - 53px)} }
@media (min-width: 1999.9px){ .md-container {height: calc(100% - 58px)} }
@media only screen and (max-width: 959.9px) { .nav__logo { display: block !important; }} 
@media only screen and (min-width: 960px) and (max-width: 76.1875em) { .nav__logo { display: block !important; }} 
@media only screen and (min-width: 76.1875em) { .nav__logo { display: none !important; } } 
@media only screen and (max-width: 76.1875em) { .md-sidebar--primary { left: -26.2rem;; width: 26.2rem; }  [data-md-toggle="drawer"]:checked ~ .md-container .md-sidebar--primary { -webkit-transform: translateX(26.2rem); transform: translateX(26.2rem); } [dir="rtl"] [data-md-toggle="drawer"]:checked ~ .md-container .md-sidebar--primary { -webkit-transform: translateX(-26.2rem); transform: translateX(-26.2rem); } }
@media (min-width: 1219.9px){ #home__btn { display: none !important; } #cursos__btn{ color: white !important; } [data-md-color-primary="grey"] .md-nav__link--active{ color: rgba(0, 0, 0, 0.87); text-decoration: underline !important; } }
@media (min-width: 467.9px){ #discord__btn{ display: inline-block !important; } }
@media only screen and (min-width: 60em){ .md-search__input { background-color: rgb(53, 54, 56); } .md-search__input:hover { background-color: rgb(84, 87, 93); color: white; }}
@media (max-width: 1219.9px){ .md-header-nav__title{ padding: 0 1rem; } .nav__btn {display:none;} }
@media (max-width: 875.9px){ #cookie-bar-button{ margin-top: 20px !important; }}
@media (max-width: 719.9px){ #cookie-bar { padding: 3.25rem 1.25rem; }}
@media (max-width: 512.9px){ #cookie-bar { padding: 2rem 1.25rem; }}

.tingle-modal { font-size:18px !important;}
.tingle-modal-box{ width: 80%; max-width: 1100px; }
.tingle-btn--danger{ background: darkorange !important; }
.tingle-modal-box__content { padding: 3rem 2rem 3rem 3rem;}
@media (max-width: 540px){ .tingle-modal-box{ width: auto; } }
@media (max-width: 849px){ #supermodal{ grid-template-columns:100% !important; }}

.md-sidebar--secondary .md-sidebar__scrollwrap {max-height: calc(100% - 275px - 60px)}
@media (max-width: 1999.9px){.md-sidebar--secondary .md-sidebar__scrollwrap {max-height: calc(100% - 246px - 60px);margin-right:-1px;}}
@media (max-width: 1599.9px){.md-sidebar--secondary .md-sidebar__scrollwrap {max-height: calc(100% - 222px - 60px)}}

</style>
  </head>
  
    
    
    <body dir="ltr" data-md-color-primary="grey" data-md-color-accent="grey">
  
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" data-md-component="overlay" for="__drawer"></label>
    
      <a href="#tutoriales-sobre-django" tabindex="1" class="md-skip">
        Saltar a contenido
      </a>
    
    
      <header
  class="md-header"
  data-md-component="header"
  style="position: inherit !important"
>
  <nav class="md-header-nav md-grid">
    <div class="md-flex">
      <div class="md-flex__cell md-flex__cell--shrink">
        <a
          href="/"
          title="Hektor Profe"
          class="md-header-nav__button md-logo"
          style="font-size: 0px"
        >
          <img
            src="/assets/images/logo.png"
            width="200px"
            height="35px"
            style="margin-top: -5px"
            alt="Hektor Profe"
            title="Hektor Profe"
          />
        </a>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        <label
          class="md-icon md-icon--menu md-header-nav__button"
          for="__drawer"
        ></label>
      </div>
      <div class="md-flex__cell md-flex__cell--stretch">
        <div
          class="md-flex__ellipsis md-header-nav__title"
          data-md-component="title"
          style="text-align: right"
        >
          <!-- https://fontawesome.com/v4.7.0/ -->
          <a 
            class="nav__btn" 
            href="https://www.hektorprofe.net/" 
            style="margin-left:0em;" 
            title="Cursos de Hektor Profe">
            Cursos
          </a>
          <a 
            class="nav__btn" 
            href="https://docs.hektorprofe.net/" 
            style="margin-left:1.4em;" 
            title="Documentos de Hektor Profe">
            Documentos
          </a>
          <a 
            class="nav__btn" 
            href="https://www.hektorprofe.net/videojuegos/" 
            style="margin-left:1.4em;" 
            title="Videojuegos de Hektor Profe">
            Videojuegos
          </a>
          <a href="/"
            ><img
              class="nav__logo"
              src="/assets/images/logo.png"
              width="200px"
              height="35px"
              style="margin: 6px auto 0"
              alt="Hektor Profe"
              title="Hektor Profe"
          /></a>
        </div>
        <style>
          .md-sidebar[data-md-state="lock"] {
            top: 0rem !important;
          }
          .md-tabs {
            display: none !important;
          }
          .hde {
            display: inline-block;
          }
          .admonition.note > .superfences-tabs > label:hover,
          .headerlink {
            color: #018dc5 !important;
          }
          .admonition.info {
            font-size: 100%;
          }
          .admonition.info label {
            font-size: 91%;
          }
          .admonition.note > .admonition-title {
            display: none;
          }
          .image {
            text-align: center;
            margin-top: 25px;
          }
          .contenedor_youtube {
            position: relative !important;
            padding-bottom: 56.25% !important; /*panorámico*/
            padding-top: 0px !important;
            height: 0 !important;
            margin-top: -20px;
            margin-bottom: 25px;
          }
          .contenedor_youtube iframe {
            position: absolute !important;
            top: 0 !important;
            left: 0 !important;
            width: 100% !important;
            height: 100% !important;
          }
        </style>
      </div>
    </div>
  </nav>
</header>
    
    <div class="md-container" style="padding-top: 0px !important;">
      
        
      
      
        

  

<nav class="md-tabs md-tabs--active" data-md-component="tabs">
    <div class="md-tabs__inner md-grid">
      <ul class="md-tabs__list" id="top__tabs">
        
          <li class="md-tabs__item"><a href="javascript://" class="md-tabs__link">&nbsp;</a></li>
        
          <li class="md-tabs__item"><a href="javascript://" class="md-tabs__link">&nbsp;</a></li>
        
          <li class="md-tabs__item"><a href="javascript://" class="md-tabs__link">&nbsp;</a></li>
        
          <li class="md-tabs__item"><a href="javascript://" class="md-tabs__link">&nbsp;</a></li>
        
          <li class="md-tabs__item"><a href="javascript://" class="md-tabs__link">&nbsp;</a></li>
        
          <li class="md-tabs__item"><a href="javascript://" class="md-tabs__link">&nbsp;</a></li>
        
          <li class="md-tabs__item"><a href="javascript://" class="md-tabs__link">&nbsp;</a></li>
        
          <li class="md-tabs__item"><a href="javascript://" class="md-tabs__link">&nbsp;</a></li>
        
          <li class="md-tabs__item"><a href="javascript://" class="md-tabs__link">&nbsp;</a></li>
        
          <li class="md-tabs__item"><a href="javascript://" class="md-tabs__link">&nbsp;</a></li>
        
      </ul>
    </div>
</nav>
      
      <main class="md-main">
        <div class="md-main__inner md-grid" data-md-component="container" style="padding-top: 8px !important;">
          
            
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
                <div class="md-sidebar__scrollwrap" id="md__sidebar__scroll">
                  <div class="md-sidebar__inner">
                    <nav class="md-nav md-nav--primary" data-md-level="0">
  <label class="md-nav__title" for="__drawer" style="padding:0 !important;max-height:5.5rem;"></label>
  
  <ul class="md-nav__list" id="main__list" data-md-scrollfix>
    
      
    
        <!-- comprobación extra -->
         
          
          
          

  


  <li class="md-nav__item md-nav__item--active md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-2" type="checkbox" id="nav-2" checked>
    
    <label class="md-nav__link" for="nav-2">
      Academia de programación
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-2">
        Academia de programación
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
            
            
            


  <li class="md-nav__item">
    <a href="../../" title="Índice del archivo" class="md-nav__link">
      Índice del archivo
    </a>
  </li>

        
            
            
            

  


  <li class="md-nav__item md-nav__item--active md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-2-2" type="checkbox" id="nav-2-2" checked>
    
    <label class="md-nav__link" for="nav-2-2">
      Lenguaje Python
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-2-2">
        Lenguaje Python
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
            
            
            


  <li class="md-nav__item">
    <a href="../../python/introduccion/" title="Introducción a Python" class="md-nav__link">
      Introducción a Python
    </a>
  </li>

        
            
            
            


  <li class="md-nav__item">
    <a href="../../python/poo-para-interfaces-graficas/" title="POO para interfaces gráficas" class="md-nav__link">
      POO para interfaces gráficas
    </a>
  </li>

        
            
            
            


  <li class="md-nav__item">
    <a href="../../python/proyecto-gestor-clientes/" title="Proyecto gestor de clientes" class="md-nav__link">
      Proyecto gestor de clientes
    </a>
  </li>

        
            
            
            


  <li class="md-nav__item">
    <a href="../../python/tutoriales/" title="Tutoriales sobre Python" class="md-nav__link">
      Tutoriales sobre Python
    </a>
  </li>

        
            
            
            


  <li class="md-nav__item">
    <a href="../../python/modulo-analitico-numpy/" title="Módulo analítico NumPy" class="md-nav__link">
      Módulo analítico NumPy
    </a>
  </li>

        
            
            
            


  <li class="md-nav__item">
    <a href="../../python/modulo-grafico-matplotlib/" title="Módulo gráfico Matplotlib" class="md-nav__link">
      Módulo gráfico Matplotlib
    </a>
  </li>

        
            
            
            


  <li class="md-nav__item">
    <a href="../introduccion/" title="Introducción a Django" class="md-nav__link">
      Introducción a Django
    </a>
  </li>

        
            
            
            


  <li class="md-nav__item">
    <a href="../api-rest-framework/" title="Proyecto API con DRF" class="md-nav__link">
      Proyecto API con DRF
    </a>
  </li>

        
            
            
            

  


  <li class="md-nav__item md-nav__item--active">
    
    <input class="md-toggle md-nav__toggle" data-md-toggle="toc" type="checkbox" id="__toc">
    
      
    
    
      <label class="md-nav__link md-nav__link--active" for="__toc">
        Tutoriales sobre Django
      </label>
    
    <a href="./" title="Tutoriales sobre Django" class="md-nav__link md-nav__link--active" id="md__active_link">
      Tutoriales sobre Django
    </a>
    
      
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">Tabla de contenidos</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#utilizar-django-en-entornos-virtuales-con-pipenv" title="Utilizar Django en entornos virtuales con Pipenv" class="md-nav__link toc__link">
    Utilizar Django en entornos virtuales con Pipenv
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#colorear-sintaxis-y-autocompletar-en-visual-studio-code" title="Colorear sintaxis y autocompletar en Visual Studio Code" class="md-nav__link toc__link">
    Colorear sintaxis y autocompletar en Visual Studio Code
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#filtrar-un-modelo-por-un-campo-utilizando-un-formulario" title="Filtrar un modelo por un campo utilizando un formulario" class="md-nav__link toc__link">
    Filtrar un modelo por un campo utilizando un formulario
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#crear-editar-y-borrar-instancias-de-modelos-con-formularios" title="Crear, editar y borrar instancias de modelos con formularios" class="md-nav__link toc__link">
    Crear, editar y borrar instancias de modelos con formularios
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#mostrar-graficos-generados-con-matplotlib-en-django" title="Mostrar gráficos generados con Matplotlib en Django" class="md-nav__link toc__link">
    Mostrar gráficos generados con Matplotlib en Django
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#implementar-sistema-clasico-de-registro-login-y-logout" title="Implementar sistema clásico de registro, login y logout" class="md-nav__link toc__link">
    Implementar sistema clásico de registro, login y logout
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#extender-el-usercreationform-para-registrarse-con-el-email" title="Extender el UserCreationForm para registrarse con el email" class="md-nav__link toc__link">
    Extender el UserCreationForm para registrarse con el email
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#django-en-ubuntu-server-con-nginx-gunicorn-y-supervisor" title="Django en Ubuntu Server con Nginx, Gunicorn y Supervisor" class="md-nav__link toc__link">
    Django en Ubuntu Server con Nginx, Gunicorn y Supervisor
  </a>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
    
  </li>

        
      </ul>
    </nav>
  </li>

        
            
            
            


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-2-3" type="checkbox" id="nav-2-3">
    
    <label class="md-nav__link" for="nav-2-3">
      Lenguaje JavaScript
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-2-3">
        Lenguaje JavaScript
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
            
            
            


  <li class="md-nav__item">
    <a href="../../javascript/introduccion/" title="Introducción a JavaScript" class="md-nav__link">
      Introducción a JavaScript
    </a>
  </li>

        
            
            
            


  <li class="md-nav__item">
    <a href="../../javascript/conversor-divisas/" title="Proyecto conversor vía API" class="md-nav__link">
      Proyecto conversor vía API
    </a>
  </li>

        
            
            
            


  <li class="md-nav__item">
    <a href="../../javascript/biblioteca-p5js/" title="Introducción a P5.js" class="md-nav__link">
      Introducción a P5.js
    </a>
  </li>

        
            
            
            


  <li class="md-nav__item">
    <a href="../../javascript/nodejs/" title="Introducción a Node.js" class="md-nav__link">
      Introducción a Node.js
    </a>
  </li>

        
            
            
            


  <li class="md-nav__item">
    <a href="../../javascript/chat-heroku/" title="Proyecto chat online" class="md-nav__link">
      Proyecto chat online
    </a>
  </li>

        
            
            
            


  <li class="md-nav__item">
    <a href="../../javascript/cliente-nuxt/" title="Proyecto cliente Nuxt.js" class="md-nav__link">
      Proyecto cliente Nuxt.js
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
            
            
            


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-2-4" type="checkbox" id="nav-2-4">
    
    <label class="md-nav__link" for="nav-2-4">
      GNU/Linux
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-2-4">
        GNU/Linux
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
            
            
            


  <li class="md-nav__item">
    <a href="../../gnu-linux/ubuntu-server-web/" title="Configurar Ubuntu Server" class="md-nav__link">
      Configurar Ubuntu Server
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
      </ul>
    </nav>
  </li>

        
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
  </ul>
</nav>

                  </div>
                </div>
              </div>
            

            
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
                
                  
                    <div class="course-offer" style="margin-bottom:25px;padding:0px 10px;">
                      <a href="https://www.hektorprofe.net/cupon/django" target="_blank">
                        <img src="/cdn/assets/django.png" style="width:100%;justify-self:center;align-self:center;"/>
                      </a>
                    </div>
                  
                

                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">Tabla de contenidos</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#utilizar-django-en-entornos-virtuales-con-pipenv" title="Utilizar Django en entornos virtuales con Pipenv" class="md-nav__link toc__link">
    Utilizar Django en entornos virtuales con Pipenv
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#colorear-sintaxis-y-autocompletar-en-visual-studio-code" title="Colorear sintaxis y autocompletar en Visual Studio Code" class="md-nav__link toc__link">
    Colorear sintaxis y autocompletar en Visual Studio Code
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#filtrar-un-modelo-por-un-campo-utilizando-un-formulario" title="Filtrar un modelo por un campo utilizando un formulario" class="md-nav__link toc__link">
    Filtrar un modelo por un campo utilizando un formulario
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#crear-editar-y-borrar-instancias-de-modelos-con-formularios" title="Crear, editar y borrar instancias de modelos con formularios" class="md-nav__link toc__link">
    Crear, editar y borrar instancias de modelos con formularios
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#mostrar-graficos-generados-con-matplotlib-en-django" title="Mostrar gráficos generados con Matplotlib en Django" class="md-nav__link toc__link">
    Mostrar gráficos generados con Matplotlib en Django
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#implementar-sistema-clasico-de-registro-login-y-logout" title="Implementar sistema clásico de registro, login y logout" class="md-nav__link toc__link">
    Implementar sistema clásico de registro, login y logout
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#extender-el-usercreationform-para-registrarse-con-el-email" title="Extender el UserCreationForm para registrarse con el email" class="md-nav__link toc__link">
    Extender el UserCreationForm para registrarse con el email
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#django-en-ubuntu-server-con-nginx-gunicorn-y-supervisor" title="Django en Ubuntu Server con Nginx, Gunicorn y Supervisor" class="md-nav__link toc__link">
    Django en Ubuntu Server con Nginx, Gunicorn y Supervisor
  </a>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
                
                
                <h1 id="tutoriales-sobre-django">Tutoriales sobre Django<a class="headerlink" href="#tutoriales-sobre-django" title="Permanent link">&para;</a></h1>
<h2 id="utilizar-django-en-entornos-virtuales-con-pipenv">Utilizar Django en entornos virtuales con Pipenv<a class="headerlink" href="#utilizar-django-en-entornos-virtuales-con-pipenv" title="Permanent link">&para;</a></h2>
<p>Python incluye un gestor de paquetes llamado pip, el problema es que no se puede tener instaladas dos versiones distintas del mismo paquete y si realizamos un proyecto que necesita una versión y luego tenemos que actualizar quizá deja de funcionar.</p>
<p>Los entornos virtuales sirven para crear una instalación de Python aislada a la del sistema, permitiéndonos instalar versiones de los paquetes que queramos.</p>
<p>Hasta hace un tiempo se utilizaba una herramienta llamada virtualenv, cuyo propósito es generar esos entornos aislados. El problema de este método es que es poco práctico porque te obliga a crear los entornos uno a uno identificándolos con un nombre. Ese es un problema común con el gestor de paquetes conda, una alternativa a virtualenv que además permite elegir la versión de Python, pero que también requiere otorgar nombres a los entornos.</p>
<p>Pipenv viene a solucionar ese punto, pues permite crear un entorno virtual individual para cada proyecto sin tener que darle un nombre. Simplemente crea el entorno en el directorio del proyecto y permite manejarlo desde ahí cómodamente.</p>
<p>La limitación que tiene este método es que está ligado a las versiones de Python que tengamos instaladas. Es decir, puedes crear entornos con otras versiones de Python diferentes a la que tienes por defecto, pero las necesitas previamente descargadas en la máquina y establecer las rutas durante la creación del entorno, algo que no sucede en conda.</p>
<p>Utilizar pipenv es muy fácil, para instalarlo haremos lo de siempre:</p>
<div class="highlight"><pre><span></span><code>pip install pipenv
</code></pre></div>
<p>Luego navegamos con la terminal al directorio de nuestro proyecto y ahí creamos el entorno de la siguiente forma:</p>
<div class="highlight"><pre><span></span><code>pipenv shell
</code></pre></div>
<p>Esto no sólo lo creará, también lo activará. Lo sabremos porque en la parte delantera de la terminal aparecerá el nombre del proyecto entre paréntesis y un código:</p>
<div class="highlight"><pre><span></span><code><span class="o">(</span>proyecto-hJNodmU0<span class="o">)</span>
</code></pre></div>
<p>Para salir de él podemos usar el comando <strong>exit</strong>:</p>
<div class="highlight"><pre><span></span><code><span class="o">(</span>proyecto-hJNodmU0<span class="o">)</span> <span class="nb">exit</span>
</code></pre></div>
<p>Y para volver a activarlo, simplemente situándonos de nuevo en la carpeta del proyecto hacemos de nuevo:</p>
<div class="highlight"><pre><span></span><code>pipenv shell
</code></pre></div>
<p>Siempre que tengamos la shell activa, el intérprete <strong>python</strong> hará referencia al del entorno virtual, sin embargo no es obligatorio tener la shell activada, podemos seguir interactuando con el entorno haciendo uso de <strong>pipenv</strong>. </p>
<p>Por ejemplo para instalar un paquete la lógica es simple, como si usáramos pip pero con pipenv:</p>
<div class="highlight"><pre><span></span><code>pipenv install &lt;paquete&gt;
</code></pre></div>
<p>Incluso se puede instalar un fichero requirements.txt:</p>
<div class="highlight"><pre><span></span><code>pipenv install -r requirements.txt
</code></pre></div>
<p>Y para desinstalar un paquete:</p>
<div class="highlight"><pre><span></span><code>pipenv uninstall &lt;paquete&gt;
</code></pre></div>
<p>O si queremos ver la lista de paquetes del entorno organizado por dependencias, podemos hacerlo con:</p>
<div class="highlight"><pre><span></span><code>pipenv graph
</code></pre></div>
<p>Me gusta utilizar pipenv porque me ahorra tiempo y además Visual Studio Code detecta el entorno automáticamente instalado en el directorio del proyecto.</p>
<p>Para utilizar Django en Pipenv simplemente deberíamos instalarlo en el entorno creado previamente en una carpeta que representará nuestro proyecto:</p>
<div class="highlight"><pre><span></span><code>pipenv install django
</code></pre></div>
<p>Ahora podemos ejecutar comandos dentro del entorno utilizando <strong>pipenv run</strong> y así crear el proyecto:</p>
<div class="highlight"><pre><span></span><code>pipenv run django-admin startproject &lt;proyecto&gt;
</code></pre></div>
<p>Para crear una app, nos situaremos en la raíz de nuestro proyecto (donde tenemos el <strong>manage.py</strong>) y lo haremos con:</p>
<div class="highlight"><pre><span></span><code>pipenv run python manage.py startapp &lt;app&gt;
</code></pre></div>
<p>Siguiendo la misma lógica podemos realizar migraciones, crear superusuarios, etc:</p>
<div class="highlight"><pre><span></span><code>pipenv run python manage.py makemigrations
pipenv run python manage.py migrate
pipenv run python manage.py createsuperuser
</code></pre></div>
<p>Algo genial es que podemos editar el fichero Pipfile y añadir en él nuestros propios scripts, por ejemplo un script para lanzar el servidor y ahorrarnos algunas palabras. Sólo tenemos que añadir un apartado [scripts] de la siguiente forma:</p>
<p><code>Pipfile</code>
<div class="highlight"><pre><span></span><code>[scripts]
server = &quot;python manage.py runserver&quot;
</code></pre></div></p>
<p>Luego para llamar al script lo haremos con el run y el nombre del script:</p>
<div class="highlight"><pre><span></span><code>pipenv run server
</code></pre></div>
<p>Todo esto no es más que una muestra del poder de Pipenv, si os parece interesante os dejo la <a href="https://pipenv.readthedocs.io/en/latest/">web oficial</a> y un <a href="https://realpython.com/pipenv-guide/">tutorial de Real Python</a> que está bastante bien.</p>
<h2 id="colorear-sintaxis-y-autocompletar-en-visual-studio-code">Colorear sintaxis y autocompletar en Visual Studio Code<a class="headerlink" href="#colorear-sintaxis-y-autocompletar-en-visual-studio-code" title="Permanent link">&para;</a></h2>
<p>Cuando trabajemos con templates HTML de Django en Visual Studio Code veremos que la sintaxis de los template tags no se colorea:</p>
<div class="image">
    <img src="/cdn/django/django_sintaxis_vsc_1.png"/>
</div>

<p>Hay varias extensiones que vienen a soluciones el problema, pero a menudo si arreglan una cosa rompen otra, como por ejemplo el autocompletado de los tags:</p>
<div class="image">
    <img src="/cdn/django/django_sintaxis_vsc_2.png"/>
</div>

<p>La solución es instalar la siguiente extensión llamada <a href="https://marketplace.visualstudio.com/items?itemName=batisteo.vscode-django">Django</a> creada por Baptiste Darthenay, podéis instalarla directamente desde el navegador haciendo clic en el enlace.</p>
<p>Después de instalarla la clave consiste en configurarla, tendremos que ir a <strong>Archivo &gt; Preferencias &gt; Configuración</strong>, en Windows <strong>Control + ,</strong> y acceder a la configuración JSON en lugar de la interfaz desde el botón superior derecho que luce con dos llaves <strong>{ }</strong>:</p>
<div class="image">
    <img src="/cdn/django/django_sintaxis_vsc_3.png"/>
</div>

<p>En nuestra configuración añadiremos las siguientes claves JSON con estos valores:</p>
<p><code>settings.json</code>
<div class="highlight"><pre><span></span><code>  <span class="s2">&quot;files.associations&quot;</span><span class="o">:</span> <span class="p">{</span>
    <span class="s2">&quot;**/templates/*.html&quot;</span><span class="o">:</span> <span class="s2">&quot;django-html&quot;</span><span class="p">,</span>
    <span class="s2">&quot;**/templates/*&quot;</span><span class="o">:</span> <span class="s2">&quot;django-txt&quot;</span><span class="p">,</span>
    <span class="s2">&quot;**/requirements{/**,*}.{txt,in}&quot;</span><span class="o">:</span> <span class="s2">&quot;pip-requirements&quot;</span>
  <span class="p">},</span>
  <span class="s2">&quot;emmet.includeLanguages&quot;</span><span class="o">:</span> <span class="p">{</span> <span class="s2">&quot;django-html&quot;</span><span class="o">:</span> <span class="s2">&quot;html&quot;</span> <span class="p">},</span>
</code></pre></div></p>
<p>Una vez lo tengamos reiniciamos Visual Studio Code, abrimos un template de Django y nos aseguramos de tener marcada la opción <strong>Django HTML</strong> en la sintaxis del documento:</p>
<div class="image">
    <img src="/cdn/django/django_sintaxis_vsc_4.png"/>
</div>

<p>Una vez lo tengamos ya deberíamos ser capaces de usar los template tags de Django así como el autocompletado, tanto de HTML como de los template tags usando el tabulador:</p>
<div class="image">
    <img src="/cdn/django/django_sintaxis_vsc_5.gif"/>
</div>

<h2 id="filtrar-un-modelo-por-un-campo-utilizando-un-formulario">Filtrar un modelo por un campo utilizando un formulario<a class="headerlink" href="#filtrar-un-modelo-por-un-campo-utilizando-un-formulario" title="Permanent link">&para;</a></h2>
<p>Con Django podemos crear filtros para nuestros modelos de forma relativamente sencilla jugando con los campos de un formulario y capturándolos en la vista para aplicarlos en las queryset.</p>
<p>Supongamos el siguiente proyecto donde tenemos un modelo <strong>Persona</strong> muy simple:</p>
<p><code>models.py</code>
<div class="highlight"><pre><span></span><code><span class="kn">from</span> <span class="nn">django.db</span> <span class="kn">import</span> <span class="n">models</span>

<span class="k">class</span> <span class="nc">Persona</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
  <span class="n">nombre</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">100</span><span class="p">)</span>
  <span class="n">edad</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">SmallIntegerField</span><span class="p">()</span>
</code></pre></div></p>
<p>Añadimos varias personas a través de nuestro panel de administración:</p>
<div class="image"><img src="/cdn/django/django_form_filtro_1.png"/></div>

<p>Para devolver una lista de nuestras personas utilizaremos una consulta básica al modelo que devuelva todas sus instancias:</p>
<p><code>views.py</code>
<div class="highlight"><pre><span></span><code><span class="kn">from</span> <span class="nn">django.shortcuts</span> <span class="kn">import</span> <span class="n">render</span>
<span class="kn">from</span> <span class="nn">.models</span> <span class="kn">import</span> <span class="o">*</span>


<span class="k">def</span> <span class="nf">home</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
    <span class="n">personas</span> <span class="o">=</span> <span class="n">Persona</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>

    <span class="k">return</span> <span class="n">render</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="s2">&quot;core/home.html&quot;</span><span class="p">,</span> <span class="p">{</span><span class="s1">&#39;personas&#39;</span><span class="p">:</span> <span class="n">personas</span><span class="p">})</span>
</code></pre></div></p>
<p>El template que visualizaría el contenido contendría sin mucha complicación un bucle for para recorrer las personas y mostrarlas:</p>
<p><code>home.html</code>
<div class="highlight"><pre><span></span><code><span class="p">&lt;</span><span class="nt">body</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">h2</span><span class="p">&gt;</span>Lista de personas<span class="p">&lt;/</span><span class="nt">h2</span><span class="p">&gt;</span>

    <span class="p">&lt;</span><span class="nt">ul</span><span class="p">&gt;</span>
    {% for persona in personas %}
        <span class="p">&lt;</span><span class="nt">li</span><span class="p">&gt;</span>{{persona.nombre}}, {{persona.edad}} años<span class="p">&lt;/</span><span class="nt">li</span><span class="p">&gt;</span>
    {% endfor %}
    <span class="p">&lt;/</span><span class="nt">ul</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">body</span><span class="p">&gt;</span>
</code></pre></div></p>
<p>Este sería el resultado:</p>
<div class="image"><img src="/cdn/django/django_form_filtro_2.png"/></div>

<p>Ahora viene lo interesante, ¿cómo podemos añadir un filtro para mostrar sólo las personas que tengan una edad mínima?</p>
<p>Lo primero sería añadir un formulario que valide contra la propia vista un campo con la edad mínima:</p>
<p><code>home.html</code>
<div class="highlight"><pre><span></span><code><span class="p">&lt;</span><span class="nt">body</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">h2</span><span class="p">&gt;</span>Lista de personas<span class="p">&lt;/</span><span class="nt">h2</span><span class="p">&gt;</span>

    <span class="p">&lt;</span><span class="nt">ul</span><span class="p">&gt;</span>
    {% for persona in personas %}
        <span class="p">&lt;</span><span class="nt">li</span><span class="p">&gt;</span>{{persona.nombre}}, {{persona.edad}} años<span class="p">&lt;/</span><span class="nt">li</span><span class="p">&gt;</span>
    {% endfor %}
    <span class="p">&lt;/</span><span class="nt">ul</span><span class="p">&gt;</span>

    <span class="p">&lt;</span><span class="nt">form</span> <span class="na">action</span><span class="o">=</span><span class="s">&quot;/&quot;</span> <span class="na">method</span><span class="o">=</span><span class="s">&quot;POST&quot;</span><span class="p">&gt;</span>
        Edad mínima: 
        <span class="p">&lt;</span><span class="nt">input</span> <span class="na">type</span><span class="o">=</span><span class="s">&quot;number&quot;</span> <span class="na">name</span><span class="o">=</span><span class="s">&quot;edad&quot;</span> <span class="na">value</span><span class="o">=</span><span class="s">&quot;0&quot;</span> <span class="na">style</span><span class="o">=</span><span class="s">&quot;width:40px&quot;</span> <span class="p">/</span> <span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">input</span> <span class="na">type</span><span class="o">=</span><span class="s">&quot;submit&quot;</span> <span class="na">value</span><span class="o">=</span><span class="s">&quot;Filtrar&quot;</span><span class="p">&gt;</span>
        {% csrf_token %}
    <span class="p">&lt;/</span><span class="nt">form</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">body</span><span class="p">&gt;</span>
</code></pre></div></p>
<p>Quedaría así:</p>
<div class="image"><img src="/cdn/django/django_form_filtro_3.png"/></div>

<p>Lo único a comentar sería el uso obligatorio del token csrf entre los tags <strong>form</strong> para proteger el formulario de las peticiones entre sitios cruzados.</p>
<p>Para procesar el campo con el <strong>name="edad"</strong>, buscaríamos ese campo en el diccionario <strong>POST</strong> de la petición y lo transformaríamos a número entero para poder utilizarlo en el filtro del queryset:</p>
<div class="highlight"><pre><span></span><code><span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">POST</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;edad&#39;</span><span class="p">):</span>
  <span class="n">edad</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">request</span><span class="o">.</span><span class="n">POST</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;edad&#39;</span><span class="p">))</span>
</code></pre></div>
<p>El código final de la vista, una vez aplicado el <strong>filter</strong> quedaría de esta forma:</p>
<p><code>views.py</code>
<div class="highlight"><pre><span></span><code><span class="kn">from</span> <span class="nn">django.shortcuts</span> <span class="kn">import</span> <span class="n">render</span>
<span class="kn">from</span> <span class="nn">.models</span> <span class="kn">import</span> <span class="o">*</span>

<span class="k">def</span> <span class="nf">home</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
    <span class="n">personas</span> <span class="o">=</span> <span class="n">Persona</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
    <span class="n">edad</span> <span class="o">=</span> <span class="mi">0</span>  <span class="c1"># Filtro por defecto</span>
    <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">POST</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;edad&#39;</span><span class="p">):</span>
        <span class="n">edad</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">request</span><span class="o">.</span><span class="n">POST</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;edad&#39;</span><span class="p">))</span>
        <span class="n">personas</span> <span class="o">=</span> <span class="n">personas</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">edad__gte</span><span class="o">=</span><span class="n">edad</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">render</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="s2">&quot;core/home.html&quot;</span><span class="p">,</span> <span class="p">{</span><span class="s1">&#39;personas&#39;</span><span class="p">:</span> <span class="n">personas</span><span class="p">,</span> <span class="s1">&#39;edad&#39;</span><span class="p">:</span><span class="n">edad</span><span class="p">})</span>
</code></pre></div></p>
<p>Fijaros como envío el propio campo edad de nuevo al template, así podríamos mostrarlo como valor del input:</p>
<div class="highlight"><pre><span></span><code><span class="p">&lt;</span><span class="nt">input</span> <span class="na">type</span><span class="o">=</span><span class="s">&quot;number&quot;</span> <span class="na">name</span><span class="o">=</span><span class="s">&quot;edad&quot;</span> <span class="na">value</span><span class="o">=</span><span class="s">&quot;{{ edad }}&quot;</span> <span class="na">style</span><span class="o">=</span><span class="s">&quot;width:40px&quot;</span> <span class="p">/</span> <span class="p">&gt;</span>
</code></pre></div>
<p>Con esto ya tendríamos nuestro sistema de filtrado para la queryset original con todas las personas aplicándole el filter sólo en caso de recibir el parámetro con la edad por POST:</p>
<div class="image"><img src="/cdn/django/django_form_filtro_4.png"/></div>

<h2 id="crear-editar-y-borrar-instancias-de-modelos-con-formularios">Crear, editar y borrar instancias de modelos con formularios<a class="headerlink" href="#crear-editar-y-borrar-instancias-de-modelos-con-formularios" title="Permanent link">&para;</a></h2>
<p>Una de las necesidades más comunes en Django es proveer una interfaz para crear, editar y borrar datos de un modelo.</p>
<p>Django cuenta con un tipo de formularios llamados <strong>ModelForm</strong> que podemos utilizar para gestionar los modelos de una forma cómoda y fácil.</p>
<p><strong>Nota</strong>: Utilizaremos como base el tutorial anterior de <strong>filtrar un modelo por un campo utilizando un formulario</strong>.</p>
<p>Supongamos que tenemos un modelo de persona y queremos implementar una vista con un formulario para crear nuevas personas:</p>
<p><code>models.py</code>
<div class="highlight"><pre><span></span><code><span class="kn">from</span> <span class="nn">django.db</span> <span class="kn">import</span> <span class="n">models</span>

<span class="k">class</span> <span class="nc">Persona</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="n">nombre</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">100</span><span class="p">)</span>
    <span class="n">edad</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">SmallIntegerField</span><span class="p">()</span>
</code></pre></div></p>
<p>Lo primero que necesitamos es crear un <strong>Model Form</strong> para manejar este modelo, lo haremos en un fichero <strong>forms.py</strong> dentro de la app:</p>
<p><code>forms.py</code>
<div class="highlight"><pre><span></span><code><span class="kn">from</span> <span class="nn">django.forms</span> <span class="kn">import</span> <span class="n">ModelForm</span>
<span class="kn">from</span> <span class="nn">.models</span> <span class="kn">import</span> <span class="n">Persona</span>

<span class="k">class</span> <span class="nc">PersonaForm</span><span class="p">(</span><span class="n">ModelForm</span><span class="p">):</span>
    <span class="k">class</span> <span class="nc">Meta</span><span class="p">:</span>
        <span class="n">model</span> <span class="o">=</span> <span class="n">Persona</span>
        <span class="n">fields</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;nombre&#39;</span><span class="p">,</span> <span class="s1">&#39;edad&#39;</span><span class="p">]</span>
</code></pre></div></p>
<p>Simplemente tenemos que indicar el modelo del formulario y los campos que vamos a manejar.</p>
<p>Una vez hecho implementaremos una vista para procesar este formulario de creación:</p>
<p><code>views.py</code>
<div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">add</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
    <span class="c1"># Creamos un formulario vacío</span>
    <span class="n">form</span> <span class="o">=</span> <span class="n">PersonaForm</span><span class="p">()</span>

    <span class="c1"># Comprobamos si se ha enviado el formulario</span>
    <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">method</span> <span class="o">==</span> <span class="s2">&quot;POST&quot;</span><span class="p">:</span>
        <span class="c1"># Añadimos los datos recibidos al formulario</span>
        <span class="n">form</span> <span class="o">=</span> <span class="n">PersonaForm</span><span class="p">(</span><span class="n">request</span><span class="o">.</span><span class="n">POST</span><span class="p">)</span>
        <span class="c1"># Si el formulario es válido...</span>
        <span class="k">if</span> <span class="n">form</span><span class="o">.</span><span class="n">is_valid</span><span class="p">():</span>
            <span class="c1"># Guardamos el formulario pero sin confirmarlo,</span>
            <span class="c1"># así conseguiremos una instancia para manejarla</span>
            <span class="n">instancia</span> <span class="o">=</span> <span class="n">form</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">commit</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
            <span class="c1"># Podemos guardarla cuando queramos</span>
            <span class="n">instancia</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
            <span class="c1"># Después de guardar redireccionamos a la lista</span>
            <span class="k">return</span> <span class="n">redirect</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">)</span>

    <span class="c1"># Si llegamos al final renderizamos el formulario</span>
    <span class="k">return</span> <span class="n">render</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="s2">&quot;core/add.html&quot;</span><span class="p">,</span> <span class="p">{</span><span class="s1">&#39;form&#39;</span><span class="p">:</span> <span class="n">form</span><span class="p">})</span>
</code></pre></div></p>
<p>Esta vista la llamaremos en una URL específica, por ejemplo <strong>/add/</strong>:</p>
<p><code>proyecto/urls.py</code>
<div class="highlight"><pre><span></span><code><span class="n">urlpatterns</span> <span class="o">=</span> <span class="p">[</span>
    <span class="c1"># ...</span>
    <span class="n">path</span><span class="p">(</span><span class="s1">&#39;add&#39;</span><span class="p">,</span> <span class="n">views</span><span class="o">.</span><span class="n">add</span><span class="p">),</span>
<span class="p">]</span>
</code></pre></div></p>
<p>Finalmente renderizaremos el formulario en el template de la siguiente forma:</p>
<p><code>add.html</code>
<div class="highlight"><pre><span></span><code><span class="p">&lt;</span><span class="nt">form</span> <span class="na">method</span><span class="o">=</span><span class="s">&quot;POST&quot;</span><span class="p">&gt;</span>
    {{ form.as_p }}
    {% csrf_token %}
    <span class="p">&lt;</span><span class="nt">button</span> <span class="na">type</span><span class="o">=</span><span class="s">&quot;submit&quot;</span><span class="p">&gt;</span>Crear<span class="p">&lt;/</span><span class="nt">button</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">form</span><span class="p">&gt;</span>
</code></pre></div></p>
<p>El resultado se vería así:</p>
<div class="image">
    <img src="/cdn/django/django_modelforms_2.png"/>
</div>

<p>Para modificar una instancia el proceso es muy similar al de crearlas, con la peculiaridad de que debemos recuperar la instancia y rellenar el formulario con su información. La vista quedaría así:</p>
<p><code>views.py</code>
<div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">edit</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">persona_id</span><span class="p">):</span>
    <span class="c1"># Recuperamos la instancia de la persona</span>
    <span class="n">instancia</span> <span class="o">=</span> <span class="n">Persona</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="n">persona_id</span><span class="p">)</span>

    <span class="c1"># Creamos el formulario con los datos de la instancia</span>
    <span class="n">form</span> <span class="o">=</span> <span class="n">PersonaForm</span><span class="p">(</span><span class="n">instance</span><span class="o">=</span><span class="n">instancia</span><span class="p">)</span>

    <span class="c1"># Comprobamos si se ha enviado el formulario</span>
    <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">method</span> <span class="o">==</span> <span class="s2">&quot;POST&quot;</span><span class="p">:</span>
        <span class="c1"># Actualizamos el formulario con los datos recibidos</span>
        <span class="n">form</span> <span class="o">=</span> <span class="n">PersonaForm</span><span class="p">(</span><span class="n">request</span><span class="o">.</span><span class="n">POST</span><span class="p">,</span> <span class="n">instance</span><span class="o">=</span><span class="n">instancia</span><span class="p">)</span>
        <span class="c1"># Si el formulario es válido...</span>
        <span class="k">if</span> <span class="n">form</span><span class="o">.</span><span class="n">is_valid</span><span class="p">():</span>
            <span class="c1"># Guardamos el formulario pero sin confirmarlo,</span>
            <span class="c1"># así conseguiremos una instancia para manejarla</span>
            <span class="n">instancia</span> <span class="o">=</span> <span class="n">form</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">commit</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
            <span class="c1"># Podemos guardarla cuando queramos</span>
            <span class="n">instancia</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>

    <span class="c1"># Si llegamos al final renderizamos el formulario</span>
    <span class="k">return</span> <span class="n">render</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="s2">&quot;core/edit.html&quot;</span><span class="p">,</span> <span class="p">{</span><span class="s1">&#39;form&#39;</span><span class="p">:</span> <span class="n">form</span><span class="p">})</span>
</code></pre></div></p>
<p>La URL definirá un campo numérico donde pasaremos el identificador de la instancia para poder recuperarlo:</p>
<p><code>proyecto/urls.py</code>
<div class="highlight"><pre><span></span><code><span class="n">urlpatterns</span> <span class="o">=</span> <span class="p">[</span>
    <span class="c1"># ...</span>
    <span class="n">path</span><span class="p">(</span><span class="s1">&#39;edit/&lt;int:persona_id&gt;&#39;</span><span class="p">,</span> <span class="n">views</span><span class="o">.</span><span class="n">edit</span><span class="p">),</span>
<span class="p">]</span>
</code></pre></div></p>
<p>Respecto al template, sería el mismo que usamos para crear la instancia, pero podemos utilizar una plantilla diferente para adaptar el texto informativo y mostrar <strong>Editar</strong> en lugar de <strong>Crear</strong> en el botón:</p>
<p><code>edit.html</code>
<div class="highlight"><pre><span></span><code><span class="p">&lt;</span><span class="nt">form</span> <span class="na">method</span><span class="o">=</span><span class="s">&quot;POST&quot;</span><span class="p">&gt;</span>
    {{ form.as_p }}
    {% csrf_token %}
    <span class="p">&lt;</span><span class="nt">button</span> <span class="na">type</span><span class="o">=</span><span class="s">&quot;submit&quot;</span><span class="p">&gt;</span>Editar<span class="p">&lt;/</span><span class="nt">button</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">form</span><span class="p">&gt;</span>
</code></pre></div></p>
<p>Si tenemos una lista de objetos podemos mostrar un enlace para ir al formulario de edición fácilmente creando la URL <strong>/edit/instancia.id</strong>:</p>
<div class="highlight"><pre><span></span><code><span class="p">&lt;</span><span class="nt">ul</span><span class="p">&gt;</span>
  {% for persona in personas %}
  <span class="p">&lt;</span><span class="nt">li</span><span class="p">&gt;</span>
    {{ persona.nombre }}, {{ persona.edad }} años
    <span class="p">&lt;</span><span class="nt">a</span> <span class="na">href</span><span class="o">=</span><span class="s">&quot;/edit/{{ persona.id }}&quot;</span><span class="p">&gt;</span>Editar<span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;</span>
  <span class="p">&lt;/</span><span class="nt">li</span><span class="p">&gt;</span>
  {% endfor %}
<span class="p">&lt;/</span><span class="nt">ul</span><span class="p">&gt;</span>
</code></pre></div>
<p>Así quedaría el formulario de edición al editar una instancia:</p>
<div class="image">
   <img src="/cdn/django/django_modelforms_4.png"/>
</div>

<p>Si todo está correcto los cambios quedarán establecidos en la instancia al guardarlos, por eso es buena idea añadir un enlace para visualizar la lista de instancias actualizadas:</p>
<div class="image">
   <img src="/cdn/django/django_modelforms_5.png"/>
</div>

<p>Por último podemos añadir una opción para borrar instancias a partir de su identificador.</p>
<p>No necesitamos manejar un formulario, simplemente recuperar la instancia en la vista y borrarla:</p>
<p><code>views.py</code>
<div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">delete</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">persona_id</span><span class="p">):</span>
    <span class="c1"># Recuperamos la instancia de la persona y la borramos</span>
    <span class="n">instancia</span> <span class="o">=</span> <span class="n">Persona</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="n">persona_id</span><span class="p">)</span>
    <span class="n">instancia</span><span class="o">.</span><span class="n">delete</span><span class="p">()</span>

    <span class="c1"># Después redireccionamos de nuevo a la lista</span>
    <span class="k">return</span> <span class="n">redirect</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">)</span>
</code></pre></div></p>
<p>La URL por tanto será casi igual que la de edición:</p>
<p><code>proyecto/urls.py</code>
<div class="highlight"><pre><span></span><code><span class="n">urlpatterns</span> <span class="o">=</span> <span class="p">[</span>
    <span class="c1"># ...</span>
    <span class="n">path</span><span class="p">(</span><span class="s1">&#39;delete/&lt;int:persona_id&gt;&#39;</span><span class="p">,</span> <span class="n">views</span><span class="o">.</span><span class="n">delete</span><span class="p">),</span>
<span class="p">]</span>   
</code></pre></div></p>
<p>Sólo necesitamos añadir un enlace en la lista de instancia para borrarlas, recomendablemente con una pequeña confirmación usando JavaScript para prevenir un borrado accidental:</p>
<div class="highlight"><pre><span></span><code><span class="p">&lt;</span><span class="nt">ul</span><span class="p">&gt;</span>
    {% for persona in personas %}
    <span class="p">&lt;</span><span class="nt">li</span><span class="p">&gt;</span>
        {{ persona.nombre }}, {{ persona.edad }} años
        <span class="p">&lt;</span><span class="nt">a</span> <span class="na">href</span><span class="o">=</span><span class="s">&quot;/edit/{{ persona.id }}&quot;</span><span class="p">&gt;</span>Editar<span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">a</span> <span class="na">href</span><span class="o">=</span><span class="s">&quot;/delete/{{ persona.id }}&quot;</span> 
          <span class="na">onClick</span><span class="o">=</span><span class="s">&quot;return confirm(&#39;¿Quieres borrar {{persona.nombre}}?&#39;);&quot;</span><span class="p">&gt;</span>
            Borrar
        <span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;</span>
    <span class="p">&lt;/</span><span class="nt">li</span><span class="p">&gt;</span>
    {% endfor %}
<span class="p">&lt;/</span><span class="nt">ul</span><span class="p">&gt;</span>
</code></pre></div>
<p>Al presionar el enlace de borrado nos aparecerá la ventana emergente de confirmación:</p>
<div class="image">
   <img src="/cdn/django/django_modelforms_6.png"/>
</div>

<p>Y justo después de confirmar volveremos a la lista donde ya habrá desaparecido la instancia borrada:</p>
<div class="image">
   <img src="/cdn/django/django_modelforms_7.png"/>
</div>

<h2 id="mostrar-graficos-generados-con-matplotlib-en-django">Mostrar gráficos generados con Matplotlib en Django<a class="headerlink" href="#mostrar-graficos-generados-con-matplotlib-en-django" title="Permanent link">&para;</a></h2>
<p>Algo que me preguntan muchos mis alumnos de Django es si es posible generar gráficos en Python y mostrarlos en un template.</p>
<p>La respuesta es sí, pero es un poco lioso porque hace falta "renderizar" el canvas de las figuras de Matplotlib sobre un buffer de bytes.</p>
<p>No voy a enseñar nada de Matplotlib porque eso es harina de otro costal, <a href="https://nbviewer.jupyter.org/github/hcosta/curso-python-udemy/tree/master/Fase%205%20-%20Modulos%20externos/Tema%2018%20-%20Matplotlib/">aquí dejo mis apuntes online</a>, pero sí el proceso para mostrar el gráfico.</p>
<p>La idea de mostrar gráficos con Django se basa en acceder a una url de nuestro proyecto, por ejemplo <strong>/plot/</strong>, y en lugar de renderizar un template, responder con la imagen del gráfico generada en tiempo de ejecución:</p>
<div class="image">
   <img src="/cdn/python/matplotlib_1.png"/>
   <div style="font-size:80%">Al acceder a la URL que genera el gráfico, ésta devuelve una imagen PNG en lugar de un documento HTML.</div>
</div>

<p>El snippet para la vista de Django sería el siguiente:</p>
<p><code>views.py</code>
<div class="highlight"><pre><span></span><code><span class="kn">import</span> <span class="nn">io</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>

<span class="kn">from</span> <span class="nn">django.http</span> <span class="kn">import</span> <span class="n">HttpResponse</span>
<span class="kn">from</span> <span class="nn">django.shortcuts</span> <span class="kn">import</span> <span class="n">render</span>
<span class="kn">from</span> <span class="nn">matplotlib.backends.backend_agg</span> <span class="kn">import</span> <span class="n">FigureCanvasAgg</span>

<span class="kn">from</span> <span class="nn">random</span> <span class="kn">import</span> <span class="n">sample</span>

<span class="k">def</span> <span class="nf">home</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">render</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="s2">&quot;core/home.html&quot;</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">plot</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
    <span class="c1"># Creamos los datos para representar en el gráfico</span>
    <span class="n">x</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">11</span><span class="p">)</span>
    <span class="n">y</span> <span class="o">=</span> <span class="n">sample</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">20</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">))</span>

    <span class="c1"># Creamos una figura y le dibujamos el gráfico</span>
    <span class="n">f</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>

    <span class="c1"># Creamos los ejes</span>
    <span class="n">axes</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">add_axes</span><span class="p">([</span><span class="mf">0.15</span><span class="p">,</span> <span class="mf">0.15</span><span class="p">,</span> <span class="mf">0.75</span><span class="p">,</span> <span class="mf">0.75</span><span class="p">])</span> <span class="c1"># [left, bottom, width, height]</span>
    <span class="n">axes</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
    <span class="n">axes</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;Eje X&quot;</span><span class="p">)</span>
    <span class="n">axes</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;Eje Y&quot;</span><span class="p">)</span>
    <span class="n">axes</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;Mi gráfico dinámico&quot;</span><span class="p">)</span>

    <span class="c1"># Como enviaremos la imagen en bytes la guardaremos en un buffer</span>
    <span class="n">buf</span> <span class="o">=</span> <span class="n">io</span><span class="o">.</span><span class="n">BytesIO</span><span class="p">()</span>
    <span class="n">canvas</span> <span class="o">=</span> <span class="n">FigureCanvasAgg</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
    <span class="n">canvas</span><span class="o">.</span><span class="n">print_png</span><span class="p">(</span><span class="n">buf</span><span class="p">)</span>

    <span class="c1"># Creamos la respuesta enviando los bytes en tipo imagen png</span>
    <span class="n">response</span> <span class="o">=</span> <span class="n">HttpResponse</span><span class="p">(</span><span class="n">buf</span><span class="o">.</span><span class="n">getvalue</span><span class="p">(),</span> <span class="n">content_type</span><span class="o">=</span><span class="s1">&#39;image/png&#39;</span><span class="p">)</span>

    <span class="c1"># Limpiamos la figura para liberar memoria</span>
    <span class="n">f</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>

    <span class="c1"># Añadimos la cabecera de longitud de fichero para más estabilidad</span>
    <span class="n">response</span><span class="p">[</span><span class="s1">&#39;Content-Length&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">content</span><span class="p">))</span>

    <span class="c1"># Devolvemos la response</span>
    <span class="k">return</span> <span class="n">response</span>
</code></pre></div></p>
<p>Esto nos generaría el gráfico que os muestro en la imagen de arriba, que cambiará cada vez que recargamos la página con F5 porque contiene datos aleatorios tomados del módulo <strong>random</strong>.</p>
<p>Lo bueno es que podemos insertar esta URL como si fuera una imagen:</p>
<p><code>home.html</code>
<div class="highlight"><pre><span></span><code><span class="cp">&lt;!DOCTYPE html&gt;</span>
<span class="p">&lt;</span><span class="nt">html</span> <span class="na">lang</span><span class="o">=</span><span class="s">&quot;en&quot;</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">head</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">meta</span> <span class="na">charset</span><span class="o">=</span><span class="s">&quot;UTF-8&quot;</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">meta</span> <span class="na">name</span><span class="o">=</span><span class="s">&quot;viewport&quot;</span> <span class="na">content</span><span class="o">=</span><span class="s">&quot;width=device-width, initial-scale=1.0&quot;</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">meta</span> <span class="na">http-equiv</span><span class="o">=</span><span class="s">&quot;X-UA-Compatible&quot;</span> <span class="na">content</span><span class="o">=</span><span class="s">&quot;ie=edge&quot;</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">title</span><span class="p">&gt;</span>Test plot<span class="p">&lt;/</span><span class="nt">title</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">head</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">body</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">h2</span><span class="p">&gt;</span>Gráfico embebido por imagen<span class="p">&lt;/</span><span class="nt">h2</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">p</span><span class="p">&gt;</span>Presionar F5 para generar nueva muestra: <span class="p">&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">img</span> <span class="na">src</span><span class="o">=</span><span class="s">&quot;/plot/&quot;</span> <span class="na">width</span><span class="o">=</span><span class="s">&quot;600px&quot;</span> <span class="p">/&gt;</span>
<span class="p">&lt;/</span><span class="nt">body</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">html</span><span class="p">&gt;</span>
</code></pre></div></p>
<p>Quedando finalmente la página principal de la siguiente forma:</p>
<div class="image">
   <img src="/cdn/python/matplotlib_2.png"/>
</div>

<p>Si a esta idea le sumamos parámetros, ya sea por GET o POST que podemos capturar en la vista, entonces podemos añadir dinamismo y generar los gráficos como nosotros queramos. Por ejemplo pasando un parámetro GET llamado type <strong>/plot/?type=1</strong> donde luego con <strong>request.GET.get['type']</strong> podamos seleccionar el tipo de gráfico o lo que se os ocurra.</p>
<h2 id="implementar-sistema-clasico-de-registro-login-y-logout">Implementar sistema clásico de registro, login y logout<a class="headerlink" href="#implementar-sistema-clasico-de-registro-login-y-logout" title="Permanent link">&para;</a></h2>
<p>Este tutorial tiene como objetivo mostrar cómo utilizar las funciones que ofrece Django para registrar y autenticar usuarios utilizando sus apps y formularios internos. No enseñaré a programar funciones extendidas como podrían ser la de cambiar la contraseña o enviar emails de verificación, pues serían funcionalidades para tratar en tutoriales a parte.</p>
<p>Para este experimento vamos a suponer que necesitamos crear una sección privada sólo para usuarios registrados. Esta área exclusiva la manejaremos dentro de una app llamada <strong>users</strong> que también gestionará los formularios de inicio de sesión y login:</p>
<div class="highlight"><pre><span></span><code>python manage.py startapp users
</code></pre></div>
<p>Una vez la tengáis creada no olvidéis activarla en el <strong>settings.py</strong>.</p>
<p>Tendremos básicamente 4 vistas en la aplicación de usuarios:</p>
<ul>
<li><strong>welcome</strong>: Manejará la bienvenida al área para miembros y redireccionará a la vista de identificación si el usuario no ha iniciado la sesión.</li>
<li><strong>register</strong>: Manejará el formulario de registro de usuarios y autenticará al usuario automáticamente al registrarse.</li>
<li><strong>login</strong>: Manejará el formulario de identificación de usuarios y redireccionará a la portada si las credenciales son correctas.</li>
<li><strong>logout</strong>: Manejará la acción de cerrar la sesión y redirecciona a la vista de la portada de nuevo.</li>
</ul>
<p>Podemos crearlas inicialmente con el mínimo contenido:</p>
<p><code>views.py</code>
<div class="highlight"><pre><span></span><code><span class="kn">from</span> <span class="nn">django.shortcuts</span> <span class="kn">import</span> <span class="n">render</span><span class="p">,</span> <span class="n">redirect</span>

<span class="k">def</span> <span class="nf">welcome</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">render</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="s2">&quot;users/welcome.html&quot;</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">register</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">render</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="s2">&quot;users/register.html&quot;</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">login</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">render</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="s2">&quot;users/login.html&quot;</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">logout</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
    <span class="c1"># Redireccionamos a la portada</span>
    <span class="k">return</span> <span class="n">redirect</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">)</span>
</code></pre></div></p>
<p>Las URL que las manejarán serán las siguientes:</p>
<p><code>proyecto/urls.py</code>
<div class="highlight"><pre><span></span><code><span class="kn">from</span> <span class="nn">django.contrib</span> <span class="kn">import</span> <span class="n">admin</span>
<span class="kn">from</span> <span class="nn">django.urls</span> <span class="kn">import</span> <span class="n">path</span>
<span class="kn">from</span> <span class="nn">users</span> <span class="kn">import</span> <span class="n">views</span>

<span class="n">urlpatterns</span> <span class="o">=</span> <span class="p">[</span>
    <span class="n">path</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">views</span><span class="o">.</span><span class="n">welcome</span><span class="p">),</span>
    <span class="n">path</span><span class="p">(</span><span class="s1">&#39;register&#39;</span><span class="p">,</span> <span class="n">views</span><span class="o">.</span><span class="n">register</span><span class="p">),</span>
    <span class="n">path</span><span class="p">(</span><span class="s1">&#39;login&#39;</span><span class="p">,</span> <span class="n">views</span><span class="o">.</span><span class="n">login</span><span class="p">),</span>
    <span class="n">path</span><span class="p">(</span><span class="s1">&#39;logout&#39;</span><span class="p">,</span> <span class="n">views</span><span class="o">.</span><span class="n">logout</span><span class="p">),</span>

    <span class="n">path</span><span class="p">(</span><span class="s1">&#39;admin/&#39;</span><span class="p">,</span> <span class="n">admin</span><span class="o">.</span><span class="n">site</span><span class="o">.</span><span class="n">urls</span><span class="p">),</span>
<span class="p">]</span>
</code></pre></div></p>
<p>Vamos a empezar con el <strong>logout</strong> porque es la acción más sencilla, sólo tenemos que llamar a la función de mismo nombre que encontraremos en el módulo <strong>django.contrib.auth</strong>. Os sugiero importar la función con otro nombre porque de esa forma podemos usar <strong>logout</strong> en la función de la vista:</p>
<p><code>views.py</code>
<div class="highlight"><pre><span></span><code><span class="kn">from</span> <span class="nn">django.contrib.auth</span> <span class="kn">import</span> <span class="n">logout</span> <span class="k">as</span> <span class="n">do_logout</span>

<span class="c1"># ...</span>

<span class="k">def</span> <span class="nf">logout</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
    <span class="c1"># Finalizamos la sesión</span>
    <span class="n">do_logout</span><span class="p">(</span><span class="n">request</span><span class="p">)</span>
    <span class="c1"># Redireccionamos a la portada</span>
    <span class="k">return</span> <span class="n">redirect</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">)</span>
</code></pre></div></p>
<p>Tan sencillo como esto.</p>
<p>A continuación nos centraremos en añadir una validación a la portada que redireccione al usuario al <strong>login</strong> en caso de no estar autenticado, así protegeremos su contenido:</p>
<p><code>views.py</code>
<div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">welcome</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
    <span class="c1"># Si estamos identificados devolvemos la portada</span>
    <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">user</span><span class="o">.</span><span class="n">is_authenticated</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">render</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="s2">&quot;users/welcome.html&quot;</span><span class="p">)</span>
    <span class="c1"># En otro caso redireccionamos al login</span>
    <span class="k">return</span> <span class="n">redirect</span><span class="p">(</span><span class="s1">&#39;/login&#39;</span><span class="p">)</span>
</code></pre></div></p>
<p>El contenido de la portada podría ser el siguiente:</p>
<p><code>welcome.html</code>
<div class="highlight"><pre><span></span><code><span class="p">&lt;</span><span class="nt">h2</span><span class="p">&gt;</span>Área para miembros<span class="p">&lt;/</span><span class="nt">h2</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">p</span><span class="p">&gt;</span>
    Bienvenido <span class="p">&lt;</span><span class="nt">b</span><span class="p">&gt;</span>{{request.user.username}}<span class="p">&lt;/</span><span class="nt">b</span><span class="p">&gt;</span>, 
    esta página es exclusiva para usuarios registrados.
<span class="p">&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">hr</span> <span class="p">/&gt;</span>
<span class="p">&lt;</span><span class="nt">a</span> <span class="na">href</span><span class="o">=</span><span class="s">&quot;/logout&quot;</span><span class="p">&gt;</span>Cerrar sesión<span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;</span>
</code></pre></div></p>
<p>Al añadir este código si intentamos acceder a la la raíz del sitio <strong>/</strong> nos redireccionará al <strong>/login</strong> que aún no hemos creado. En caso de ver la portada podría ser por tener una sesión activa préviamente desde el panel de administrador, ya que se gestionan con la misma app interna de Django. Si la cerráis desde el enlace inferior os llevará al <strong>login</strong>.</p>
<p>El formulario de identificación es la cosa más sencilla del mundo, sólo necesitamos un campo para el nombre del usuario y otro para la contraseña. Podríamos crearlos manualmente pero también podemos usar los <a href="https://docs.djangoproject.com/en/dev/topics/auth/default/#module-django.contrib.auth.forms">built-in forms de Django</a>.</p>
<p>Así que vamos a importar el formulario de autenticación llamado <strong>AuthenticationForm</strong> y dejaremos que él lo gestione todo, nosotros sólo lo validaremos e iniciaremos la sesión si la información es correcta:</p>
<p><code>views.py</code>
<div class="highlight"><pre><span></span><code><span class="kn">from</span> <span class="nn">django.contrib.auth</span> <span class="kn">import</span> <span class="n">authenticate</span>
<span class="kn">from</span> <span class="nn">django.contrib.auth.forms</span> <span class="kn">import</span> <span class="n">AuthenticationForm</span>
<span class="kn">from</span> <span class="nn">django.contrib.auth</span> <span class="kn">import</span> <span class="n">login</span> <span class="k">as</span> <span class="n">do_login</span>

<span class="c1"># ...</span>

<span class="k">def</span> <span class="nf">login</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
    <span class="c1"># Creamos el formulario de autenticación vacío</span>
    <span class="n">form</span> <span class="o">=</span> <span class="n">AuthenticationForm</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">method</span> <span class="o">==</span> <span class="s2">&quot;POST&quot;</span><span class="p">:</span>
        <span class="c1"># Añadimos los datos recibidos al formulario</span>
        <span class="n">form</span> <span class="o">=</span> <span class="n">AuthenticationForm</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">request</span><span class="o">.</span><span class="n">POST</span><span class="p">)</span>
        <span class="c1"># Si el formulario es válido...</span>
        <span class="k">if</span> <span class="n">form</span><span class="o">.</span><span class="n">is_valid</span><span class="p">():</span>
            <span class="c1"># Recuperamos las credenciales validadas</span>
            <span class="n">username</span> <span class="o">=</span> <span class="n">form</span><span class="o">.</span><span class="n">cleaned_data</span><span class="p">[</span><span class="s1">&#39;username&#39;</span><span class="p">]</span>
            <span class="n">password</span> <span class="o">=</span> <span class="n">form</span><span class="o">.</span><span class="n">cleaned_data</span><span class="p">[</span><span class="s1">&#39;password&#39;</span><span class="p">]</span>

            <span class="c1"># Verificamos las credenciales del usuario</span>
            <span class="n">user</span> <span class="o">=</span> <span class="n">authenticate</span><span class="p">(</span><span class="n">username</span><span class="o">=</span><span class="n">username</span><span class="p">,</span> <span class="n">password</span><span class="o">=</span><span class="n">password</span><span class="p">)</span>

            <span class="c1"># Si existe un usuario con ese nombre y contraseña</span>
            <span class="k">if</span> <span class="n">user</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="c1"># Hacemos el login manualmente</span>
                <span class="n">do_login</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">user</span><span class="p">)</span>
                <span class="c1"># Y le redireccionamos a la portada</span>
                <span class="k">return</span> <span class="n">redirect</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">)</span>

    <span class="c1"># Si llegamos al final renderizamos el formulario</span>
    <span class="k">return</span> <span class="n">render</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="s2">&quot;users/login.html&quot;</span><span class="p">,</span> <span class="p">{</span><span class="s1">&#39;form&#39;</span><span class="p">:</span> <span class="n">form</span><span class="p">})</span>
</code></pre></div></p>
<p>El template quedaría de la siguiente forma, dejando que sea el propio Django quién renderice el formulario:</p>
<p><code>login.html</code>
<div class="highlight"><pre><span></span><code><span class="p">&lt;</span><span class="nt">h2</span><span class="p">&gt;</span>Iniciar sesión<span class="p">&lt;/</span><span class="nt">h2</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">form</span> <span class="na">method</span><span class="o">=</span><span class="s">&quot;POST&quot;</span><span class="p">&gt;</span>
    {{ form.as_p }}
    {% csrf_token %}
    <span class="p">&lt;</span><span class="nt">button</span> <span class="na">type</span><span class="o">=</span><span class="s">&quot;submit&quot;</span><span class="p">&gt;</span>Login<span class="p">&lt;/</span><span class="nt">button</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">form</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">hr</span> <span class="p">/&gt;</span>
<span class="p">&lt;</span><span class="nt">a</span> <span class="na">href</span><span class="o">=</span><span class="s">&quot;/register&quot;</span><span class="p">&gt;</span>Registrar usuario<span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;</span>
</code></pre></div></p>
<p>Con esto ya tendremos implementada la identificación:</p>
<div class="image">
    <img src="/cdn/django/django_classic_auth_3.png"/>
</div>

<p>Si no tenéis un usuario os recomiendo crear uno desde la terminal para probarlo, pero recordad antes hacer una migración inicial:</p>
<div class="highlight"><pre><span></span><code>python manage.py migrate
python manage.py createsuperuser
</code></pre></div>
<p>Además lo interesante es que al ser un formulario integrado soporta la traducción dependiendo del idioma que tenemos configurado en Django y también es capaz de detectar los errores e informar si el usuario no es correcto.</p>
<div class="image">
    <img src="/cdn/django/django_classic_auth_2.png"/>
</div>

<p>Y por último vamos con la funcionalidad de añadir nuevos usuarios.</p>
<p>Se maneja de forma muy parecida al <strong>login</strong>, ya que también hay un formulario integrado para manejar esta situación, se trata de <strong>UserCreationForm</strong>:</p>
<p><code>views.py</code>
<div class="highlight"><pre><span></span><code><span class="kn">from</span> <span class="nn">django.contrib.auth.forms</span> <span class="kn">import</span> <span class="n">UserCreationForm</span>

<span class="c1"># ...</span>

<span class="k">def</span> <span class="nf">register</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
    <span class="c1"># Creamos el formulario de autenticación vacío</span>
    <span class="n">form</span> <span class="o">=</span> <span class="n">UserCreationForm</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">method</span> <span class="o">==</span> <span class="s2">&quot;POST&quot;</span><span class="p">:</span>
        <span class="c1"># Añadimos los datos recibidos al formulario</span>
        <span class="n">form</span> <span class="o">=</span> <span class="n">UserCreationForm</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">request</span><span class="o">.</span><span class="n">POST</span><span class="p">)</span>
        <span class="c1"># Si el formulario es válido...</span>
        <span class="k">if</span> <span class="n">form</span><span class="o">.</span><span class="n">is_valid</span><span class="p">():</span>
            <span class="c1"># Creamos la nueva cuenta de usuario</span>
            <span class="n">user</span> <span class="o">=</span> <span class="n">form</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
            <span class="c1"># Si el usuario se crea correctamente </span>
            <span class="k">if</span> <span class="n">user</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="c1"># Hacemos el login manualmente</span>
                <span class="n">do_login</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">user</span><span class="p">)</span>
                <span class="c1"># Y le redireccionamos a la portada</span>
                <span class="k">return</span> <span class="n">redirect</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">)</span>

    <span class="c1"># Si llegamos al final renderizamos el formulario</span>
    <span class="k">return</span> <span class="n">render</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="s2">&quot;users/register.html&quot;</span><span class="p">,</span> <span class="p">{</span><span class="s1">&#39;form&#39;</span><span class="p">:</span> <span class="n">form</span><span class="p">})</span>
</code></pre></div></p>
<p>El template sería prácticamente un calco del de <strong>login</strong>:</p>
<p><code>register.html</code>
<div class="highlight"><pre><span></span><code><span class="p">&lt;</span><span class="nt">h2</span><span class="p">&gt;</span>Registrar usuario<span class="p">&lt;/</span><span class="nt">h2</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">form</span> <span class="na">method</span><span class="o">=</span><span class="s">&quot;POST&quot;</span><span class="p">&gt;</span>
    {{ form.as_p }}
    {% csrf_token %}
    <span class="p">&lt;</span><span class="nt">button</span> <span class="na">type</span><span class="o">=</span><span class="s">&quot;submit&quot;</span><span class="p">&gt;</span>Registrar<span class="p">&lt;/</span><span class="nt">button</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">form</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">hr</span> <span class="p">/&gt;</span>
<span class="p">&lt;</span><span class="nt">a</span> <span class="na">href</span><span class="o">=</span><span class="s">&quot;/login&quot;</span><span class="p">&gt;</span>Iniciar sesión<span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;</span>
</code></pre></div></p>
<p>Se verá más o menos así:</p>
<div class="image">
    <img src="/cdn/django/django_classic_auth_4.png"/>
</div>

<p>Este formulario de registro tiene la peculiaridad de contener mucho texto de ayuda a la hora de crear las cuentas, pero si queremos podemos esconder esa información borrando el atributo <strong>help_text</strong> de los tres campos del formulario:</p>
<p><code>views.py</code>
<div class="highlight"><pre><span></span><code><span class="c1"># Si queremos borramos los campos de ayuda</span>
<span class="n">form</span><span class="o">.</span><span class="n">fields</span><span class="p">[</span><span class="s1">&#39;username&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">help_text</span> <span class="o">=</span> <span class="kc">None</span>
<span class="n">form</span><span class="o">.</span><span class="n">fields</span><span class="p">[</span><span class="s1">&#39;password1&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">help_text</span> <span class="o">=</span> <span class="kc">None</span>
<span class="n">form</span><span class="o">.</span><span class="n">fields</span><span class="p">[</span><span class="s1">&#39;password2&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">help_text</span> <span class="o">=</span> <span class="kc">None</span>

<span class="c1"># Si llegamos al final renderizamos el formulario</span>
<span class="k">return</span> <span class="n">render</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="s2">&quot;users/register.html&quot;</span><span class="p">,</span> <span class="p">{</span><span class="s1">&#39;form&#39;</span><span class="p">:</span> <span class="n">form</span><span class="p">})</span>
</code></pre></div></p>
<p>Así tendríamos un formulario más limpio, aunque conservaremos los mensajes de error si se introduce un nombre de usuario en uso o si las contraseñas no superan la validación mínima:</p>
<div class="image">
    <img src="/cdn/django/django_classic_auth_5.png"/>
</div>

<h2 id="extender-el-usercreationform-para-registrarse-con-el-email">Extender el UserCreationForm para registrarse con el email<a class="headerlink" href="#extender-el-usercreationform-para-registrarse-con-el-email" title="Permanent link">&para;</a></h2>
<p>El sistema de usuarios en Django tiene un problema y es que por defecto utiliza únicamente el usuario y la contraseña. Sin embargo en la actualidad es cada vez más común que los sitios en lugar de un "nick" utilicen el correo electrónico como usuario:</p>
<p>Ya os enseñé a <a href="https://www.hektorprofe.net/tutorial/django-sistema-registro-login-logout">implementar un sistema clásico de registro, login y logout</a>, así que vamos a extender esa lógica para obligar al usuario a registrarse e iniciar sesión utilizando su correo electrónico:</p>
<div class="image">
    <img src="/cdn/django/django_auth_email_1.png"/>
</div>

<p>La solución más sencilla consiste en engañar al usuario, para que en lugar de registrarse con un nombre utilice su correo electrónico.</p>
<p>Así que vamos a extender el formulario de registro de Django <strong>UserCreationForm</strong> para que en lugar de <strong>Nombre de usuario</strong> muestre el texto <strong>Correo electrónico</strong>. Podemos hacerlo dentro del fichero <strong>forms.py</strong> y llamaremos al nuevo formulario por ejemplo <strong>UCFWithEmail</strong>:</p>
<p><code>forms.py</code>
<div class="highlight"><pre><span></span><code><span class="kn">from</span> <span class="nn">django</span> <span class="kn">import</span> <span class="n">forms</span>
<span class="kn">from</span> <span class="nn">django.contrib.auth.forms</span> <span class="kn">import</span> <span class="n">UserCreationForm</span>
<span class="kn">from</span> <span class="nn">django.contrib.auth.models</span> <span class="kn">import</span> <span class="n">User</span>

<span class="c1"># Extendemos del original</span>
<span class="k">class</span> <span class="nc">UCFWithEmail</span><span class="p">(</span><span class="n">UserCreationForm</span><span class="p">):</span>
    <span class="c1"># Ahora el campo username es de tipo email y cambiamos su texto</span>
    <span class="n">username</span> <span class="o">=</span> <span class="n">forms</span><span class="o">.</span><span class="n">EmailField</span><span class="p">(</span><span class="n">label</span><span class="o">=</span><span class="s2">&quot;Correo electrónico&quot;</span><span class="p">)</span>

    <span class="k">class</span> <span class="nc">Meta</span><span class="p">:</span>
        <span class="n">model</span> <span class="o">=</span> <span class="n">User</span>
        <span class="n">fields</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;username&quot;</span><span class="p">,</span> <span class="s2">&quot;password1&quot;</span><span class="p">,</span> <span class="s2">&quot;password2&quot;</span><span class="p">]</span>
</code></pre></div></p>
<p>Ahora en la vista sólo tenemos que cambiar el formulario <strong>UserCreationForm</strong> por nuestro <strong>UCFWithEmail</strong>:</p>
<div class="highlight"><pre><span></span><code><span class="c1"># Estas son las líneas que cambian</span>
<span class="kn">from</span> <span class="nn">.forms</span> <span class="kn">import</span> <span class="n">UCFWithEmail</span>
<span class="n">form</span> <span class="o">=</span> <span class="n">UCFWithEmail</span><span class="p">()</span>
<span class="n">form</span> <span class="o">=</span> <span class="n">UCFWithEmail</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">request</span><span class="o">.</span><span class="n">POST</span><span class="p">)</span>
</code></pre></div>
<p>Y ya lo tendremos:</p>
<div class="image">
    <img src="/cdn/django/django_auth_email_1.png"/>
</div>

<p>Ahora si quisiéramos cambiar el texto <strong>Nombre de usuario</strong> también en el formulario de login:</p>
<div class="image">
    <img src="/cdn/django/django_auth_email_3.png"/>
</div>

<p>Podemos hacer lo mismo extendiendo el formulario <strong>AuthenticationForm</strong> en nuestro propio <strong>AFWithEmail</strong>:</p>
<p><code>forms.py</code>
<div class="highlight"><pre><span></span><code><span class="kn">from</span> <span class="nn">django</span> <span class="kn">import</span> <span class="n">forms</span>
<span class="kn">from</span> <span class="nn">django.contrib.auth.forms</span> <span class="kn">import</span> <span class="n">UserCreationForm</span><span class="p">,</span> <span class="n">AuthenticationForm</span>
<span class="kn">from</span> <span class="nn">django.contrib.auth.models</span> <span class="kn">import</span> <span class="n">User</span>

<span class="c1"># Extendemos del original</span>
<span class="k">class</span> <span class="nc">AFWithEmail</span><span class="p">(</span><span class="n">AuthenticationForm</span><span class="p">):</span>
    <span class="c1"># Ahora el campo username es de tipo email y cambiamos su texto</span>
    <span class="n">username</span> <span class="o">=</span> <span class="n">forms</span><span class="o">.</span><span class="n">EmailField</span><span class="p">(</span><span class="n">label</span><span class="o">=</span><span class="s2">&quot;Correo electrónico&quot;</span><span class="p">)</span>

    <span class="k">class</span> <span class="nc">Meta</span><span class="p">:</span>
        <span class="n">model</span> <span class="o">=</span> <span class="n">User</span>
        <span class="n">fields</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;username&quot;</span><span class="p">,</span> <span class="s2">&quot;password&quot;</span><span class="p">]</span>
</code></pre></div></p>
<p>Para usarlo en la vista, igual que antes, sólo tenemos que cambiar la clase del formulario por la nuestra.</p>
<div class="highlight"><pre><span></span><code><span class="c1"># Estas son las líneas que cambian</span>
<span class="kn">from</span> <span class="nn">.forms</span> <span class="kn">import</span> <span class="n">UCFWithEmail</span><span class="p">,</span> <span class="n">AFWithEmail</span>
<span class="n">form</span> <span class="o">=</span> <span class="n">AFWithEmail</span><span class="p">()</span>
<span class="n">form</span> <span class="o">=</span> <span class="n">AFWithEmail</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">request</span><span class="o">.</span><span class="n">POST</span><span class="p">)</span>
</code></pre></div>
<p>Y listo, ya lo tendremos:</p>
<div class="image">
    <img src="/cdn/django/django_auth_email_4.png"/>
</div>

<p>Faltaría sólamente arreglar un detalle durante la validación para que en lugar de <strong>Nombre de usuario</strong> muestre <strong>Correo electrónico</strong>, pero es algo tedioso porque el texto se encuentra dentro de las traducciones de Django, sería más fácil diseñar el formulario manualmente, pero bueno, dejando de banda ese detalle esta forma funciona genial:</p>
<div class="image">
    <img src="/cdn/django/django_auth_email_5.png"/>
</div>

<p>Vamos a ver cómo utilizar <strong>inline forms</strong>, ya sea a través del administrador o en nuestras propias vistas.</p>
<p>Los <strong>inlines</strong> son formularios que surgen al crear modelos relacionados, normalmente de tipo <strong>Foreign Key</strong>.</p>
<p>El concepto se ve muy fácilmente en un ejemplo, así que vamos a utilizar como base el tutorial de <a href="https://www.hektorprofe.net/tutorial/django-formularios-crear-editar-instancias">crear, editar y borrar instancias de modelos con formularios</a> y lo extenderemos un poco.</p>
<p>Supongamos que tenemos este modelo <strong>Persona</strong>:</p>
<p><code>models.py</code>
<div class="highlight"><pre><span></span><code><span class="kn">from</span> <span class="nn">django.db</span> <span class="kn">import</span> <span class="n">models</span>

<span class="k">class</span> <span class="nc">Persona</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="n">nombre</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">100</span><span class="p">)</span>
    <span class="n">edad</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">SmallIntegerField</span><span class="p">()</span>

    <span class="k">def</span> <span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">nombre</span>
</code></pre></div></p>
<p>Ahora queremos crear diferentes tareas para cada <strong>Persona</strong>, para ello vamos a crear un modelo relacionado llamado <strong>Tarea</strong>, con un nombre de tarea y una relación la persona que la tendrá asignada:</p>
<p><code>models.py</code>
<div class="highlight"><pre><span></span><code><span class="k">class</span> <span class="nc">Tarea</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="n">nombre</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">100</span><span class="p">)</span>
    <span class="n">persona</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">ForeignKey</span><span class="p">(</span><span class="n">Persona</span><span class="p">,</span> <span class="n">on_delete</span><span class="o">=</span><span class="n">models</span><span class="o">.</span><span class="n">CASCADE</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">nombre</span>
</code></pre></div></p>
<p>Hasta aquí sin mucha complicación.</p>
<p>Entonces, para añadir al panel de administrador estas tareas en el propio formulario de cada persona para manejar sus tareas cómodamente podemos usar inlines.</p>
<p>Podemos registrar el nuevo admin para <strong>Tarea</strong> en el <strong>admin.py</strong>, pero en lugar de hacerlo como un modelo tradicional, lo haremos como un <strong>inline</strong> y lo asignaremos al admin de <strong>Persona</strong>, fijaros:</p>
<p><code>admin.py</code>
<div class="highlight"><pre><span></span><code><span class="c1"># Creamos el inline para el modelo tarea</span>
<span class="k">class</span> <span class="nc">TareaInline</span><span class="p">(</span><span class="n">admin</span><span class="o">.</span><span class="n">TabularInline</span><span class="p">):</span>
    <span class="n">model</span> <span class="o">=</span> <span class="n">Tarea</span>
    <span class="c1"># Mostramos dos inlines acíos por defecto</span>
    <span class="n">extra</span> <span class="o">=</span> <span class="mi">2</span>

<span class="k">class</span> <span class="nc">PersonaAdmin</span><span class="p">(</span><span class="n">admin</span><span class="o">.</span><span class="n">ModelAdmin</span><span class="p">):</span>
    <span class="n">list_display</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;nombre&#39;</span><span class="p">,</span> <span class="s1">&#39;edad&#39;</span><span class="p">)</span>
    <span class="c1"># Registramos el inline en la persona</span>
    <span class="n">inlines</span> <span class="o">=</span> <span class="p">[</span><span class="n">TareaInline</span><span class="p">]</span>
</code></pre></div></p>
<p>Con esto ya lo tenemos, si vamos al administrador veremos la nueva estructura y podremos crear nuevas tareas en la parte inferior, teniendo siempre dos huecos libres para añadir otras:</p>
<div class="image">
    <img src="/cdn/django/django_inlines_1.png"/>
</div>

<p>A parte de la forma <strong>TabularInline</strong> para mostrar los campos horizontalmente también existe <strong>StackedInline</strong> para hacerlo verticalmente:</p>
<div class="highlight"><pre><span></span><code><span class="n">TareaInline</span><span class="p">(</span><span class="n">admin</span><span class="o">.</span><span class="n">StackedInline</span><span class="p">)</span>
</code></pre></div>
<p>Así es como se vería en nuestro ejemplo de tareas, no se nota mucho porque sólo tenemos un campo:</p>
<div class="image">
    <img src="/cdn/django/django_inlines_2.png"/>
</div>

<p>Lo que hemos hecho en el panel de administrador está muy bien, pero ¿sé podrá hacer en nuestras propias vistas? Veamos cómo se hace.</p>
<p>En nuestra aplicación ya tenemos un formulario para editar personas, es el siguiente:</p>
<p><code>view.py</code>
<div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">edit</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">persona_id</span><span class="p">):</span>
    <span class="n">instancia</span> <span class="o">=</span> <span class="n">Persona</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="n">persona_id</span><span class="p">)</span>
    <span class="n">form</span> <span class="o">=</span> <span class="n">PersonaForm</span><span class="p">(</span><span class="n">instance</span><span class="o">=</span><span class="n">instancia</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">method</span> <span class="o">==</span> <span class="s2">&quot;POST&quot;</span><span class="p">:</span>
        <span class="n">form</span> <span class="o">=</span> <span class="n">PersonaForm</span><span class="p">(</span><span class="n">request</span><span class="o">.</span><span class="n">POST</span><span class="p">,</span> <span class="n">instance</span><span class="o">=</span><span class="n">instancia</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">form</span><span class="o">.</span><span class="n">is_valid</span><span class="p">():</span>
            <span class="n">instancia</span> <span class="o">=</span> <span class="n">form</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">commit</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
            <span class="n">instancia</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">render</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="s2">&quot;core/edit.html&quot;</span><span class="p">,</span> <span class="p">{</span><span class="s1">&#39;form&#39;</span><span class="p">:</span> <span class="n">form</span><span class="p">})</span>
</code></pre></div></p>
<p>Lo tengo perfectamente documentado en el otro tutorial y se ve de esta forma:</p>
<div class="image">
    <img src="/cdn/django/django_inlines_3.png"/>
</div>

<p>Nuestro objetivo es mostrar debajo los <strong>inline</strong> igual que hacemos en el panel de administrador.</p>
<p>Para ello necesitamos contar con un formulario para manejar las instancias de <strong>Tarea</strong> y luego registrarlo como componente para un <strong>inline form</strong>, algo que haremos haciendo uso de un modelo de Django llamado <strong>inlineformset_factory</strong>:</p>
<p><code>forms.py</code>
<div class="highlight"><pre><span></span><code><span class="kn">from</span> <span class="nn">django.forms</span> <span class="kn">import</span> <span class="n">ModelForm</span>
<span class="kn">from</span> <span class="nn">django.forms.models</span> <span class="kn">import</span> <span class="n">inlineformset_factory</span>
<span class="kn">from</span> <span class="nn">.models</span> <span class="kn">import</span> <span class="n">Persona</span><span class="p">,</span> <span class="n">Tarea</span>

<span class="k">class</span> <span class="nc">PersonaForm</span><span class="p">(</span><span class="n">ModelForm</span><span class="p">):</span>
    <span class="k">class</span> <span class="nc">Meta</span><span class="p">:</span>
        <span class="n">model</span> <span class="o">=</span> <span class="n">Persona</span>
        <span class="n">fields</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;nombre&#39;</span><span class="p">,</span> <span class="s1">&#39;edad&#39;</span><span class="p">]</span>

<span class="k">class</span> <span class="nc">TareaForm</span><span class="p">(</span><span class="n">ModelForm</span><span class="p">):</span>
    <span class="k">class</span> <span class="nc">Meta</span><span class="p">:</span>
        <span class="n">model</span> <span class="o">=</span> <span class="n">Tarea</span>
        <span class="n">fields</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;nombre&#39;</span><span class="p">]</span>

<span class="c1"># Aquí registramos nuestro inline formset</span>
<span class="n">TareasInlineFormSet</span> <span class="o">=</span> <span class="n">inlineformset_factory</span><span class="p">(</span>
    <span class="n">Persona</span><span class="p">,</span> <span class="n">Tarea</span><span class="p">,</span> <span class="n">form</span><span class="o">=</span><span class="n">TareaForm</span><span class="p">,</span> 
    <span class="n">extra</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">can_delete</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</code></pre></div></p>
<p>Básicamente le estamos diciendo que nuestro formset está formado por los modelos <strong>Persona</strong> haciendo de padre y <strong>Tarea</strong> de hijo, mostrándose estos últimos con el formulario <strong>TareaForm</strong> con dos huecos y la opción de borrar las tareas habilitada.</p>
<p>Ahora viene la parte importante, tenemos que hacer uso de este inline en la vista <strong>edit</strong>, recuperar sus datos y guardarlos cuando se reciben:</p>
<p><code>view.py</code>
<div class="highlight"><pre><span></span><code><span class="kn">from</span> <span class="nn">.forms</span> <span class="kn">import</span> <span class="n">PersonaForm</span><span class="p">,</span> <span class="n">TareasInlineFormSet</span>

<span class="k">def</span> <span class="nf">edit</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">persona_id</span><span class="p">):</span>
    <span class="n">instancia</span> <span class="o">=</span> <span class="n">Persona</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="n">persona_id</span><span class="p">)</span>
    <span class="n">form</span> <span class="o">=</span> <span class="n">PersonaForm</span><span class="p">(</span><span class="n">instance</span><span class="o">=</span><span class="n">instancia</span><span class="p">)</span>

    <span class="c1"># Creamos el formset de tareas con los datos de la instancia</span>
    <span class="n">formset</span> <span class="o">=</span> <span class="n">TareasInlineFormSet</span><span class="p">(</span><span class="n">instance</span><span class="o">=</span><span class="n">instancia</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">method</span> <span class="o">==</span> <span class="s2">&quot;POST&quot;</span><span class="p">:</span>
        <span class="n">form</span> <span class="o">=</span> <span class="n">PersonaForm</span><span class="p">(</span><span class="n">request</span><span class="o">.</span><span class="n">POST</span><span class="p">,</span> <span class="n">instance</span><span class="o">=</span><span class="n">instancia</span><span class="p">)</span>

        <span class="c1"># Actualizamos también los datos del formset de tareas</span>
        <span class="n">formset</span> <span class="o">=</span> <span class="n">TareasInlineFormSet</span><span class="p">(</span><span class="n">request</span><span class="o">.</span><span class="n">POST</span><span class="p">,</span> <span class="n">instance</span><span class="o">=</span><span class="n">instancia</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">form</span><span class="o">.</span><span class="n">is_valid</span><span class="p">():</span>

            <span class="n">instancia</span> <span class="o">=</span> <span class="n">form</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">commit</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
            <span class="n">instancia</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>

            <span class="c1"># Guardamos también el formset si es válido</span>
            <span class="k">if</span> <span class="n">formset</span><span class="o">.</span><span class="n">is_valid</span><span class="p">():</span>
                <span class="n">formset</span><span class="o">.</span><span class="n">instance</span> <span class="o">=</span> <span class="n">instancia</span>
                <span class="n">formset</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>

            <span class="c1"># Actualizamos la pantalla del formulario</span>
            <span class="k">return</span> <span class="n">redirect</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;/edit/</span><span class="si">{</span><span class="n">instancia</span><span class="o">.</span><span class="n">id</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>

    <span class="c1"># Si llegamos al final renderizamos el formulario y el formset</span>
    <span class="k">return</span> <span class="n">render</span><span class="p">(</span>
        <span class="n">request</span><span class="p">,</span> <span class="s2">&quot;core/edit.html&quot;</span><span class="p">,</span> <span class="p">{</span><span class="s1">&#39;form&#39;</span><span class="p">:</span> <span class="n">form</span><span class="p">,</span> <span class="s1">&#39;formset&#39;</span><span class="p">:</span> <span class="n">formset</span><span class="p">})</span>
</code></pre></div></p>
<p>Como véis es cuestión de repetir lo mismo pero con el <strong>formset</strong> como si fuera otro formulario cualquiera.</p>
<p>En este punto nos faltaría sólo añadir renderizar los inlines en el HTML, lo podemos hacer recorriendo con un for el <strong>formset</strong> que enviamos, pues en realidad es una colección de subformularios:</p>
<p><code>edit.html</code>
<div class="highlight"><pre><span></span><code><span class="p">&lt;</span><span class="nt">form</span> <span class="na">method</span><span class="o">=</span><span class="s">&quot;POST&quot;</span><span class="p">&gt;</span>
  {{ form.as_p }}
  {% csrf_token %} 

  <span class="p">&lt;</span><span class="nt">h3</span><span class="p">&gt;</span>Lista de tareas<span class="p">&lt;/</span><span class="nt">h3</span><span class="p">&gt;</span>

  {% for form_tarea in formset %}
    {{ form_tarea }} <span class="p">&lt;</span><span class="nt">br</span> <span class="p">/&gt;</span>
  {% endfor %}

  <span class="cm">&lt;!-- Este miniformulario maneja el inline --&gt;</span>
  {{ formset.management_form }}

  <span class="p">&lt;</span><span class="nt">br</span><span class="p">&gt;&lt;</span><span class="nt">button</span> <span class="na">type</span><span class="o">=</span><span class="s">&quot;submit&quot;</span><span class="p">&gt;</span>Editar<span class="p">&lt;/</span><span class="nt">button</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">form</span><span class="p">&gt;</span>
</code></pre></div></p>
<p>Es extremadamente importante renderizar el <strong>management_form</strong>, ya que de forma oculta se encarga de manejar todos los subformilarios del inline y sin él no funcionaría nada.</p>
<p>Sea como sea con esto deberíamos tener los inlines funcionando perfectamente en nuestro formulario de edición:</p>
<div class="image">
    <img src="/cdn/django/django_inlines_4.gif"/>
</div>

<h2 id="django-en-ubuntu-server-con-nginx-gunicorn-y-supervisor">Django en Ubuntu Server con Nginx, Gunicorn y Supervisor<a class="headerlink" href="#django-en-ubuntu-server-con-nginx-gunicorn-y-supervisor" title="Permanent link">&para;</a></h2>
<p>Hoy camparto con vosotros este tutorial para los interesados en aprender a desplegar Django en GNU/Linux de una forma cómoda y sencilla.</p>
<p>A continuación os resumo para qué sirve cada uno de los componentes que se utilizan en un despliegue genérico.</p>
<ul>
<li><strong>Gunicorn</strong>: Green Unicorn es un servidor WSGI HTTP para Python (pre-fork de unicorn de ruby). Consume poco y es bastante rápido.</li>
<li><strong>Nginx</strong>: Es un servidor web/proxy inverso ligero de alto rendimiento y un proxy para protocolos de correo electrónico. Nos ayudará a servir ficheros estáticos.</li>
<li><strong>Supervisor</strong>: Es un gestor de procesos para Linux. Nos permitirá crear un proceso en segundo plano de nuestro servidor gunicorn.</li>
</ul>
<p><strong>Requisitos</strong> </p>
<ul>
<li>Servidor con Nginx.</li>
<li>Python 3.</li>
<li>Proyecto Django ya listo para desplegar.</li>
<li>Borrar del fichero <strong>urls.py</strong> que Django sirva los ficheros estáticos al desactivar el <strong>DEBUG</strong>.</li>
<li>Tener configurada la variable con el directorio de los ficheros estáticos <strong>STATIC_ROOT</strong> en el <strong>settings.py</strong>:</li>
</ul>
<p><code>proyecto/settings.py</code>
<div class="highlight"><pre><span></span><code><span class="c1"># Añadir esta línea abajo del todo dependiendo de vuestro directorio</span>
<span class="n">STATIC_ROOT</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">BASE_DIR</span><span class="p">,</span> <span class="s1">&#39;static&#39;</span><span class="p">)</span> 
</code></pre></div></p>
<p>Suponiendo que vuestro proyecto lo tendréis en <strong>dominio.com</strong> os recomiendo clonar el repositorio en la ruta <strong>/var/www/dominio.com/</strong>.</p>
<p>Ahora aseguraos de tener un fichero <strong>requirements.txt</strong> con las dependencias del proyecto en <strong>/var/www/dominio.com/requirements.txt</strong> y si no tenéis dependencias como mínimo que contenga a Django:</p>
<p><code>requirements.txt</code>
<div class="highlight"><pre><span></span><code>django
</code></pre></div></p>
<p>Ahora vamos a instalar <strong>Pipenv</strong> para crear nuestro entorno virtual, para ello necesitamos <strong>Pip</strong> en <strong>Python 3</strong>:</p>
<div class="highlight"><pre><span></span><code>sudo apt install python3-pip
pip3 install pipenv
</code></pre></div>
<p>El siguiente paso es crear el entorno e instalar las dependencias, fácil:</p>
<div class="highlight"><pre><span></span><code><span class="nb">cd</span> /var/www/dominio.com
pipenv install -r requirements.txt
</code></pre></div>
<p>Con esto ya deberíamos tener nuestro entorno creado, vamos a dejar anotada la ruta del <strong>python</strong> del entorno porque más adelante la necesitaremos, podemos consultar haciendo:</p>
<div class="highlight"><pre><span></span><code>pipenv run which python
</code></pre></div>
<p>Os debería aparecer algo de este estilo dependiendo de vuestro usuario, que debería ser el administrador (aunque yo estoy haciendo el tutorial directamente con root):</p>
<div class="highlight"><pre><span></span><code>/root/.local/share/virtualenvs/dominio.com-EZwa4jqa/bin/python
</code></pre></div>
<p>Dejadlo copiado en alguna parte.</p>
<p>En este punto deberíamos tener el proyecto funcionando, quizá tendréis que configurar una base de datos pero en eso no me voy a meter, en este tutorial daremos por hecho que usamos SQLite para hacerlo más sencillo:</p>
<div class="highlight"><pre><span></span><code>pipenv run python manage.py migrate
</code></pre></div>
<p>Recopilamos los ficheros estáticos de las diferentes apps en el directorio static del proyecto (hay que hacerlo siempre que modifiquemos alguno), recordad tener configurada la variable <strong>STATIC_ROOT</strong> tal como indico arriba en los requisitos. Esto es necesario para que <strong>Nginx</strong> pueda servirlos correctamente:</p>
<div class="highlight"><pre><span></span><code>pipenv run python manage.py collectstatic
</code></pre></div>
<p>Cualquier comando que debáis ejecutar recordad hacerlo con <strong>pipenv run</strong> para hacer referencia al Python del entorno virtual.</p>
<p>Tenemos el proyecto de Django preparado pero necesitamos un servidor para manejarlo, para ello vamos a utilizar <strong>gunicorn</strong>.</p>
<div class="highlight"><pre><span></span><code><span class="nb">cd</span> /var/www/dominio.com
pipenv install gunicorn
</code></pre></div>
<p>Vamos a probar si se lanza correctamente desde la raíz, justo donde está el <strong>manage.py</strong> (el puerto podéis cambiarlo): </p>
<div class="highlight"><pre><span></span><code><span class="nb">cd</span> /var/www/dominio.com
pipenv run gunicorn proyecto.wsgi:application --bind<span class="o">=</span><span class="m">127</span>.0.0.1:8000
</code></pre></div>
<p>Si se muestra el mensaje típico de <strong>Listening at: http://127.0.0.1:8000</strong> podemos hacer <strong>Control + C</strong> y confirmar que está funcionando bien.</p>
<p>El siguiente paso es mantener activo ese servidor de <strong>gunicorn</strong> en segundo plano, para ello usaremos el gestor de procesos <strong>Supervisor</strong>. </p>
<div class="highlight"><pre><span></span><code>sudo apt install supervisor
</code></pre></div>
<p>Ahora tenemos que crear un fichero de configuración para nuestro proyecto:</p>
<p><div class="highlight"><pre><span></span><code>sudo nano /etc/supervisor/conf.d/dominio.com.conf
</code></pre></div>
En él añadiremos esta simple configuración, recuperando ya la ruta al <strong>python</strong> de nuestro entorno virtual, la que copiamos anteriormente (atención al identificador único de vuestro entorno virtual):</p>
<p><code>/etc/supervisor/conf.d/dominio.com.conf</code>
<div class="highlight"><pre><span></span><code>[program:dominio.com]
command = /root/.local/share/virtualenvs/dominio.com-EZwa4jqa/bin/python /root/.local/share/virtualenvs/dominio.com-EZwa4jqa/bin/gunicorn proyecto.wsgi:application --bind=127.0.0.1:8000
directory = /var/www/dominio.com/proyecto
user = root
</code></pre></div></p>
<p>Es muy importante poner correctamente las rutas a <strong>python</strong> y a <strong>gunicorn</strong> del entorno virtual para crear correctamente el comando con los ejecutables de ambos programas en el entorno. El usuario tiene que ser el vuestro o <strong>root</strong>, pero debe tener los permisos adecuados. Además si queremos tener varios Django funcionando tendremos que ponerlos en puertos diferentes, por ejemplo 8000, 8001, 8002 o los que queramos.</p>
<p>Para manejar el proceso debemos actualizar los cambios y activar el proyecto en <strong>supervisor</strong>:</p>
<div class="highlight"><pre><span></span><code>sudo supervisorctl reread
sudo supervisorctl update
sudo supervisorctl start dominio.com
</code></pre></div>
<p>Con esto deberíamos tener <strong>gunicorn</strong> ejecutando <strong>Django</strong> en el puerto 8000 del sistema, ya sólo nos queda configurar un server block de <strong>Nginx</strong> haciendo de proxy reverso para enlazarlo a un dominio/subdominio y servir los ficheros estáticos.</p>
<p>Todas las acciones para manejar el proceso que ejecuta nuestro proyecto se pueden encontrar en la <a href="http://supervisord.org/running.html#supervisorctl-actions">documentación de Supervisor</a>. Los más comunes son:</p>
<ul>
<li><strong>reread</strong>: Recarga las configuraciones de los procesos.</li>
<li><strong>update</strong>: Rearga las configuraciones y reinicia los procesos afectados.</li>
<li><strong>start</strong>: Para iniciar un proceso.</li>
<li><strong>stop</strong>: Para detener un proceso.</li>
<li><strong>restart</strong>: Para reiniciar un proceso, algo necesario para actualizar los cambios al modificar el proyecto de Django:</li>
</ul>
<div class="highlight"><pre><span></span><code>sudo supervisorctl restart dominio.com
</code></pre></div>
<p>En este punto deberías poder hacer una petición con <strong>cURL</strong> y ver que efectivamente os devuelve índice de vuestra página:</p>
<div class="highlight"><pre><span></span><code>curl http://127.0.0.1:8000
</code></pre></div>
<p>Os voy a dejar la configuración genérica del sitio funcionando en un dominio en el puerto 80 no seguro y sirviendo los ficheros estáticos. Es vuestra tarea adaptarla y añadir un certificado tal como explico en el <a href="https://www.hektorprofe.net/curso/guia-configuracion-ubuntu-server">curso de configuración básica de Ubuntu Server</a>.</p>
<p>Primero vamos a crear un directorio para almacenar los <strong>logs</strong> de <strong>nginx</strong>:</p>
<div class="highlight"><pre><span></span><code><span class="nb">cd</span> /var/www/dominio.com
mkdir logs
</code></pre></div>
<p>Ahora creamos el <strong>server block</strong> del sitio:</p>
<div class="highlight"><pre><span></span><code>sudo nano /etc/nginx/sites-available/dominio.com
</code></pre></div>
<p>Esta es la configuración básica:</p>
<p><code>/etc/nginx/sites-available/dominio.com</code>
<div class="highlight"><pre><span></span><code>server {

    # Puerto y nombre
    listen 80;
    server_name dominio.com www.dominio.com;

    # Logs de nginx
    access_log /var/www/dominio.com/logs/nginx.access.log;
    error_log  /var/www/dominio.com/logs/nginx.error.log;

    # Ficheros estáticos
    location /static/ {
        alias /var/www/dominio.com/static/;
        expires 365d;
    }

    # Proxy reverso del puerto 8000
    location / {
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
        proxy_read_timeout 1m;
        proxy_connect_timeout 1m;
        proxy_pass http://127.0.0.1:8000;
    }

}
</code></pre></div></p>
<p>Guardamos y creamos un enlace simbólico:</p>
<div class="highlight"><pre><span></span><code><span class="nb">cd</span> /etc/nginx/sites-enabled
sudo ln -s ../sites-available/dominio.com
</code></pre></div>
<p>Finalmente reiniciamos nginx:</p>
<div class="highlight"><pre><span></span><code>sudo service nginx restart
</code></pre></div>
<p>Si tenéis configurados los ficheros media en Django en el directorio <strong>media</strong> del proyecto, podéis añadir lo siguiente en la configuración (cortesía de RulezCore):</p>
<div class="highlight"><pre><span></span><code># Media
location /media/ {
    alias /var/www/dominio.com/media/;
}
</code></pre></div>
<p>Y ya deberíamos tener funcionando Django en <a href="http://dominio.com">http://dominio.com</a> cargando correctamente los ficheros estáticos.</p>
<p>Para profundizar más sobre las opciones de configuración, como crear registros de errores y todo éso os dejo las documentaciones oficiales:</p>
<ul>
<li><a href="http://docs.gunicorn.org/en/develop/configure.html#config-file">Documentación de Gunicorn</a>.</li>
<li><a href="https://library.linode.com/web-servers/nginx/configuration/basic">Documentación de Nginx</a>.</li>
<li><a href="http://supervisord.org/configuration.html">Documentación de Supervisor</a>.</li>
</ul>
<p>¡Espero que os sirva!</p>
<hr />
<p><small class="edited"><i>Última edición: 16 de Marzo de 2021</i></small></p>
                
                  
                
              
              
                


              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
  <div class="md-footer-nav">
    <nav class="md-footer-nav__inner md-grid">
      
      <a
        href="../api-rest-framework/"
        title="Proyecto API con DRF"
        class="md-flex md-footer-nav__link md-footer-nav__link--prev"
        rel="prev"
      >
        <div class="md-flex__cell md-flex__cell--shrink">
          <i class="md-icon md-icon--arrow-back md-footer-nav__button"></i>
        </div>
        <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
          <span class="md-flex__ellipsis">
            <span class="md-footer-nav__direction">
              Anterior
            </span>
            Proyecto API con DRF
          </span>
        </div>
      </a>
       
      <a
        href="../../javascript/introduccion/"
        title="Introducción a JavaScript"
        class="md-flex md-footer-nav__link md-footer-nav__link--next"
        rel="next"
      >
        <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
          <span class="md-flex__ellipsis">
            <span class="md-footer-nav__direction">
              Siguiente
            </span>
            Introducción a JavaScript
          </span>
        </div>
        <div class="md-flex__cell md-flex__cell--shrink">
          <i class="md-icon md-icon--arrow-forward md-footer-nav__button"></i>
        </div>
      </a>
      
    </nav>
  </div>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        <!--<div class="md-footer-links__highlight">
          <a href="/comunidad/">Comunidad</a> · <a href="/politica-de-cookies/">Política de cookies</a> · <a href="/sobre-mi/">Sobre mí</a>
        </div>-->
        <div class="md-footer-copyright__highlight">
          2015 - 2022 &copy; Héctor Costa Guzmán (<u
            ><a
              href="https://creativecommons.org/licenses/by/4.0/deed.es"
              target="_blank"
              rel="nofollow"
              >Licencia CC BY 4.0</a
            ></u
          >)
        </div>
      </div>
       
<style>.md-footer-social__link {transition: 0.3s;}</style>
<div class="md-footer-social" style="font-size: 2.5rem; margin-top: -6px!important; padding: 0px!important; margin-bottom: -6px; overflow: hidden!important;">
  <a href="https://github.com/hcosta" title="Github" target="_blank" class="md-footer-social__link fa fa-github-square"></a>
  <a href="https://www.youtube.com/c/HektorProfe" title="Youtube" target="_blank" class="md-footer-social__link fa fa-youtube-square"></a>
  &nbsp;
</div>
 
    </div>
  </div>
  <script>
    (function (i, s, o, g, r, a, m) {
      i["GoogleAnalyticsObject"] = r;
      (i[r] =
        i[r] ||
        function () {
          (i[r].q = i[r].q || []).push(arguments);
        }),
        (i[r].l = 1 * new Date());
      (a = s.createElement(o)), (m = s.getElementsByTagName(o)[0]);
      a.async = 1;
      a.src = g;
      m.parentNode.insertBefore(a, m);
    })(
      window,
      document,
      "script",
      "https://www.google-analytics.com/analytics.js",
      "ga"
    );
    ga("create", "UA-124845547-1", "auto");
    ga("send", "pageview");
  </script>
</footer>
      
      <a id="anchorID" href="https://www.hektorprofe.net/" target="_blank"></a>
    </div>
  <script type='text/javascript' src="/assets/javascripts/application.a26c1c21.js"></script>
  <script src="/assets/javascripts/tingle.min.js"></script>
  <script type='text/javascript'>
    var modalButtonOnly = new tingle.modal({
        closeMethods: [],
        footer: true,
        stickyFooter: true
    });
    var btn5 = document.querySelector('.js-tingle-modal-5');

    // set content
    modalButtonOnly.setContent(`
    <div style="display:grid;grid-template-columns:32% 32% 32%;grid-column-gap: 1.33%;" id="supermodal">
      <div class="course">
        <a href="https://www.hektorprofe.net/cupon/python" target="_blank"><img src="/cdn/assets/python.png" style="width:100%;justify-self:center;align-self:center;"/></a>
      </div>
      <div class="course">
        <a href="https://www.hektorprofe.net/cupon/django" target="_blank"><img src="/cdn/assets/django.png" style="width:100%;justify-self:center;align-self:center;"/></a>
      </div>
      <div class="course">
        <a href="https://www.hektorprofe.net/cupon/pyside" target="_blank"><img src="/cdn/assets/pyside.png" style="width:100%;justify-self:center;align-self:center;"/></a>
      </div>
    </div>`);

    modalButtonOnly.addFooterBtn('Cerrar', 'tingle-btn tingle-btn--default tingle-btn--pull-right', function(){
      modalButtonOnly.close();
    });

    app.initialize({version:"1.2.3",url:{base:"../../.."}})
    var _extends=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var o in n)Object.prototype.hasOwnProperty.call(n,o)&&(t[o]=n[o])}return t},_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t};!function(t,e){"object"===("undefined"==typeof exports?"undefined":_typeof(exports))&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):t.LazyLoad=e()}(this,function(){"use strict";function t(t,e,n){var o=e._settings;!n&&i(t)||(C(o.callback_enter,t),R.indexOf(t.tagName)>-1&&(N(t,e),I(t,o.class_loading)),E(t,e),a(t),C(o.callback_set,t))}var e={elements_selector:"img",container:document,threshold:300,thresholds:null,data_src:"src",data_srcset:"srcset",data_sizes:"sizes",data_bg:"bg",class_loading:"loading",class_loaded:"loaded",class_error:"error",load_delay:0,callback_load:null,callback_error:null,callback_set:null,callback_enter:null,callback_finish:null,to_webp:!1},n=function(t){return _extends({},e,t)},o=function(t,e){return t.getAttribute("data-"+e)},r=function(t,e,n){var o="data-"+e;null!==n?t.setAttribute(o,n):t.removeAttribute(o)},a=function(t){return r(t,"was-processed","true")},i=function(t){return"true"===o(t,"was-processed")},s=function(t,e){return r(t,"ll-timeout",e)},c=function(t){return o(t,"ll-timeout")},l=function(t){return t.filter(function(t){return!i(t)})},u=function(t,e){return t.filter(function(t){return t!==e})},d=function(t,e){var n,o=new t(e);try{n=new CustomEvent("LazyLoad::Initialized",{detail:{instance:o}})}catch(t){(n=document.createEvent("CustomEvent")).initCustomEvent("LazyLoad::Initialized",!1,!1,{instance:o})}window.dispatchEvent(n)},f=function(t,e){return e?t.replace(/\.(jpe?g|png)/gi,".webp"):t},_="undefined"!=typeof window,v=_&&!("onscroll"in window)||/(gle|ing|ro)bot|crawl|spider/i.test(navigator.userAgent),g=_&&"IntersectionObserver"in window,h=_&&"classList"in document.createElement("p"),b=_&&function(){var t=document.createElement("canvas");return!(!t.getContext||!t.getContext("2d"))&&0===t.toDataURL("image/webp").indexOf("data:image/webp")}(),m=function(t,e,n,r){for(var a,i=0;a=t.children[i];i+=1)if("SOURCE"===a.tagName){var s=o(a,n);p(a,e,s,r)}},p=function(t,e,n,o){n&&t.setAttribute(e,f(n,o))},y=function(t,e){var n=b&&e.to_webp,r=o(t,e.data_src),a=o(t,e.data_bg);if(r){var i=f(r,n);t.style.backgroundImage='url("'+i+'")'}if(a){var s=f(a,n);t.style.backgroundImage=s}},w={IMG:function(t,e){var n=b&&e.to_webp,r=e.data_srcset,a=t.parentNode;a&&"PICTURE"===a.tagName&&m(a,"srcset",r,n);var i=o(t,e.data_sizes);p(t,"sizes",i);var s=o(t,r);p(t,"srcset",s,n);var c=o(t,e.data_src);p(t,"src",c,n)},IFRAME:function(t,e){var n=o(t,e.data_src);p(t,"src",n)},VIDEO:function(t,e){var n=e.data_src,r=o(t,n);m(t,"src",n),p(t,"src",r),t.load()}},E=function(t,e){var n=e._settings,o=t.tagName,r=w[o];if(r)return r(t,n),e._updateLoadingCount(1),void(e._elements=u(e._elements,t));y(t,n)},I=function(t,e){h?t.classList.add(e):t.className+=(t.className?" ":"")+e},L=function(t,e){h?t.classList.remove(e):t.className=t.className.replace(new RegExp("(^|\\s+)"+e+"(\\s+|$)")," ").replace(/^\s+/,"").replace(/\s+$/,"")},C=function(t,e){t&&t(e)},O=function(t,e,n){t.addEventListener(e,n)},k=function(t,e,n){t.removeEventListener(e,n)},x=function(t,e,n){O(t,"load",e),O(t,"loadeddata",e),O(t,"error",n)},A=function(t,e,n){k(t,"load",e),k(t,"loadeddata",e),k(t,"error",n)},z=function(t,e,n){var o=n._settings,r=e?o.class_loaded:o.class_error,a=e?o.callback_load:o.callback_error,i=t.target;L(i,o.class_loading),I(i,r),C(a,i),n._updateLoadingCount(-1)},N=function(t,e){var n=function n(r){z(r,!0,e),A(t,n,o)},o=function o(r){z(r,!1,e),A(t,n,o)};x(t,n,o)},R=["IMG","IFRAME","VIDEO"],S=function(e,n,o){t(e,o),n.unobserve(e)},M=function(t){var e=c(t);e&&(clearTimeout(e),s(t,null))},j=function(t,e,n){var o=n._settings.load_delay,r=c(t);r||(r=setTimeout(function(){S(t,e,n),M(t)},o),s(t,r))},D=function(t){return t.isIntersecting||t.intersectionRatio>0},T=function(t){return{root:t.container===document?null:t.container,rootMargin:t.thresholds||t.threshold+"px"}},U=function(t,e){this._settings=n(t),this._setObserver(),this._loadingCount=0,this.update(e)};return U.prototype={_manageIntersection:function(t){var e=this._observer,n=this._settings.load_delay,o=t.target;n?D(t)?j(o,e,this):M(o):D(t)&&S(o,e,this)},_onIntersection:function(t){t.forEach(this._manageIntersection.bind(this))},_setObserver:function(){g&&(this._observer=new IntersectionObserver(this._onIntersection.bind(this),T(this._settings)))},_updateLoadingCount:function(t){this._loadingCount+=t,0===this._elements.length&&0===this._loadingCount&&C(this._settings.callback_finish)},update:function(t){var e=this,n=this._settings,o=t||n.container.querySelectorAll(n.elements_selector);this._elements=l(Array.prototype.slice.call(o)),!v&&this._observer?this._elements.forEach(function(t){e._observer.observe(t)}):this.loadAll()},destroy:function(){var t=this;this._observer&&(this._elements.forEach(function(e){t._observer.unobserve(e)}),this._observer=null),this._elements=null,this._settings=null},load:function(e,n){t(e,this,n)},loadAll:function(){var t=this;this._elements.forEach(function(e){t.load(e)})}},_&&function(t,e){if(e)if(e.length)for(var n,o=0;n=e[o];o+=1)d(t,n);else d(t,e)}(U,window.lazyLoadOptions),U});
    var myLazyLoad = new LazyLoad({elements_selector: ".lazy"});
    const mdMenuItems = document.querySelectorAll('.md-nav__link');
    function doNav(){ document.getElementById("main__list").innerHTML = '<li class="md-nav__item"><a class="md-nav__link" href="/cursos/">Cursos</a></li><li class="md-nav__item"><a class="md-nav__link" href="/blog/">Blog</a></li>';}
    for (i = 0; i < mdMenuItems.length; i++) {  var item = mdMenuItems[i]; var htmlstring = item.innerHTML; htmlstring = (htmlstring.trim) ? htmlstring.trim() : htmlstring.replace(/^\s+/,''); if (htmlstring == 'Servidor de encuentro') { item.parentNode.removeChild(item);continue; }  if (htmlstring == 'Política de Cookies') { item.parentNode.removeChild(item);continue; } if (htmlstring == 'Buscador') { item.parentNode.removeChild(item); continue; } }
    try { var topPos = document.querySelector('#md__active_link').offsetTop; document.querySelector('#md__sidebar__scroll').scrollTop = topPos - 60; } catch (err) {}
  </script>
  </body>
</html>