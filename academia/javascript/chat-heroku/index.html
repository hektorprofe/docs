<!DOCTYPE html>
<html lang="es" class="no-js">
  <head>
    
    
    
    

    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      <meta http-equiv="x-ua-compatible" content="ie=edge">
      
        <meta name="description" content="Desarrolla paso a paso tu propio chat online; el servidor con Node.js, el cliente con jQuery y el despliegue en internet gratis con Heroku.">
      
      
        <link rel="canonical" href="https://docs.hektorprofe.net/academia/javascript/chat-heroku/">
      
      
        <meta name="author" content="Héctor Costa Guzman">
      
      <link rel="shortcut icon" href="/favicon.ico">
    
    
      
        <title>Chat online y despliegue en Heroku | JavaScript | Academia | Hektor Profe</title>
      
    
    <link rel="stylesheet" href="../../../assets/stylesheets/application.2.css">
    
      
        <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700|Roboto+Mono">
        <style>body,input{font-family:"Roboto","Helvetica Neue",Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono","Courier New",Courier,monospace}</style>
      
    
    
    <link rel="stylesheet" href="/assets/stylesheets/tingle.min.css">
<style>
@font-face{font-family:"Material Icons";font-style:normal;font-weight:400;src:local("Material Icons"),local("MaterialIcons-Regular"),url("/assets/fonts/specimen/MaterialIcons-Regular.woff2") format("woff2"),url("/assets/fonts/specimen/MaterialIcons-Regular.woff") format("woff"),url("/assets/fonts/specimen/MaterialIcons-Regular.ttf") format("truetype")}
[data-md-color-primary="grey"] .md-header { background-color: #191A1D }
[data-md-color-primary="grey"] .md-tabs { background-color: #222831 }
.md-footer-nav { background-color: #222831; }
.md-footer-meta { background-color: #191A1D }
html [data-md-color-primary="grey"] .md-nav--primary .md-nav__title--site { background-color: #191A1D; }
.mini{ display: none; } .maxi{ display: block; }
.embed-container { position: relative; padding-bottom: 56.25%;height: 0; overflow: hidden; max-width: 100%; height: auto; margin-bottom: 0; } 
.embed-container iframe, .embed-container object, .embed-container embed { position: absolute; top: 0; left: 0; width: 100%; height: 100%; }
.md-nav__link:focus, .md-nav__link:hover { color: #018dc5; }
.headerlink{ color: #018dc5 !important; }
.md-footer-links__highlight a{ color: #777 !important; }
.md-footer-links__highlight a:hover{ color: #ddd !important; }
.visible{ display: inherit !important; }
/*.md-tabs { display: none !important; }*/
.nav__btn, .nav__logo{ transition: 0.3s; }
.nav__btn:hover{ color: #aaa; }
.nav__logo:hover{ opacity:.7; }
.nav__logo {max-width: 225px !important; }
img:not([src]){visibility:hidden;}
img.click{opacity: 0.96;box-shadow:rgb(79, 82, 92) -4px 4px}
img.click:hover{opacity: 1;box-shadow:rgb(10, 172, 237) -4px 4px}
.button { background-color: #36bf2d; border: none; color: white !important; padding: 20px 0px; text-align: center; text-decoration: none; display: block; font-size: 97%; width: 100%; font-weight: bold;}
.button:hover { background-color: #4CAF50; color: white; }
.animated.delay-1dot5s {animation-delay: 1.5s;}
.md-icon--search { display:inline-block!important}
a.headerlink{ display: none !important; }
small.edited { display: block; text-align: right; }
#cookie-bar { padding: 1.8rem 1.25rem !important; background: #191A1D  !important; box-shadow:rgba(0, 0, 0, 0.2) 4px 4px 8px 8px; }
#cookie-bar-prompt-logo{ display: none !important; }
div.my-img{text-align:center;margin-top:20px}
@media (max-width: 76.1875em){ .mini{ display: block; } .maxi{ display: none;} /*.md-nav__link[for="nav-1"] { display: none; }*/ }
@media (min-width: 1599.9px){ .md-header-nav__button.md-logo img { height: 37.5px !important; width: 220px; } }
@media (min-width: 1999.9px){ .md-header-nav__button.md-logo img { height: 40px !important; width: 240px; } }
/* Rectificación footer en paginas pequeñas de altura */
@media (max-width: 1599.8px){ .md-container {height: calc(100% - 48px)} }
@media (min-width: 1599.9px){ .md-container {height: calc(100% - 53px)} }
@media (min-width: 1999.9px){ .md-container {height: calc(100% - 58px)} }
@media only screen and (max-width: 959.9px) { .nav__logo { display: block !important; }} 
@media only screen and (min-width: 960px) and (max-width: 76.1875em) { .nav__logo { display: block !important; }} 
@media only screen and (min-width: 76.1875em) { .nav__logo { display: none !important; } } 
@media only screen and (max-width: 76.1875em) { .md-sidebar--primary { left: -26.2rem;; width: 26.2rem; }  [data-md-toggle="drawer"]:checked ~ .md-container .md-sidebar--primary { -webkit-transform: translateX(26.2rem); transform: translateX(26.2rem); } [dir="rtl"] [data-md-toggle="drawer"]:checked ~ .md-container .md-sidebar--primary { -webkit-transform: translateX(-26.2rem); transform: translateX(-26.2rem); } }
@media (min-width: 1219.9px){ #home__btn { display: none !important; } #cursos__btn{ color: white !important; } [data-md-color-primary="grey"] .md-nav__link--active{ color: rgba(0, 0, 0, 0.87); text-decoration: underline !important; } }
@media (min-width: 467.9px){ #discord__btn{ display: inline-block !important; } }
@media only screen and (min-width: 60em){ .md-search__input { background-color: rgb(53, 54, 56); } .md-search__input:hover { background-color: rgb(84, 87, 93); color: white; }}
@media (max-width: 1219.9px){ .md-header-nav__title{ padding: 0 1rem; } .nav__btn {display:none;} }
@media (max-width: 875.9px){ #cookie-bar-button{ margin-top: 20px !important; }}
@media (max-width: 719.9px){ #cookie-bar { padding: 3.25rem 1.25rem; }}
@media (max-width: 512.9px){ #cookie-bar { padding: 2rem 1.25rem; }}

.tingle-modal { font-size:18px !important;}
.tingle-modal-box{ width: 80%; max-width: 1100px; }
.tingle-btn--danger{ background: darkorange !important; }
.tingle-modal-box__content { padding: 3rem 2rem 3rem 3rem;}
@media (max-width: 540px){ .tingle-modal-box{ width: auto; } }
@media (max-width: 849px){ #supermodal{ grid-template-columns:100% !important; }}

.md-sidebar--secondary .md-sidebar__scrollwrap {max-height: calc(100% - 275px - 60px)}
@media (max-width: 1999.9px){.md-sidebar--secondary .md-sidebar__scrollwrap {max-height: calc(100% - 246px - 60px);margin-right:-1px;}}
@media (max-width: 1599.9px){.md-sidebar--secondary .md-sidebar__scrollwrap {max-height: calc(100% - 222px - 60px)}}

</style>
  </head>
  
    
    
    <body dir="ltr" data-md-color-primary="grey" data-md-color-accent="grey">
  
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" data-md-component="overlay" for="__drawer"></label>
    
      <a href="#chat-online-y-despliegue-en-heroku" tabindex="1" class="md-skip">
        Saltar a contenido
      </a>
    
    
      <header
  class="md-header"
  data-md-component="header"
  style="position: inherit !important"
>
  <nav class="md-header-nav md-grid">
    <div class="md-flex">
      <div class="md-flex__cell md-flex__cell--shrink">
        <a
          href="/"
          title="Hektor Profe"
          class="md-header-nav__button md-logo"
          style="font-size: 0px"
        >
          <img
            src="/assets/images/logo.png"
            width="200px"
            height="35px"
            style="margin-top: -5px"
            alt="Hektor Profe"
            title="Hektor Profe"
          />
        </a>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        <label
          class="md-icon md-icon--menu md-header-nav__button"
          for="__drawer"
        ></label>
      </div>
      <div class="md-flex__cell md-flex__cell--stretch">
        <div
          class="md-flex__ellipsis md-header-nav__title"
          data-md-component="title"
          style="text-align: right"
        >
          <!-- https://fontawesome.com/v4.7.0/ -->
          <a 
            class="nav__btn" 
            href="https://www.hektorprofe.net/" 
            style="margin-left:0em;" 
            title="Cursos de Hektor Profe">
            Cursos
          </a>
          <a 
            class="nav__btn" 
            href="https://docs.hektorprofe.net/" 
            style="margin-left:1.4em;" 
            title="Documentos de Hektor Profe">
            Documentos
          </a>
          <a 
            class="nav__btn" 
            href="https://www.hektorprofe.net/portafolio/" 
            style="margin-left:1.4em;" 
            title="Portafolio de Hektor Profe">
            Portafolio
          </a>
          <a href="/"
            ><img
              class="nav__logo"
              src="/assets/images/logo.png"
              width="200px"
              height="35px"
              style="margin: 6px auto 0"
              alt="Hektor Profe"
              title="Hektor Profe"
          /></a>
        </div>
        <style>
          .md-sidebar[data-md-state="lock"] {
            top: 0rem !important;
          }
          .md-tabs {
            display: none !important;
          }
          .hde {
            display: inline-block;
          }
          .admonition.note > .superfences-tabs > label:hover,
          .headerlink {
            color: #018dc5 !important;
          }
          .admonition.info {
            font-size: 100%;
          }
          .admonition.info label {
            font-size: 91%;
          }
          .admonition.note > .admonition-title {
            display: none;
          }
          .image {
            text-align: center;
            margin-top: 25px;
          }
          .contenedor_youtube {
            position: relative !important;
            padding-bottom: 56.25% !important; /*panorámico*/
            padding-top: 0px !important;
            height: 0 !important;
            margin-top: -20px;
            margin-bottom: 25px;
          }
          .contenedor_youtube iframe {
            position: absolute !important;
            top: 0 !important;
            left: 0 !important;
            width: 100% !important;
            height: 100% !important;
          }
        </style>
      </div>
    </div>
  </nav>
</header>
    
    <div class="md-container" style="padding-top: 0px !important;">
      
        
      
      
        

  

<nav class="md-tabs md-tabs--active" data-md-component="tabs">
    <div class="md-tabs__inner md-grid">
      <ul class="md-tabs__list" id="top__tabs">
        
          <li class="md-tabs__item"><a href="javascript://" class="md-tabs__link">&nbsp;</a></li>
        
          <li class="md-tabs__item"><a href="javascript://" class="md-tabs__link">&nbsp;</a></li>
        
          <li class="md-tabs__item"><a href="javascript://" class="md-tabs__link">&nbsp;</a></li>
        
          <li class="md-tabs__item"><a href="javascript://" class="md-tabs__link">&nbsp;</a></li>
        
          <li class="md-tabs__item"><a href="javascript://" class="md-tabs__link">&nbsp;</a></li>
        
          <li class="md-tabs__item"><a href="javascript://" class="md-tabs__link">&nbsp;</a></li>
        
          <li class="md-tabs__item"><a href="javascript://" class="md-tabs__link">&nbsp;</a></li>
        
          <li class="md-tabs__item"><a href="javascript://" class="md-tabs__link">&nbsp;</a></li>
        
          <li class="md-tabs__item"><a href="javascript://" class="md-tabs__link">&nbsp;</a></li>
        
          <li class="md-tabs__item"><a href="javascript://" class="md-tabs__link">&nbsp;</a></li>
        
          <li class="md-tabs__item"><a href="javascript://" class="md-tabs__link">&nbsp;</a></li>
        
          <li class="md-tabs__item"><a href="javascript://" class="md-tabs__link">&nbsp;</a></li>
        
      </ul>
    </div>
</nav>
      
      <main class="md-main">
        <div class="md-main__inner md-grid" data-md-component="container" style="padding-top: 8px !important;">
          
            
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
                <div class="md-sidebar__scrollwrap" id="md__sidebar__scroll">
                  <div class="md-sidebar__inner">
                    <nav class="md-nav md-nav--primary" data-md-level="0">
  <label class="md-nav__title" for="__drawer" style="padding:0 !important;max-height:5.5rem;"></label>
  
  <ul class="md-nav__list" id="main__list" data-md-scrollfix>
    
      
    
        <!-- comprobación extra -->
         
          
          
          

  


  <li class="md-nav__item md-nav__item--active md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-2" type="checkbox" id="nav-2" checked>
    
    <label class="md-nav__link" for="nav-2">
      Academia de programación
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-2">
        Academia de programación
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
            
            
            


  <li class="md-nav__item">
    <a href="../../" title="Índice del archivo" class="md-nav__link">
      Índice del archivo
    </a>
  </li>

        
            
            
            


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-2-2" type="checkbox" id="nav-2-2">
    
    <label class="md-nav__link" for="nav-2-2">
      Lenguaje Python
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-2-2">
        Lenguaje Python
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
            
            
            


  <li class="md-nav__item">
    <a href="../../python/introduccion/" title="Introducción a Python" class="md-nav__link">
      Introducción a Python
    </a>
  </li>

        
            
            
            


  <li class="md-nav__item">
    <a href="../../python/poo-para-interfaces-graficas/" title="POO para interfaces gráficas" class="md-nav__link">
      POO para interfaces gráficas
    </a>
  </li>

        
            
            
            


  <li class="md-nav__item">
    <a href="../../python/proyecto-gestor-clientes/" title="Proyecto gestor de clientes" class="md-nav__link">
      Proyecto gestor de clientes
    </a>
  </li>

        
            
            
            


  <li class="md-nav__item">
    <a href="../../python/tutoriales/" title="Tutoriales sobre Python" class="md-nav__link">
      Tutoriales sobre Python
    </a>
  </li>

        
            
            
            


  <li class="md-nav__item">
    <a href="../../python/modulo-analitico-numpy/" title="Módulo analítico NumPy" class="md-nav__link">
      Módulo analítico NumPy
    </a>
  </li>

        
            
            
            


  <li class="md-nav__item">
    <a href="../../python/modulo-grafico-matplotlib/" title="Módulo gráfico Matplotlib" class="md-nav__link">
      Módulo gráfico Matplotlib
    </a>
  </li>

        
            
            
            


  <li class="md-nav__item">
    <a href="../../django/introduccion/" title="Introducción a Django" class="md-nav__link">
      Introducción a Django
    </a>
  </li>

        
            
            
            


  <li class="md-nav__item">
    <a href="../../django/api-rest-framework/" title="Proyecto API con DRF" class="md-nav__link">
      Proyecto API con DRF
    </a>
  </li>

        
            
            
            


  <li class="md-nav__item">
    <a href="../../django/tutoriales/" title="Tutoriales sobre Django" class="md-nav__link">
      Tutoriales sobre Django
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
            
            
            

  


  <li class="md-nav__item md-nav__item--active md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-2-3" type="checkbox" id="nav-2-3" checked>
    
    <label class="md-nav__link" for="nav-2-3">
      Lenguaje JavaScript
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-2-3">
        Lenguaje JavaScript
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
            
            
            


  <li class="md-nav__item">
    <a href="../introduccion/" title="Introducción a JavaScript" class="md-nav__link">
      Introducción a JavaScript
    </a>
  </li>

        
            
            
            


  <li class="md-nav__item">
    <a href="../conversor-divisas/" title="Proyecto conversor vía API" class="md-nav__link">
      Proyecto conversor vía API
    </a>
  </li>

        
            
            
            


  <li class="md-nav__item">
    <a href="../biblioteca-p5js/" title="Introducción a P5.js" class="md-nav__link">
      Introducción a P5.js
    </a>
  </li>

        
            
            
            


  <li class="md-nav__item">
    <a href="../nodejs/" title="Introducción a Node.js" class="md-nav__link">
      Introducción a Node.js
    </a>
  </li>

        
            
            
            

  


  <li class="md-nav__item md-nav__item--active">
    
    <input class="md-toggle md-nav__toggle" data-md-toggle="toc" type="checkbox" id="__toc">
    
      
    
    
      <label class="md-nav__link md-nav__link--active" for="__toc">
        Proyecto chat online
      </label>
    
    <a href="./" title="Proyecto chat online" class="md-nav__link md-nav__link--active" id="md__active_link">
      Proyecto chat online
    </a>
    
      
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">Tabla de contenidos</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#preparando-el-servidor" title="Preparando el servidor" class="md-nav__link toc__link">
    Preparando el servidor
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#preparando-el-cliente" title="Preparando el cliente" class="md-nav__link toc__link">
    Preparando el cliente
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#conexiones-al-servidor" title="Conexiones al servidor" class="md-nav__link toc__link">
    Conexiones al servidor
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#bienvenida-al-cliente" title="Bienvenida al cliente" class="md-nav__link toc__link">
    Bienvenida al cliente
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#mensajes-al-servidor" title="Mensajes al servidor" class="md-nav__link toc__link">
    Mensajes al servidor
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#difundiendo-el-mensaje" title="Difundiendo el mensaje" class="md-nav__link toc__link">
    Difundiendo el mensaje
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#puliendo-el-cliente" title="Puliendo el cliente" class="md-nav__link toc__link">
    Puliendo el cliente
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#preparando-el-repositorio" title="Preparando el repositorio" class="md-nav__link toc__link">
    Preparando el repositorio
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#realizando-el-despliegue" title="Realizando el despliegue" class="md-nav__link toc__link">
    Realizando el despliegue
  </a>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
    
  </li>

        
            
            
            


  <li class="md-nav__item">
    <a href="../cliente-nuxt/" title="Proyecto cliente Nuxt.js" class="md-nav__link">
      Proyecto cliente Nuxt.js
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
            
            
            


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-2-4" type="checkbox" id="nav-2-4">
    
    <label class="md-nav__link" for="nav-2-4">
      GNU/Linux
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-2-4">
        GNU/Linux
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
            
            
            


  <li class="md-nav__item">
    <a href="../../gnu-linux/ubuntu-server-web/" title="Configurar Ubuntu Server" class="md-nav__link">
      Configurar Ubuntu Server
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
      </ul>
    </nav>
  </li>

        
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
  </ul>
</nav>

                  </div>
                </div>
              </div>
            

            
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
                
                  
                    <div class="course-offer" style="margin-bottom:25px;padding:0px 10px;">
                      <a href="https://www.hektorprofe.net/cupon/python" target="_blank">
                        <img src="/cdn/assets/python.png" style="width:100%;justify-self:center;align-self:center;"/>
                      </a>
                    </div>
                  
                

                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">Tabla de contenidos</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#preparando-el-servidor" title="Preparando el servidor" class="md-nav__link toc__link">
    Preparando el servidor
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#preparando-el-cliente" title="Preparando el cliente" class="md-nav__link toc__link">
    Preparando el cliente
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#conexiones-al-servidor" title="Conexiones al servidor" class="md-nav__link toc__link">
    Conexiones al servidor
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#bienvenida-al-cliente" title="Bienvenida al cliente" class="md-nav__link toc__link">
    Bienvenida al cliente
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#mensajes-al-servidor" title="Mensajes al servidor" class="md-nav__link toc__link">
    Mensajes al servidor
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#difundiendo-el-mensaje" title="Difundiendo el mensaje" class="md-nav__link toc__link">
    Difundiendo el mensaje
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#puliendo-el-cliente" title="Puliendo el cliente" class="md-nav__link toc__link">
    Puliendo el cliente
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#preparando-el-repositorio" title="Preparando el repositorio" class="md-nav__link toc__link">
    Preparando el repositorio
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#realizando-el-despliegue" title="Realizando el despliegue" class="md-nav__link toc__link">
    Realizando el despliegue
  </a>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
                
                
                <h1 id="chat-online-y-despliegue-en-heroku">Chat online y despliegue en Heroku<a class="headerlink" href="#chat-online-y-despliegue-en-heroku" title="Permanent link">&para;</a></h1>
<!-- <div class="contenedor_youtube">
  <iframe width="838" height="470" src="https://www.youtube.com/embed/2UD1y3xwUW4" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>
</div> -->

<p><strong>Demo</strong>: <a href="https://hektorchat.herokuapp.com" target="_blank">https://hektorchat.herokuapp.com</a></p>
<p><strong>Repositorio</strong>: <a href="https://github.com/hektorprofe/chat-node-curso" target="_blank">https://github.com/hektorprofe/chat-node-curso</a></p>
<h2 id="preparando-el-servidor">Preparando el servidor<a class="headerlink" href="#preparando-el-servidor" title="Permanent link">&para;</a></h2>
<p>Vamos a empezar con este proyecto creando por ejemplo una carpeta <strong>Chat-Node</strong>, no le pongáis espacios ni caracteres especiales porque la vamos a iniciar como proyecto con Node, separad los espacios con guiones si lo necesitáis.</p>
<p>Dentro iniciamos un proyecto para trabajar con dependencias, todo por defecto excepto el main que podemos llamar <strong>server.js</strong>:</p>
<div class="highlight"><pre><span></span><code><span class="nx">npm</span> <span class="nx">init</span>
</code></pre></div>
<p>Para este proyecto vamos a empezar a utilizar el módulo Express, así podremos servir los ficheros estáticos del frontend junto al backend fácilmente. Podemos instalarlo en un momento haciendo:</p>
<div class="highlight"><pre><span></span><code><span class="nx">npm</span> <span class="nx">install</span> <span class="o">-</span><span class="nx">s</span> <span class="nx">express</span>
</code></pre></div>
<p>Ahora en nuestro <strong>server.js</strong> creamos iniciamos nuestro servidor HTTP con express:</p>
<p><code>server.js</code>
<div class="highlight"><pre><span></span><code><span class="kd">var</span> <span class="nx">express</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s2">&quot;express&quot;</span><span class="p">)</span>
<span class="kd">var</span> <span class="nx">app</span> <span class="o">=</span> <span class="nx">express</span><span class="p">()</span>

<span class="kd">var</span> <span class="nx">server</span> <span class="o">=</span> <span class="nx">app</span><span class="p">.</span><span class="nx">listen</span><span class="p">(</span><span class="mf">3000</span><span class="p">,</span> <span class="p">()</span> <span class="p">=&gt;</span> <span class="p">{</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;Servidor listo en http://127.0.0.1:3000&quot;</span><span class="p">)</span>
<span class="p">})</span>
</code></pre></div></p>
<p>En este punto os recomiendo instalar Nodemon, es un pequeño demonio que reiniciará automáticamente nuestro servicio de Node al detectar un cambio:</p>
<div class="highlight"><pre><span></span><code><span class="nx">npm</span> <span class="nx">install</span> <span class="o">-</span><span class="nx">g</span> <span class="nx">nodemon</span>
</code></pre></div>
<p>Ahora para poner en marcha el servidor lo haremos con:</p>
<div class="highlight"><pre><span></span><code><span class="nx">nodemon</span> <span class="nx">server</span><span class="p">.</span><span class="nx">js</span>
</code></pre></div>
<p>Si guardáis el fichero <strong>server.js</strong> veréis que el servidor se reinicia automáticamente.</p>
<p>¿Muy práctico verdad?</p>
<h2 id="preparando-el-cliente">Preparando el cliente<a class="headerlink" href="#preparando-el-cliente" title="Permanent link">&para;</a></h2>
<p>Vamos a diseñar una página HTML para manejar el cliente web del chat, podemos usar bootstrap para ir rápido. Os voy a dejar el código en los apuntes ya con todo preparado, si tenéis alguna duda sobre el funcionamiento me lo decís en los comentarios de la lección.</p>
<p>Podemos crearlo en una carpeta llamada <strong>public</strong> haciendo referencia a los ficheros estáticos públicos:</p>
<p><code>public/index.html</code>
<div class="highlight"><pre><span></span><code><span class="cp">&lt;!DOCTYPE html&gt;</span>
<span class="p">&lt;</span><span class="nt">html</span><span class="p">&gt;</span>
  <span class="p">&lt;</span><span class="nt">head</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">meta</span> <span class="na">charset</span><span class="o">=</span><span class="s">&quot;utf-8&quot;</span> <span class="p">/&gt;</span>
    <span class="p">&lt;</span><span class="nt">meta</span> <span class="na">name</span><span class="o">=</span><span class="s">&quot;viewport&quot;</span> <span class="na">content</span><span class="o">=</span><span class="s">&quot;width=device-width, initial-scale=1&quot;</span> <span class="p">/&gt;</span>
    <span class="p">&lt;</span><span class="nt">style</span><span class="p">&gt;</span><span class="w"></span>
<span class="w">    </span><span class="nt">body</span><span class="w"> </span><span class="p">{</span><span class="w"> </span>
<span class="w">      </span><span class="k">margin</span><span class="p">:</span><span class="w"> </span><span class="mi">15</span><span class="kt">px</span><span class="p">;</span><span class="w"> </span><span class="k">font-family</span><span class="p">:</span><span class="w"> </span><span class="kc">sans-serif</span><span class="w"> </span><span class="p">}</span><span class="w"></span>
<span class="w">    </span><span class="nt">h3</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">      </span><span class="k">padding</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="k">margin</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="k">margin-bottom</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="kt">rem</span><span class="p">;}</span><span class="w"></span>
<span class="w">    </span><span class="p">#</span><span class="nn">chat</span><span class="w"> </span><span class="p">{</span><span class="w"> </span>
<span class="w">      </span><span class="k">background</span><span class="p">:</span><span class="w"> </span><span class="nb">rgb</span><span class="p">(</span><span class="mi">245</span><span class="p">,</span><span class="w"> </span><span class="mi">245</span><span class="p">,</span><span class="w"> </span><span class="mi">245</span><span class="p">);</span><span class="w"> </span><span class="k">height</span><span class="p">:</span><span class="w"> </span><span class="mi">200</span><span class="kt">px</span><span class="p">;</span><span class="w"> </span><span class="k">width</span><span class="p">:</span><span class="w"> </span><span class="nb">calc</span><span class="p">(</span><span class="mi">100</span><span class="kt">%</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">20</span><span class="kt">px</span><span class="p">);</span><span class="w"> </span>
<span class="w">      </span><span class="k">max-width</span><span class="p">:</span><span class="mi">620</span><span class="kt">px</span><span class="p">;</span><span class="w"> </span><span class="k">border</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="kt">px</span><span class="w"> </span><span class="kc">solid</span><span class="w"> </span><span class="kc">gray</span><span class="p">;</span><span class="w"> </span><span class="k">margin-bottom</span><span class="p">:</span><span class="w"> </span><span class="mi">10</span><span class="kt">px</span><span class="p">;</span><span class="w"> </span>
<span class="w">      </span><span class="k">padding</span><span class="p">:</span><span class="w"> </span><span class="mi">10</span><span class="kt">px</span><span class="p">;</span><span class="w"> </span><span class="k">overflow-y</span><span class="p">:</span><span class="w"> </span><span class="kc">auto</span><span class="p">;</span><span class="w"> </span><span class="k">overflow-y</span><span class="p">:</span><span class="w"> </span><span class="kc">scroll</span><span class="p">;}</span><span class="w"></span>
<span class="w">    </span><span class="p">#</span><span class="nn">controls</span><span class="w"> </span><span class="p">{</span><span class="w"> </span>
<span class="w">      </span><span class="k">display</span><span class="p">:</span><span class="w"> </span><span class="k">grid</span><span class="p">;</span><span class="w"> </span><span class="k">width</span><span class="p">:</span><span class="w"> </span><span class="nb">calc</span><span class="p">(</span><span class="mi">100</span><span class="kt">%</span><span class="p">);</span><span class="w"> </span><span class="k">max-width</span><span class="p">:</span><span class="mi">642</span><span class="kt">px</span><span class="p">;</span><span class="w"> </span>
<span class="w">      </span><span class="k">grid-template-columns</span><span class="p">:</span><span class="w"> </span><span class="mi">25</span><span class="kt">%</span><span class="w"> </span><span class="mi">55</span><span class="kt">%</span><span class="w"> </span><span class="mi">20</span><span class="kt">%</span><span class="p">;</span><span class="w"> </span><span class="p">}</span><span class="w"></span>
<span class="w">    </span><span class="p">#</span><span class="nn">controls</span><span class="w"> </span><span class="nt">input</span><span class="w"> </span><span class="p">{</span><span class="w"> </span>
<span class="w">      </span><span class="k">padding</span><span class="p">:</span><span class="w"> </span><span class="mi">8</span><span class="kt">px</span><span class="w"> </span><span class="mi">5</span><span class="kt">px</span><span class="p">;</span><span class="w"> </span><span class="p">}</span><span class="w"></span>
<span class="w">    </span><span class="p">&lt;/</span><span class="nt">style</span><span class="p">&gt;</span>
  <span class="p">&lt;/</span><span class="nt">head</span><span class="p">&gt;</span>
  <span class="p">&lt;</span><span class="nt">body</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">div</span> <span class="na">id</span><span class="o">=</span><span class="s">&quot;chat&quot;</span><span class="p">&gt;&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
      <span class="p">&lt;</span><span class="nt">form</span> <span class="na">autocomplete</span><span class="o">=</span><span class="s">&quot;off&quot;</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">div</span> <span class="na">id</span><span class="o">=</span><span class="s">&quot;controls&quot;</span><span class="p">&gt;</span>
          <span class="p">&lt;</span><span class="nt">input</span> <span class="na">type</span><span class="o">=</span><span class="s">&quot;text&quot;</span> <span class="na">id</span><span class="o">=</span><span class="s">&quot;username&quot;</span> <span class="na">placeholder</span><span class="o">=</span><span class="s">&quot;Usuario&quot;</span> <span class="p">/&gt;</span>
          <span class="p">&lt;</span><span class="nt">input</span> <span class="na">type</span><span class="o">=</span><span class="s">&quot;text&quot;</span> <span class="na">id</span><span class="o">=</span><span class="s">&quot;content&quot;</span> <span class="na">placeholder</span><span class="o">=</span><span class="s">&quot;Mensaje&quot;</span> <span class="p">/&gt;</span>
          <span class="p">&lt;</span><span class="nt">input</span> <span class="na">type</span><span class="o">=</span><span class="s">&quot;submit&quot;</span> <span class="na">value</span><span class="o">=</span><span class="s">&quot;Enviar&quot;</span> <span class="p">/&gt;</span>
        <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
      <span class="p">&lt;/</span><span class="nt">form</span><span class="p">&gt;</span>
    <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">script</span> <span class="na">src</span><span class="o">=</span><span class="s">&quot;https://code.jquery.com/jquery-3.3.1.slim.min.js&quot;</span><span class="p">&gt;&lt;/</span><span class="nt">script</span><span class="p">&gt;</span>
  <span class="p">&lt;/</span><span class="nt">body</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">html</span><span class="p">&gt;</span>
</code></pre></div></p>
<p>Bien, con esto ya lo tenemos.</p>
<p>Ahora tenemos que servir los ficheros estáticos con Express, para hacerlo haremos lo siguiente en nuestro servidor:</p>
<div class="highlight"><pre><span></span><code><span class="nx">app</span><span class="p">.</span><span class="nx">use</span><span class="p">(</span><span class="nx">express</span><span class="p">.</span><span class="k">static</span><span class="p">(</span><span class="nx">__dirname</span> <span class="o">+</span> <span class="s1">&#39;/public&#39;</span><span class="p">))</span>
</code></pre></div>
<p>Con esto ya podemos poner en marcha el servidor y si accedemos veremos como se carga la pantalla inicial de nuestro chat.</p>
<h2 id="conexiones-al-servidor">Conexiones al servidor<a class="headerlink" href="#conexiones-al-servidor" title="Permanent link">&para;</a></h2>
<p>Para que manejar conversaciones en tiempo real entre un servidor y sus clientes a través de la red necesitamos utilizar sockets. </p>
<p>Manejar sockets suele ser una tarea bastante tediosa, pero por suerte para nosotros hay una tecnología llamada web sockets que nos facilitará mucho la vida. Para utilizarla en JavaScript podemos hacr uso de la biblioteca Socket.IO.</p>
<p>Tendremos que implementarla en ambos lados de nuestra aplicación, vamos a empezar por el servidor:</p>
<div class="highlight"><pre><span></span><code><span class="nx">npm</span> <span class="nx">install</span> <span class="o">-</span><span class="nx">s</span> <span class="nx">socket</span><span class="p">.</span><span class="nx">io</span>
</code></pre></div>
<p>Para utilizar el módulo en el servidor tendremos que iniciar un servicio http paralelo en nuestra app y cargarlo en la biblioteca <strong>justo después de crear nuestra app</strong>: </p>
<p><code>server.js</code>
<div class="highlight"><pre><span></span><code><span class="kd">var</span> <span class="nx">http</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;http&#39;</span><span class="p">).</span><span class="nx">Server</span><span class="p">(</span><span class="nx">app</span><span class="p">)</span>
<span class="kd">var</span> <span class="nx">io</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;socket.io&#39;</span><span class="p">)(</span><span class="nx">http</span><span class="p">)</span>
</code></pre></div></p>
<p>Para capturar las conexiones al servidor definiremos un evento <strong>connection</strong> que recuperará el socket abierto entre el servidor y el cliente:</p>
<div class="highlight"><pre><span></span><code><span class="nx">io</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s1">&#39;connection&#39;</span><span class="p">,</span> <span class="p">(</span><span class="nx">socket</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;Usuario conectado&#39;</span><span class="p">,</span> <span class="nx">socket</span><span class="p">)</span>
<span class="p">})</span>
</code></pre></div>
<p>Y ahora muy importante, en lugar de poner en marcha el servidor Express directamente, usaremos el que hemos redefinido en <strong>http</strong> que es donde tenemos socket.io funcionando:</p>
<div class="highlight"><pre><span></span><code><span class="kd">var</span> <span class="nx">server</span> <span class="o">=</span> <span class="nx">http</span><span class="p">.</span><span class="nx">listen</span><span class="p">(</span><span class="mf">3000</span><span class="p">,</span> <span class="p">()</span> <span class="p">=&gt;</span> <span class="p">{</span>
</code></pre></div>
<p>Con esto ya estamos escuchando los web sockets, pero no podemos probarlos hasta programar alguna prueba en el cliente web. </p>
<p>Así que vamos a cargar la biblioteca socket.io en el frontend que se añade automáticamente como recurso del servidor:</p>
<p><code>public/index.html</code>
<div class="highlight"><pre><span></span><code><span class="cm">&lt;!-- Cargamos la biblioteca de sockets que se añade automáticamente --&gt;</span> 
<span class="p">&lt;</span><span class="nt">script</span> <span class="na">src</span><span class="o">=</span><span class="s">&quot;/socket.io/socket.io.js&quot;</span><span class="p">&gt;&lt;/</span><span class="nt">script</span><span class="p">&gt;</span> 
</code></pre></div></p>
<p>Con la biblioteca cargada el primer paso es conectar el cliente al server:</p>
<div class="highlight"><pre><span></span><code><span class="kd">var</span> <span class="nx">socket</span> <span class="o">=</span> <span class="nx">io</span><span class="p">()</span>
</code></pre></div>
<p>Si cargamos de nuevo la página HTML veremos como ya nos aparece en el servidor el mensaje de <strong>Usuario conectado</strong>.</p>
<h2 id="bienvenida-al-cliente">Bienvenida al cliente<a class="headerlink" href="#bienvenida-al-cliente" title="Permanent link">&para;</a></h2>
<p>Sabemos que se ha conectado un cliente, vamos a enviarle una señal de vuelta para darle la bienvenida al servidor:</p>
<p><code>server.js</code>
<div class="highlight"><pre><span></span><code><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;Usuario conectado&#39;</span><span class="p">)</span>
<span class="nx">socket</span><span class="p">.</span><span class="nx">emit</span><span class="p">(</span><span class="s1">&#39;bienvenida&#39;</span><span class="p">)</span>
</code></pre></div></p>
<p>Ahora en el cliente vamos a detectar ese evento llamado <strong>bienvenida</strong> y al llamarse mostraremos la bienvenida en el chat:</p>
<p><code>public/index.html</code>
<div class="highlight"><pre><span></span><code><span class="c1">// Cuando jQuery se haya cargado</span>
<span class="nx">$</span><span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span>  

  <span class="c1">// Capturamos la señal de bienvenida y saludamos al usuario</span>
  <span class="nx">socket</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s2">&quot;bienvenida&quot;</span><span class="p">,</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="nx">$</span><span class="p">(</span><span class="s2">&quot;#chat&quot;</span><span class="p">)</span>
      <span class="p">.</span><span class="nx">empty</span><span class="p">()</span>
      <span class="p">.</span><span class="nx">append</span><span class="p">(</span><span class="s2">&quot;&lt;h3&gt;Bienvenido al chat de Hektor Profe&lt;/h3&gt;&quot;</span><span class="p">)</span>
  <span class="p">})</span>

<span class="p">})</span>
</code></pre></div></p>
<p>¡Listo!</p>
<h2 id="mensajes-al-servidor">Mensajes al servidor<a class="headerlink" href="#mensajes-al-servidor" title="Permanent link">&para;</a></h2>
<p>El siguiente paso es que el cliente pueda enviar mensajes al servidor. </p>
<p>Para hacerlo debemos emitir un mensaje del cliente hacia el servidor, pero no vamos a emitirlo a cualquier sitio sino a un evento llamado por ejemplo <strong>nuevo_mensaje</strong>:</p>
<p><code>server.js</code>
<div class="highlight"><pre><span></span><code><span class="nx">socket</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s1">&#39;nuevo_mensaje&#39;</span><span class="p">,</span> <span class="p">(</span><span class="nx">message</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">message</span><span class="p">)</span>
<span class="p">})</span>
</code></pre></div></p>
<p>De vuelta al cliente vamos a detectar cuando se envía el formulario, recuperaremos los datos y los emitiremos al servidor en una pequeña estructura que representará un mensaje:</p>
<p><code>public/index.html</code>
<div class="highlight"><pre><span></span><code><span class="c1">// Capturamos el clic en el botón de enviar</span>
<span class="kd">var</span> <span class="nx">form</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="s2">&quot;form&quot;</span><span class="p">).</span><span class="nx">on</span><span class="p">(</span><span class="s2">&quot;submit&quot;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">e</span><span class="p">){</span>
  <span class="c1">// Desactivamos el formulario para enviarlo con JS</span>
  <span class="nx">e</span><span class="p">.</span><span class="nx">preventDefault</span><span class="p">()</span> 
  <span class="c1">// Creamos un objeto con el mensaje</span>
  <span class="kd">var</span> <span class="nx">message</span> <span class="o">=</span> <span class="p">{</span>
    <span class="nx">name</span><span class="o">:</span> <span class="nx">$</span><span class="p">(</span><span class="s2">&quot;#username&quot;</span><span class="p">).</span><span class="nx">val</span><span class="p">(),</span> 
    <span class="nx">content</span><span class="o">:</span> <span class="nx">$</span><span class="p">(</span><span class="s2">&quot;#content&quot;</span><span class="p">).</span><span class="nx">val</span><span class="p">()</span>
  <span class="p">}</span>
  <span class="c1">// Lo emitimos</span>
  <span class="nx">socket</span><span class="p">.</span><span class="nx">emit</span><span class="p">(</span><span class="s2">&quot;nuevo_mensaje&quot;</span><span class="p">,</span> <span class="nx">message</span><span class="p">)</span>
<span class="p">})</span>
</code></pre></div></p>
<p>Si enviamos un mensaje veréis que aparece en el servidor el objeto que lo contiene.</p>
<h2 id="difundiendo-el-mensaje">Difundiendo el mensaje<a class="headerlink" href="#difundiendo-el-mensaje" title="Permanent link">&para;</a></h2>
<p>Nuestro servidor ya recibe los mensajes, ahora tenemos que difundirlos a los clientes conectados para mostrarlos en el chat, esto es lo que se conoce como hacer un "broadcast" del mensaje.</p>
<p>Para hacer una difusión global lo haremos a nivel del servidor y no del socket del cliente con un evento que podemos llamar <strong>difundir_mensaje</strong>:</p>
<p><code>server.js</code>
<div class="highlight"><pre><span></span><code><span class="nx">socket</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s1">&#39;nuevo_mensaje&#39;</span><span class="p">,</span> <span class="p">(</span><span class="nx">message</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
  <span class="c1">// Dinfundimos el mensaje a todos los clientes</span>
  <span class="nx">io</span><span class="p">.</span><span class="nx">sockets</span><span class="p">.</span><span class="nx">emit</span><span class="p">(</span><span class="s1">&#39;difundir_mensaje&#39;</span><span class="p">,</span> <span class="nx">message</span><span class="p">)</span>
<span class="p">})</span>
</code></pre></div></p>
<p>Ahora tenemos que capturar este evento en el cliente, recuperar el objeto message recibido y mostrarlo:</p>
<p><code>public/index.html</code>
<div class="highlight"><pre><span></span><code><span class="c1">// Recuperamos el mensaje y lo añadimos al HTML</span>
<span class="nx">socket</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s1">&#39;difundir_mensaje&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">message</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">$</span><span class="p">(</span><span class="s2">&quot;#chat&quot;</span><span class="p">)</span>
    <span class="p">.</span><span class="nx">append</span><span class="p">(</span><span class="sb">`</span>
<span class="sb">      &lt;b&gt;</span><span class="si">${</span><span class="nx">message</span><span class="p">.</span><span class="nx">name</span><span class="si">}</span><span class="sb">&lt;/b&gt;</span>
<span class="sb">      </span><span class="si">${</span><span class="nx">message</span><span class="p">.</span><span class="nx">content</span><span class="si">}</span><span class="sb">&lt;br&gt;`</span><span class="p">)</span>
<span class="p">})</span>
</code></pre></div></p>
<p>¡Listo! Por increíble que parezca con esto tenemos un protitpo completamente funcional, probad a abrir varias ventanas y hablar con diferentes nombres.</p>
<p>Sin embargo no quiero dejar el chat como está, creo que es una buena oportunidad para analizar algunos problemas que existen a niel de cliente y solucionarlos.</p>
<h2 id="puliendo-el-cliente">Puliendo el cliente<a class="headerlink" href="#puliendo-el-cliente" title="Permanent link">&para;</a></h2>
<p>En esta lección vamos analizar y solucionar algunos problemas importantes que tiene el cliente web de nuestro chat.</p>
<p>El primer problema que salta a la vista es que no tenemos un sistema de autenticación, así que cualquier puede cambiar su nombre para hacerse pasar por otra persona.</p>
<p>Arreglar esto de forma óptima conllevaría manejar una base de datos o fichero de registros, con usuario y contraseñas encriptadas. Es demasiado trabajo para un curso de nivel intermedio, así que vamos a simplemente a bloquear el campo de nombre para que no se pueda editar una vez envías el primer mensaje:</p>
<p><code>public/index.html</code>
<div class="highlight"><pre><span></span><code><span class="nx">socket</span><span class="p">.</span><span class="nx">emit</span><span class="p">(</span><span class="s2">&quot;nuevo_mensaje&quot;</span><span class="p">,</span> <span class="nx">message</span><span class="p">)</span>        <span class="c1">// Lo emitimos</span>
<span class="nx">$</span><span class="p">(</span><span class="s2">&quot;#username&quot;</span><span class="p">).</span><span class="nx">attr</span><span class="p">(</span><span class="s2">&quot;disabled&quot;</span><span class="p">,</span><span class="s2">&quot;disabled&quot;</span><span class="p">)</span>  <span class="c1">// Desactivamos el nombre</span>
</code></pre></div></p>
<p>Algo más que podemos hacer inmediatamente después de enviar el mensaje es borrar el mensaje para que el usuario tenga que escribirlo uno nuevo y no pueda "spamear" el mismo todo el rato:</p>
<div class="highlight"><pre><span></span><code><span class="nx">$</span><span class="p">(</span><span class="s2">&quot;#content&quot;</span><span class="p">).</span><span class="nx">val</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">).</span><span class="nx">focus</span><span class="p">()</span>  <span class="c1">// Borramos el mensaje y lo seleccionamos</span>
</code></pre></div>
<p>Ahora, creo que sería importante validar el usuario y el mensaje para que por lo menos ambos tengan un caracter de longitud, así evitaremos que se envíen mensajes vacíos o nombres vacíos:</p>
<div class="highlight"><pre><span></span><code><span class="c1">// Lo emitimos al servidor si cumple las condiciones</span>
<span class="k">if</span> <span class="p">(</span><span class="nx">message</span><span class="p">.</span><span class="nx">name</span><span class="p">.</span><span class="nx">length</span> <span class="o">&gt;</span> <span class="mf">0</span> <span class="o">&amp;&amp;</span> <span class="nx">message</span><span class="p">.</span><span class="nx">content</span><span class="p">.</span><span class="nx">length</span> <span class="o">&gt;</span> <span class="mf">0</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">socket</span><span class="p">.</span><span class="nx">emit</span><span class="p">(</span><span class="s2">&quot;nuevo_mensaje&quot;</span><span class="p">,</span> <span class="nx">message</span><span class="p">)</span>  <span class="c1">// Lo emitimos</span>
  <span class="nx">$</span><span class="p">(</span><span class="s2">&quot;#username&quot;</span><span class="p">).</span><span class="nx">attr</span><span class="p">(</span><span class="s2">&quot;disabled&quot;</span><span class="p">,</span><span class="s2">&quot;disabled&quot;</span><span class="p">)</span> <span class="c1">// Desactivamos el nombre</span>
  <span class="nx">$</span><span class="p">(</span><span class="s2">&quot;#content&quot;</span><span class="p">).</span><span class="nx">val</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">).</span><span class="nx">focus</span><span class="p">()</span>  <span class="c1">// Borramos el mensaje y lo seleccionamos</span>
<span class="p">}</span>
</code></pre></div>
<p>Sin embargo esto no funcionará si alguien introduce un espacio porque lo tomaré como un carácter invisible. </p>
<p>Para solucionar esta situación podemos hacer utilizar el método <strong>trim()</strong> en los valores recuperados, eso borrará los espacios al principio y al final del nombre y el mensaje:</p>
<div class="highlight"><pre><span></span><code><span class="c1">// Creamos un objeto con el mensaje</span>
<span class="kd">var</span> <span class="nx">message</span> <span class="o">=</span> <span class="p">{</span>
  <span class="nx">name</span><span class="o">:</span> <span class="nx">$</span><span class="p">(</span><span class="s2">&quot;#username&quot;</span><span class="p">).</span><span class="nx">val</span><span class="p">().</span><span class="nx">trim</span><span class="p">(),</span> 
  <span class="nx">content</span><span class="o">:</span> <span class="nx">$</span><span class="p">(</span><span class="s2">&quot;#content&quot;</span><span class="p">).</span><span class="nx">val</span><span class="p">().</span><span class="nx">trim</span><span class="p">()</span>
<span class="p">}</span>
</code></pre></div>
<p>Vamos bien, pero seguimos teniendo un problema importantísimo. Si un usuario envía un mensaje con tag HTML, este se inyectará en el chat, probad a inyectar una alerta dentro de un tag script:</p>
<div class="highlight"><pre><span></span><code><span class="o">&lt;</span><span class="nx">script</span><span class="o">&gt;</span><span class="nx">alert</span><span class="p">(</span><span class="s2">&quot;Hola&quot;</span><span class="p">)</span><span class="o">&lt;</span><span class="err">/script&gt;</span>
</code></pre></div>
<p>Esto es una brecha de seguridad considerable que deja la puerta abierta a inyectar código en otros usuarios y creedme que eso es muy malo. ¿Os imagináis que alguien os carga una librería remota de JavaScript? Han habido casos en que se han inyectado librerías para minear criptomonedas de esta forma en páginas web, haciendo que todos los clientes que visitaban la web inyectada minearan para beneficio del hacker que inyectó su librería en el código. </p>
<p>Por suerte podemos evitar esto de una forma muy sencilla, sólo tenemos que asegurar el contenido del mensaje transformando las flechas de los tags en caracteres. Para ello vamos a crear una función que asegure una cadena:</p>
<div class="highlight"><pre><span></span><code><span class="c1">// Función para prevenir inyección de tags</span>
<span class="kd">function</span> <span class="nx">special</span><span class="p">(</span><span class="nx">str</span><span class="p">){</span> 
  <span class="c1">// gi =&gt; Reemplazo global case-insensitive</span>
  <span class="nx">str</span> <span class="o">=</span> <span class="nx">str</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/&lt;/gi</span><span class="p">,</span> <span class="s1">&#39;&amp;lt;&#39;</span><span class="p">)</span> <span class="c1">// importante usar comillas simples</span>
  <span class="nx">str</span> <span class="o">=</span> <span class="nx">str</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/&gt;/gi</span><span class="p">,</span> <span class="s1">&#39;&amp;gt;&#39;</span><span class="p">)</span> <span class="c1">// en las expresiones regulares</span>
  <span class="k">return</span> <span class="nx">str</span>
<span class="p">}</span>
</code></pre></div>
<p>Y la utilizamos para asegurar los campos antes de añadirlos en el chat:</p>
<div class="highlight"><pre><span></span><code><span class="nx">$</span><span class="p">(</span><span class="s2">&quot;#chat&quot;</span><span class="p">)</span>
  <span class="p">.</span><span class="nx">append</span><span class="p">(</span><span class="sb">`</span>
<span class="sb">    &lt;b&gt;</span><span class="si">${</span><span class="nx">special</span><span class="p">(</span><span class="nx">message</span><span class="p">.</span><span class="nx">name</span><span class="p">)</span><span class="si">}</span><span class="sb">&lt;/b&gt;</span>
<span class="sb">    </span><span class="si">${</span><span class="nx">special</span><span class="p">(</span><span class="nx">message</span><span class="p">.</span><span class="nx">content</span><span class="p">)</span><span class="si">}</span><span class="sb">&lt;br&gt;`</span><span class="p">)</span>
</code></pre></div>
<p>Si ahora intentamos enviar un script o cualquier tag HTML:</p>
<div class="highlight"><pre><span></span><code><span class="o">&lt;</span><span class="nx">script</span><span class="o">&gt;</span><span class="nx">alert</span><span class="p">(</span><span class="s2">&quot;Hola&quot;</span><span class="p">)</span><span class="o">&lt;</span><span class="err">/script&gt;</span>
</code></pre></div>
<p>Se nos muestra la cadena en crudo, así que problema resuelto y podemos dar por concluido nuestro chat online.</p>
<p>En la siguiente sección del curso os enseñaré a desplegar el chat en la nube usando Heroku sin coste para que podáis probar el proyecto con vuestros amigos.</p>
<h2 id="preparando-el-repositorio">Preparando el repositorio<a class="headerlink" href="#preparando-el-repositorio" title="Permanent link">&para;</a></h2>
<p>Heroku es una plataforma que permite desplegar y escalar servicios creados en todo tipo de lenguajes. Node.js no es una excepción y en muy pocos pasos podemos tener nuestro chat en la nube sin coste, simplemente usando el plan gratuito.</p>
<p>El plan gratuito es para hacer pruebas, así que no se os ocurra colgar proyectos reales para vuestro clientes porque tienen una cuota limitada. </p>
<p>En cualquier caso no voy a entrar en detalles, simplemente os enseñaré los pasos para desplegar el proyecto, realizaremos un cambio y lo volveremos a desplegar.</p>
<p>Lo primero y fundamental es tener una cuenta en Heroku, os podéis registrar en <a href="https://www.heroku.com/">www.heroku.com</a> donde pone Signup.</p>
<p>Una vez creada instalamos el cliente de Heroku en Node, es muy fácil pero tardará un ratito, así que paciencia:</p>
<div class="highlight"><pre><span></span><code>npm install -g heroku
</code></pre></div>
<p>Ahora, antes de desplegar un proyecto en Heroku es necesario hacer algunas preparaciones.</p>
<p>La primera es crear un fichero llamado <strong>Procfile</strong>, éste contendrá el tipo de proceso que deseamos iniciar y el comando que iniciará el servicio:</p>
<p>`Procfile
<div class="highlight"><pre><span></span><code>web: node server.js
</code></pre></div></p>
<p>El siguiente requisito es que el proyecto esté gestionado con el control de versiones Git, así que no tenemos remedio que instalar ese programa, os dejaré el <a href="https://git-scm.com/downloads">enlace en los apuntes</a>. Podéis hacer siguiente, siguiente, siguiente sin mucha complicación.</p>
<p>Una vez tengáis Git instalado y hayáis reiniciado Visual Studio Code podréis manejar Git desde el propio editor, sin embargo antes debemos configurar un email y un nombre de usuario en Git, eso lo podemos haciendo <strong>clic derecho en la carpeta de nuestro proyecto</strong> y <strong>Git Bash Here</strong>.</p>
<p>En la nueva terminal de Git vamos a configurar sólo una primera vez nuestra información de autoría:</p>
<div class="highlight"><pre><span></span><code>git config --global user.email <span class="s2">&quot;hola@hektor.dev&quot;</span>
git config --global user.name <span class="s2">&quot;Héctor Costa&quot;</span>
</code></pre></div>
<p>Acto seguido iniciaremos el repositorio escribiendo lo siguiente estando en el directorio del proyecto:</p>
<div class="highlight"><pre><span></span><code>git init
</code></pre></div>
<p>Cuando lo tengamos procederemos a identificarnos en Heroku para crear el proyecto remoto y poder desplegarlo:</p>
<div class="highlight"><pre><span></span><code>heroku login
</code></pre></div>
<p>Os pedirá abrir el navegador para identificaros en la web, una vez hecho creamos el proyecto en heroku:</p>
<div class="highlight"><pre><span></span><code>heroku create
</code></pre></div>
<p>A parte de crearlo se abrá añadido la configuración remota para el despliegue, lo sabréis porque aparecerá una URL y un repositorio de Git almacenado en Heroku.</p>
<p>Con esto ya estamos listos para volver a Visual Studio Code y continuar desde allí, sin embargo <strong>es importante que reiniciéis el editor</strong> para que se detecte Git y podáis usarlo cómodamente antes de continuar.</p>
<h2 id="realizando-el-despliegue">Realizando el despliegue<a class="headerlink" href="#realizando-el-despliegue" title="Permanent link">&para;</a></h2>
<p>Al abrir de nuevo el proyecto veréis que se activa la tercera opción para "Controlar código fuente" y se añaden tropocientosmil ficheros al repositorio, eso es porque las dependendencias de Node almacenadas en la carpeta <strong>node_modules</strong> también se han añadido. No queremos eso, vamos a crear un fichero <strong>.gitignore</strong> para decirle que la ignore:</p>
<p><code>.gitignore</code>
<div class="highlight"><pre><span></span><code>node_modules/
</code></pre></div></p>
<p>Veréis como el directorio se pone gris, eso es que ya lo está ignorando.</p>
<p>Ahora desde el propio editor, en la parte superior vamos a añadir un mensaje explicando los cambios, esto que se conoce como un hacer un "Commit", cuando lo tengamos confirmamos en el botón de arriba.</p>
<p>Finalmente hacemos clic en los tres puntitos y seleccionamos la opción <strong>Publicar en rama</strong>.</p>
<p>Como solo tenemos el la rama maestro en Heroku configurada se publicarán ahí los cambios directamente, si tuviéramos más ramas nos pediría seleccionar una específica.</p>
<p>Podemos intentar acceder a la URL del proyecto y en su puerto 3000 a ver si funciona:</p>
<div class="highlight"><pre><span></span><code>https://intense-ocean-94826.herokuapp.com:3000 
</code></pre></div>
<p>Al publicar estos cambios automáticamente se realizará el despliegue, pero lamentabelmente esto no funcionará a la primera.</p>
<p>Podemos consultar un registro del servidor en la terminal:</p>
<div class="highlight"><pre><span></span><code>heroku logs -a intense-ocean-94826 -n 50
</code></pre></div>
<p>En este caso en particular indagando encontraremos esta línea:</p>
<div class="highlight"><pre><span></span><code>Error R10 (Boot timeout) -&gt; Web process failed to bind to $PORT within 60 seconds of launch
</code></pre></div>
<p>Básicamente nos dice que falló la asignación al puerto 3000, ¿sabéis poqué? Cuando hemos definido el <strong>Procfile</strong> hemos indicado que el servicio es del tipo <strong>web</strong>, eso le obliga a Heroku a ejecutarlo en el puerto 80. Sin embargo la solución no es tan fácil como cambiar el puerto al 80 y ya está. </p>
<p>Heroku internamente asigna un puerto dinámico al servicio web y lo mapea automáticamente al 80 del servidor.</p>
<p>Ese puerto dinámico es el que tenemos que recuperar del proceso y asignarlo, podemos hacerlo así:</p>
<div class="highlight"><pre><span></span><code><span class="c1">// Asignar el puerto que Heroku maneja y si no existe el 3000 manualmente</span>
<span class="kd">var</span> <span class="nx">server</span> <span class="o">=</span> <span class="nx">http</span><span class="p">.</span><span class="nx">listen</span><span class="p">(</span><span class="nx">process</span><span class="p">.</span><span class="nx">env</span><span class="p">.</span><span class="nx">PORT</span> <span class="o">||</span> <span class="mf">3000</span><span class="p">,</span> <span class="p">()</span> <span class="p">=&gt;</span> <span class="p">{</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;Servidor listo en http://127.0.0.1:&quot;</span> <span class="o">+</span> <span class="nx">server</span><span class="p">.</span><span class="nx">address</span><span class="p">().</span><span class="nx">port</span><span class="p">);</span>
<span class="p">});</span>
</code></pre></div>
<p>Ahora hacemos un commit, confirmamos y publicamos los cambios.</p>
<p>Si todo ha ido bien deberíamos ser capaces de acceder desde la URL normal, que mapea el puerto 80 automáticamente, a nuestro chat web:</p>
<div class="highlight"><pre><span></span><code>https://intense-ocean-94826.herokuapp.com
</code></pre></div>
<p>Recordad que podéis consultar los registros con <strong>heroku logs</strong> en cualquier momento para saber si hay algún problema.</p>
<p>Con esto llegamos al final de este interesante proyecto, espero que el curso os haya parecido interesante y hayáis aprendido algo nuevo, os traeré más contenido sobre Node muy pronto, mientras tanto nos vemos por la academia.</p>
<hr />
<p><small class="edited"><i>Última edición: 17 de Marzo de 2021</i></small></p>
                
                  
                
              
              
                


              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
  <div class="md-footer-nav">
    <nav class="md-footer-nav__inner md-grid">
      
      <a
        href="../nodejs/"
        title="Introducción a Node.js"
        class="md-flex md-footer-nav__link md-footer-nav__link--prev"
        rel="prev"
      >
        <div class="md-flex__cell md-flex__cell--shrink">
          <i class="md-icon md-icon--arrow-back md-footer-nav__button"></i>
        </div>
        <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
          <span class="md-flex__ellipsis">
            <span class="md-footer-nav__direction">
              Anterior
            </span>
            Introducción a Node.js
          </span>
        </div>
      </a>
       
      <a
        href="../cliente-nuxt/"
        title="Proyecto cliente Nuxt.js"
        class="md-flex md-footer-nav__link md-footer-nav__link--next"
        rel="next"
      >
        <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
          <span class="md-flex__ellipsis">
            <span class="md-footer-nav__direction">
              Siguiente
            </span>
            Proyecto cliente Nuxt.js
          </span>
        </div>
        <div class="md-flex__cell md-flex__cell--shrink">
          <i class="md-icon md-icon--arrow-forward md-footer-nav__button"></i>
        </div>
      </a>
      
    </nav>
  </div>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        <!--<div class="md-footer-links__highlight">
          <a href="/comunidad/">Comunidad</a> · <a href="/politica-de-cookies/">Política de cookies</a> · <a href="/sobre-mi/">Sobre mí</a>
        </div>-->
        <div class="md-footer-copyright__highlight">
          2015 - 2022 &copy; Héctor Costa Guzmán (<u
            ><a
              href="https://creativecommons.org/licenses/by/4.0/deed.es"
              target="_blank"
              rel="nofollow"
              >Licencia CC BY 4.0</a
            ></u
          >)
        </div>
      </div>
       
<style>.md-footer-social__link {transition: 0.3s;}</style>
<div class="md-footer-social" style="font-size: 2.5rem; margin-top: -6px!important; padding: 0px!important; margin-bottom: -6px; overflow: hidden!important;">
  <a href="https://github.com/hcosta" title="Github" target="_blank" class="md-footer-social__link fa fa-github-square"></a>
  <a href="https://www.youtube.com/c/HektorProfe" title="Youtube" target="_blank" class="md-footer-social__link fa fa-youtube-square"></a>
  &nbsp;
</div>
 
    </div>
  </div>
  <script>
    (function (i, s, o, g, r, a, m) {
      i["GoogleAnalyticsObject"] = r;
      (i[r] =
        i[r] ||
        function () {
          (i[r].q = i[r].q || []).push(arguments);
        }),
        (i[r].l = 1 * new Date());
      (a = s.createElement(o)), (m = s.getElementsByTagName(o)[0]);
      a.async = 1;
      a.src = g;
      m.parentNode.insertBefore(a, m);
    })(
      window,
      document,
      "script",
      "https://www.google-analytics.com/analytics.js",
      "ga"
    );
    ga("create", "UA-124845547-1", "auto");
    ga("send", "pageview");
  </script>
</footer>
      
      <a id="anchorID" href="https://www.hektorprofe.net/" target="_blank"></a>
    </div>
  <script type='text/javascript' src="/assets/javascripts/application.a26c1c21.js"></script>
  <script src="/assets/javascripts/tingle.min.js"></script>
  <script type='text/javascript'>
    var modalButtonOnly = new tingle.modal({
        closeMethods: [],
        footer: true,
        stickyFooter: true
    });
    var btn5 = document.querySelector('.js-tingle-modal-5');

    // set content
    modalButtonOnly.setContent(`
    <div style="display:grid;grid-template-columns:32% 32% 32%;grid-column-gap: 1.33%;" id="supermodal">
      <div class="course">
        <a href="https://www.hektorprofe.net/cupon/python" target="_blank"><img src="/cdn/assets/python.png" style="width:100%;justify-self:center;align-self:center;"/></a>
      </div>
      <div class="course">
        <a href="https://www.hektorprofe.net/cupon/django" target="_blank"><img src="/cdn/assets/django.png" style="width:100%;justify-self:center;align-self:center;"/></a>
      </div>
      <div class="course">
        <a href="https://www.hektorprofe.net/cupon/pyside" target="_blank"><img src="/cdn/assets/pyside.png" style="width:100%;justify-self:center;align-self:center;"/></a>
      </div>
    </div>`);

    modalButtonOnly.addFooterBtn('Cerrar', 'tingle-btn tingle-btn--default tingle-btn--pull-right', function(){
      modalButtonOnly.close();
    });

    app.initialize({version:"1.2.3",url:{base:"../../.."}})
    var _extends=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var o in n)Object.prototype.hasOwnProperty.call(n,o)&&(t[o]=n[o])}return t},_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t};!function(t,e){"object"===("undefined"==typeof exports?"undefined":_typeof(exports))&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):t.LazyLoad=e()}(this,function(){"use strict";function t(t,e,n){var o=e._settings;!n&&i(t)||(C(o.callback_enter,t),R.indexOf(t.tagName)>-1&&(N(t,e),I(t,o.class_loading)),E(t,e),a(t),C(o.callback_set,t))}var e={elements_selector:"img",container:document,threshold:300,thresholds:null,data_src:"src",data_srcset:"srcset",data_sizes:"sizes",data_bg:"bg",class_loading:"loading",class_loaded:"loaded",class_error:"error",load_delay:0,callback_load:null,callback_error:null,callback_set:null,callback_enter:null,callback_finish:null,to_webp:!1},n=function(t){return _extends({},e,t)},o=function(t,e){return t.getAttribute("data-"+e)},r=function(t,e,n){var o="data-"+e;null!==n?t.setAttribute(o,n):t.removeAttribute(o)},a=function(t){return r(t,"was-processed","true")},i=function(t){return"true"===o(t,"was-processed")},s=function(t,e){return r(t,"ll-timeout",e)},c=function(t){return o(t,"ll-timeout")},l=function(t){return t.filter(function(t){return!i(t)})},u=function(t,e){return t.filter(function(t){return t!==e})},d=function(t,e){var n,o=new t(e);try{n=new CustomEvent("LazyLoad::Initialized",{detail:{instance:o}})}catch(t){(n=document.createEvent("CustomEvent")).initCustomEvent("LazyLoad::Initialized",!1,!1,{instance:o})}window.dispatchEvent(n)},f=function(t,e){return e?t.replace(/\.(jpe?g|png)/gi,".webp"):t},_="undefined"!=typeof window,v=_&&!("onscroll"in window)||/(gle|ing|ro)bot|crawl|spider/i.test(navigator.userAgent),g=_&&"IntersectionObserver"in window,h=_&&"classList"in document.createElement("p"),b=_&&function(){var t=document.createElement("canvas");return!(!t.getContext||!t.getContext("2d"))&&0===t.toDataURL("image/webp").indexOf("data:image/webp")}(),m=function(t,e,n,r){for(var a,i=0;a=t.children[i];i+=1)if("SOURCE"===a.tagName){var s=o(a,n);p(a,e,s,r)}},p=function(t,e,n,o){n&&t.setAttribute(e,f(n,o))},y=function(t,e){var n=b&&e.to_webp,r=o(t,e.data_src),a=o(t,e.data_bg);if(r){var i=f(r,n);t.style.backgroundImage='url("'+i+'")'}if(a){var s=f(a,n);t.style.backgroundImage=s}},w={IMG:function(t,e){var n=b&&e.to_webp,r=e.data_srcset,a=t.parentNode;a&&"PICTURE"===a.tagName&&m(a,"srcset",r,n);var i=o(t,e.data_sizes);p(t,"sizes",i);var s=o(t,r);p(t,"srcset",s,n);var c=o(t,e.data_src);p(t,"src",c,n)},IFRAME:function(t,e){var n=o(t,e.data_src);p(t,"src",n)},VIDEO:function(t,e){var n=e.data_src,r=o(t,n);m(t,"src",n),p(t,"src",r),t.load()}},E=function(t,e){var n=e._settings,o=t.tagName,r=w[o];if(r)return r(t,n),e._updateLoadingCount(1),void(e._elements=u(e._elements,t));y(t,n)},I=function(t,e){h?t.classList.add(e):t.className+=(t.className?" ":"")+e},L=function(t,e){h?t.classList.remove(e):t.className=t.className.replace(new RegExp("(^|\\s+)"+e+"(\\s+|$)")," ").replace(/^\s+/,"").replace(/\s+$/,"")},C=function(t,e){t&&t(e)},O=function(t,e,n){t.addEventListener(e,n)},k=function(t,e,n){t.removeEventListener(e,n)},x=function(t,e,n){O(t,"load",e),O(t,"loadeddata",e),O(t,"error",n)},A=function(t,e,n){k(t,"load",e),k(t,"loadeddata",e),k(t,"error",n)},z=function(t,e,n){var o=n._settings,r=e?o.class_loaded:o.class_error,a=e?o.callback_load:o.callback_error,i=t.target;L(i,o.class_loading),I(i,r),C(a,i),n._updateLoadingCount(-1)},N=function(t,e){var n=function n(r){z(r,!0,e),A(t,n,o)},o=function o(r){z(r,!1,e),A(t,n,o)};x(t,n,o)},R=["IMG","IFRAME","VIDEO"],S=function(e,n,o){t(e,o),n.unobserve(e)},M=function(t){var e=c(t);e&&(clearTimeout(e),s(t,null))},j=function(t,e,n){var o=n._settings.load_delay,r=c(t);r||(r=setTimeout(function(){S(t,e,n),M(t)},o),s(t,r))},D=function(t){return t.isIntersecting||t.intersectionRatio>0},T=function(t){return{root:t.container===document?null:t.container,rootMargin:t.thresholds||t.threshold+"px"}},U=function(t,e){this._settings=n(t),this._setObserver(),this._loadingCount=0,this.update(e)};return U.prototype={_manageIntersection:function(t){var e=this._observer,n=this._settings.load_delay,o=t.target;n?D(t)?j(o,e,this):M(o):D(t)&&S(o,e,this)},_onIntersection:function(t){t.forEach(this._manageIntersection.bind(this))},_setObserver:function(){g&&(this._observer=new IntersectionObserver(this._onIntersection.bind(this),T(this._settings)))},_updateLoadingCount:function(t){this._loadingCount+=t,0===this._elements.length&&0===this._loadingCount&&C(this._settings.callback_finish)},update:function(t){var e=this,n=this._settings,o=t||n.container.querySelectorAll(n.elements_selector);this._elements=l(Array.prototype.slice.call(o)),!v&&this._observer?this._elements.forEach(function(t){e._observer.observe(t)}):this.loadAll()},destroy:function(){var t=this;this._observer&&(this._elements.forEach(function(e){t._observer.unobserve(e)}),this._observer=null),this._elements=null,this._settings=null},load:function(e,n){t(e,this,n)},loadAll:function(){var t=this;this._elements.forEach(function(e){t.load(e)})}},_&&function(t,e){if(e)if(e.length)for(var n,o=0;n=e[o];o+=1)d(t,n);else d(t,e)}(U,window.lazyLoadOptions),U});
    var myLazyLoad = new LazyLoad({elements_selector: ".lazy"});
    const mdMenuItems = document.querySelectorAll('.md-nav__link');
    function doNav(){ document.getElementById("main__list").innerHTML = '<li class="md-nav__item"><a class="md-nav__link" href="/cursos/">Cursos</a></li><li class="md-nav__item"><a class="md-nav__link" href="/blog/">Blog</a></li>';}
    for (i = 0; i < mdMenuItems.length; i++) {  var item = mdMenuItems[i]; var htmlstring = item.innerHTML; htmlstring = (htmlstring.trim) ? htmlstring.trim() : htmlstring.replace(/^\s+/,''); if (htmlstring == 'Servidor de encuentro') { item.parentNode.removeChild(item);continue; }  if (htmlstring == 'Política de Cookies') { item.parentNode.removeChild(item);continue; } if (htmlstring == 'Buscador') { item.parentNode.removeChild(item); continue; } }
    try { var topPos = document.querySelector('#md__active_link').offsetTop; document.querySelector('#md__sidebar__scroll').scrollTop = topPos - 60; } catch (err) {}
  </script>
  </body>
</html>