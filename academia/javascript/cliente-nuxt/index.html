<!DOCTYPE html>
<html lang="es" class="no-js">
  <head>
    
    
    
    

    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      <meta http-equiv="x-ua-compatible" content="ie=edge">
      
        <meta name="description" content="Desarrolla un cliente web sobre la API creada con Django para gestionar tus películas favoritas usando JavaScript y Nuxt.js.">
      
      
        <link rel="canonical" href="https://docs.hektorprofe.net/academia/javascript/cliente-nuxt/">
      
      
        <meta name="author" content="Héctor Costa Guzman">
      
      <link rel="shortcut icon" href="/favicon.ico">
    
    
      
        <title>Cliente en Nuxt.js para API | JavaScript | Academia | Hektor Profe</title>
      
    
    <link rel="stylesheet" href="../../../assets/stylesheets/application.2.css">
    
      
        <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700|Roboto+Mono">
        <style>body,input{font-family:"Roboto","Helvetica Neue",Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono","Courier New",Courier,monospace}</style>
      
    
    
    <link rel="stylesheet" href="/assets/stylesheets/tingle.min.css">
<style>
@font-face{font-family:"Material Icons";font-style:normal;font-weight:400;src:local("Material Icons"),local("MaterialIcons-Regular"),url("/assets/fonts/specimen/MaterialIcons-Regular.woff2") format("woff2"),url("/assets/fonts/specimen/MaterialIcons-Regular.woff") format("woff"),url("/assets/fonts/specimen/MaterialIcons-Regular.ttf") format("truetype")}
[data-md-color-primary="grey"] .md-header { background-color: #191A1D }
[data-md-color-primary="grey"] .md-tabs { background-color: #222831 }
.md-footer-nav { background-color: #222831; }
.md-footer-meta { background-color: #191A1D }
html [data-md-color-primary="grey"] .md-nav--primary .md-nav__title--site { background-color: #191A1D; }
.mini{ display: none; } .maxi{ display: block; }
.embed-container { position: relative; padding-bottom: 56.25%;height: 0; overflow: hidden; max-width: 100%; height: auto; margin-bottom: 0; } 
.embed-container iframe, .embed-container object, .embed-container embed { position: absolute; top: 0; left: 0; width: 100%; height: 100%; }
.md-nav__link:focus, .md-nav__link:hover { color: #018dc5; }
.headerlink{ color: #018dc5 !important; }
.md-footer-links__highlight a{ color: #777 !important; }
.md-footer-links__highlight a:hover{ color: #ddd !important; }
.visible{ display: inherit !important; }
/*.md-tabs { display: none !important; }*/
.nav__btn, .nav__logo{ transition: 0.3s; }
.nav__btn:hover{ color: #aaa; }
.nav__logo:hover{ opacity:.7; }
.nav__logo {max-width: 225px !important; }
img:not([src]){visibility:hidden;}
img.click{opacity: 0.96;box-shadow:rgb(79, 82, 92) -4px 4px}
img.click:hover{opacity: 1;box-shadow:rgb(10, 172, 237) -4px 4px}
.button { background-color: #36bf2d; border: none; color: white !important; padding: 20px 0px; text-align: center; text-decoration: none; display: block; font-size: 97%; width: 100%; font-weight: bold;}
.button:hover { background-color: #4CAF50; color: white; }
.animated.delay-1dot5s {animation-delay: 1.5s;}
.md-icon--search { display:inline-block!important}
a.headerlink{ display: none !important; }
small.edited { display: block; text-align: right; }
#cookie-bar { padding: 1.8rem 1.25rem !important; background: #191A1D  !important; box-shadow:rgba(0, 0, 0, 0.2) 4px 4px 8px 8px; }
#cookie-bar-prompt-logo{ display: none !important; }
div.my-img{text-align:center;margin-top:20px}
@media (max-width: 76.1875em){ .mini{ display: block; } .maxi{ display: none;} /*.md-nav__link[for="nav-1"] { display: none; }*/ }
@media (min-width: 1599.9px){ .md-header-nav__button.md-logo img { height: 37.5px !important; width: 220px; } }
@media (min-width: 1999.9px){ .md-header-nav__button.md-logo img { height: 40px !important; width: 240px; } }
/* Rectificación footer en paginas pequeñas de altura */
@media (max-width: 1599.8px){ .md-container {height: calc(100% - 48px)} }
@media (min-width: 1599.9px){ .md-container {height: calc(100% - 53px)} }
@media (min-width: 1999.9px){ .md-container {height: calc(100% - 58px)} }
@media only screen and (max-width: 959.9px) { .nav__logo { display: block !important; }} 
@media only screen and (min-width: 960px) and (max-width: 76.1875em) { .nav__logo { display: block !important; }} 
@media only screen and (min-width: 76.1875em) { .nav__logo { display: none !important; } } 
@media only screen and (max-width: 76.1875em) { .md-sidebar--primary { left: -26.2rem;; width: 26.2rem; }  [data-md-toggle="drawer"]:checked ~ .md-container .md-sidebar--primary { -webkit-transform: translateX(26.2rem); transform: translateX(26.2rem); } [dir="rtl"] [data-md-toggle="drawer"]:checked ~ .md-container .md-sidebar--primary { -webkit-transform: translateX(-26.2rem); transform: translateX(-26.2rem); } }
@media (min-width: 1219.9px){ #home__btn { display: none !important; } #cursos__btn{ color: white !important; } [data-md-color-primary="grey"] .md-nav__link--active{ color: rgba(0, 0, 0, 0.87); text-decoration: underline !important; } }
@media (min-width: 467.9px){ #discord__btn{ display: inline-block !important; } }
@media only screen and (min-width: 60em){ .md-search__input { background-color: rgb(53, 54, 56); } .md-search__input:hover { background-color: rgb(84, 87, 93); color: white; }}
@media (max-width: 1219.9px){ .md-header-nav__title{ padding: 0 1rem; } .nav__btn {display:none;} }
@media (max-width: 875.9px){ #cookie-bar-button{ margin-top: 20px !important; }}
@media (max-width: 719.9px){ #cookie-bar { padding: 3.25rem 1.25rem; }}
@media (max-width: 512.9px){ #cookie-bar { padding: 2rem 1.25rem; }}

.tingle-modal { font-size:18px !important;}
.tingle-modal-box{ width: 80%; max-width: 1100px; }
.tingle-btn--danger{ background: darkorange !important; }
.tingle-modal-box__content { padding: 3rem 2rem 3rem 3rem;}
@media (max-width: 540px){ .tingle-modal-box{ width: auto; } }
@media (max-width: 849px){ #supermodal{ grid-template-columns:100% !important; }}

.md-sidebar--secondary .md-sidebar__scrollwrap {max-height: calc(100% - 275px - 60px)}
@media (max-width: 1999.9px){.md-sidebar--secondary .md-sidebar__scrollwrap {max-height: calc(100% - 246px - 60px);margin-right:-1px;}}
@media (max-width: 1599.9px){.md-sidebar--secondary .md-sidebar__scrollwrap {max-height: calc(100% - 222px - 60px)}}

</style>
  </head>
  
    
    
    <body dir="ltr" data-md-color-primary="grey" data-md-color-accent="grey">
  
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" data-md-component="overlay" for="__drawer"></label>
    
      <a href="#cliente-con-nuxtjs-para-api-con-drf" tabindex="1" class="md-skip">
        Saltar a contenido
      </a>
    
    
      <header
  class="md-header"
  data-md-component="header"
  style="position: inherit !important"
>
  <nav class="md-header-nav md-grid">
    <div class="md-flex">
      <div class="md-flex__cell md-flex__cell--shrink">
        <a
          href="/"
          title="Hektor Profe"
          class="md-header-nav__button md-logo"
          style="font-size: 0px"
        >
          <img
            src="/assets/images/logo.png"
            width="200px"
            height="35px"
            style="margin-top: -5px"
            alt="Hektor Profe"
            title="Hektor Profe"
          />
        </a>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        <label
          class="md-icon md-icon--menu md-header-nav__button"
          for="__drawer"
        ></label>
      </div>
      <div class="md-flex__cell md-flex__cell--stretch">
        <div
          class="md-flex__ellipsis md-header-nav__title"
          data-md-component="title"
          style="text-align: left"
        >
        <!-- https://fontawesome.com/v4.7.0/ -->
          <a 
            class="nav__btn" 
            href="/" 
            style="margin-left:1em;" 
            title="Archivos de Hektor Profe">
            <i class="fa fa-search" aria-hidden="true" style="color:#0193CA"></i> Buscar en mis apuntes
          </a>
          <a 
            class="nav__btn" 
            href="#" 
            onclick="modalButtonOnly.open()"
            style="margin-left:1.35em;" 
            title="Cursos de Hektor Profe">
            <i class="fa fa-university" aria-hidden="true" style="color:#0193CA"></i> Ofertas cursos Udemy
          </a>
          <a href="/"
            ><img
              class="nav__logo"
              src="/assets/images/logo.png"
              width="200px"
              height="35px"
              style="margin: 6px auto 0"
              alt="Hektor Profe"
              title="Hektor Profe"
          /></a>
        </div>
        <style>
          .md-sidebar[data-md-state="lock"] {
            top: 0rem !important;
          }
          .md-tabs {
            display: none !important;
          }
          .hde {
            display: inline-block;
          }
          .admonition.note > .superfences-tabs > label:hover,
          .headerlink {
            color: #018dc5 !important;
          }
          .admonition.info {
            font-size: 100%;
          }
          .admonition.info label {
            font-size: 91%;
          }
          .admonition.note > .admonition-title {
            display: none;
          }
          .image {
            text-align: center;
            margin-top: 25px;
          }
          .contenedor_youtube {
            position: relative !important;
            padding-bottom: 56.25% !important; /*panorámico*/
            padding-top: 0px !important;
            height: 0 !important;
            margin-top: -20px;
            margin-bottom: 25px;
          }
          .contenedor_youtube iframe {
            position: absolute !important;
            top: 0 !important;
            left: 0 !important;
            width: 100% !important;
            height: 100% !important;
          }
        </style>
      </div>
    </div>
  </nav>
</header>
    
    <div class="md-container" style="padding-top: 0px !important;">
      
        
      
      
        

  

<nav class="md-tabs md-tabs--active" data-md-component="tabs">
    <div class="md-tabs__inner md-grid">
      <ul class="md-tabs__list" id="top__tabs">
        
          <li class="md-tabs__item"><a href="javascript://" class="md-tabs__link">&nbsp;</a></li>
        
          <li class="md-tabs__item"><a href="javascript://" class="md-tabs__link">&nbsp;</a></li>
        
          <li class="md-tabs__item"><a href="javascript://" class="md-tabs__link">&nbsp;</a></li>
        
          <li class="md-tabs__item"><a href="javascript://" class="md-tabs__link">&nbsp;</a></li>
        
          <li class="md-tabs__item"><a href="javascript://" class="md-tabs__link">&nbsp;</a></li>
        
          <li class="md-tabs__item"><a href="javascript://" class="md-tabs__link">&nbsp;</a></li>
        
          <li class="md-tabs__item"><a href="javascript://" class="md-tabs__link">&nbsp;</a></li>
        
          <li class="md-tabs__item"><a href="javascript://" class="md-tabs__link">&nbsp;</a></li>
        
      </ul>
    </div>
</nav>
      
      <main class="md-main">
        <div class="md-main__inner md-grid" data-md-component="container" style="padding-top: 8px !important;">
          
            
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
                <div class="md-sidebar__scrollwrap" id="md__sidebar__scroll">
                  <div class="md-sidebar__inner">
                    <nav class="md-nav md-nav--primary" data-md-level="0">
  <label class="md-nav__title" for="__drawer" style="padding:0 !important;max-height:5.5rem;"></label>
  
  <ul class="md-nav__list" id="main__list" data-md-scrollfix>
    
      
    
        <!-- comprobación extra -->
         
          
          
          

  


  <li class="md-nav__item md-nav__item--active md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-2" type="checkbox" id="nav-2" checked>
    
    <label class="md-nav__link" for="nav-2">
      Academia de programación
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-2">
        Academia de programación
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
            
            
            


  <li class="md-nav__item">
    <a href="../../" title="Índice del archivo" class="md-nav__link">
      Índice del archivo
    </a>
  </li>

        
            
            
            


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-2-2" type="checkbox" id="nav-2-2">
    
    <label class="md-nav__link" for="nav-2-2">
      Lenguaje Python
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-2-2">
        Lenguaje Python
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
            
            
            


  <li class="md-nav__item">
    <a href="../../python/introduccion/" title="Introducción a Python" class="md-nav__link">
      Introducción a Python
    </a>
  </li>

        
            
            
            


  <li class="md-nav__item">
    <a href="../../python/poo-para-interfaces-graficas/" title="POO para interfaces gráficas" class="md-nav__link">
      POO para interfaces gráficas
    </a>
  </li>

        
            
            
            


  <li class="md-nav__item">
    <a href="../../python/proyecto-gestor-clientes/" title="Proyecto gestor de clientes" class="md-nav__link">
      Proyecto gestor de clientes
    </a>
  </li>

        
            
            
            


  <li class="md-nav__item">
    <a href="../../python/tutoriales/" title="Tutoriales sobre Python" class="md-nav__link">
      Tutoriales sobre Python
    </a>
  </li>

        
            
            
            


  <li class="md-nav__item">
    <a href="../../python/modulo-analitico-numpy/" title="Módulo analítico NumPy" class="md-nav__link">
      Módulo analítico NumPy
    </a>
  </li>

        
            
            
            


  <li class="md-nav__item">
    <a href="../../python/modulo-grafico-matplotlib/" title="Módulo gráfico Matplotlib" class="md-nav__link">
      Módulo gráfico Matplotlib
    </a>
  </li>

        
            
            
            


  <li class="md-nav__item">
    <a href="../../django/introduccion/" title="Introducción a Django" class="md-nav__link">
      Introducción a Django
    </a>
  </li>

        
            
            
            


  <li class="md-nav__item">
    <a href="../../django/api-rest-framework/" title="Proyecto API con DRF" class="md-nav__link">
      Proyecto API con DRF
    </a>
  </li>

        
            
            
            


  <li class="md-nav__item">
    <a href="../../django/tutoriales/" title="Tutoriales sobre Django" class="md-nav__link">
      Tutoriales sobre Django
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
            
            
            

  


  <li class="md-nav__item md-nav__item--active md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-2-3" type="checkbox" id="nav-2-3" checked>
    
    <label class="md-nav__link" for="nav-2-3">
      Lenguaje JavaScript
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-2-3">
        Lenguaje JavaScript
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
            
            
            


  <li class="md-nav__item">
    <a href="../introduccion/" title="Introducción a JavaScript" class="md-nav__link">
      Introducción a JavaScript
    </a>
  </li>

        
            
            
            


  <li class="md-nav__item">
    <a href="../conversor-divisas/" title="Proyecto conversor vía API" class="md-nav__link">
      Proyecto conversor vía API
    </a>
  </li>

        
            
            
            


  <li class="md-nav__item">
    <a href="../biblioteca-p5js/" title="Introducción a P5.js" class="md-nav__link">
      Introducción a P5.js
    </a>
  </li>

        
            
            
            


  <li class="md-nav__item">
    <a href="../nodejs/" title="Introducción a Node.js" class="md-nav__link">
      Introducción a Node.js
    </a>
  </li>

        
            
            
            


  <li class="md-nav__item">
    <a href="../chat-heroku/" title="Proyecto chat online" class="md-nav__link">
      Proyecto chat online
    </a>
  </li>

        
            
            
            

  


  <li class="md-nav__item md-nav__item--active">
    
    <input class="md-toggle md-nav__toggle" data-md-toggle="toc" type="checkbox" id="__toc">
    
      
    
    
      <label class="md-nav__link md-nav__link--active" for="__toc">
        Proyecto cliente Nuxt.js
      </label>
    
    <a href="./" title="Proyecto cliente Nuxt.js" class="md-nav__link md-nav__link--active" id="md__active_link">
      Proyecto cliente Nuxt.js
    </a>
    
      
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">Tabla de contenidos</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#creando-nuestro-proyecto" title="Creando nuestro proyecto" class="md-nav__link toc__link">
    Creando nuestro proyecto
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#adaptando-el-diseno-y-las-paginas" title="Adaptando el diseño y las páginas" class="md-nav__link toc__link">
    Adaptando el diseño y las páginas
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#adaptando-el-componente-card" title="Adaptando el componente Card" class="md-nav__link toc__link">
    Adaptando el componente Card
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#anadiendo-una-ventana-modal" title="Añadiendo una ventana modal" class="md-nav__link toc__link">
    Añadiendo una ventana modal
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#axios-y-primera-peticion" title="Axios y primera petición" class="md-nav__link toc__link">
    Axios y primera petición
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#peticiones-cors-a-la-api-de-django" title="Peticiones CORS a la API de Django" class="md-nav__link toc__link">
    Peticiones CORS a la API de Django
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#cargando-las-peliculas" title="Cargando las películas" class="md-nav__link toc__link">
    Cargando las películas
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#buscador-de-peliculas-por-titulo" title="Buscador de películas por título" class="md-nav__link toc__link">
    Buscador de películas por título
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#manejando-la-autenticacion" title="Manejando la autenticación" class="md-nav__link toc__link">
    Manejando la autenticación
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#creando-nuestro-store" title="Creando nuestro store" class="md-nav__link toc__link">
    Creando nuestro store
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#manejando-el-registro" title="Manejando el registro" class="md-nav__link toc__link">
    Manejando el registro
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#pagina-de-peliculas-favoritas" title="Página de películas favoritas" class="md-nav__link toc__link">
    Página de películas favoritas
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#manejando-las-favoritas-en-el-store" title="Manejando las favoritas en el store" class="md-nav__link toc__link">
    Manejando las favoritas en el store
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#anadiendo-el-boton-de-accion" title="Añadiendo el botón de acción" class="md-nav__link toc__link">
    Añadiendo el botón de acción
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#implementando-un-plugin-de-alertas" title="Implementando un plugin de alertas" class="md-nav__link toc__link">
    Implementando un plugin de alertas
  </a>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
    
  </li>

        
      </ul>
    </nav>
  </li>

        
            
            
            


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-2-4" type="checkbox" id="nav-2-4">
    
    <label class="md-nav__link" for="nav-2-4">
      GNU/Linux
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-2-4">
        GNU/Linux
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
            
            
            


  <li class="md-nav__item">
    <a href="../../gnu-linux/ubuntu-server-web/" title="Configurar Ubuntu Server" class="md-nav__link">
      Configurar Ubuntu Server
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
      </ul>
    </nav>
  </li>

        
      
    
      
    
      
    
      
    
      
    
      
    
      
    
  </ul>
</nav>

                  </div>
                </div>
              </div>
            

            
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
                
                  
                    <div class="course-offer" style="margin-bottom:25px;padding:0px 10px;">
                      <a href="https://www.udemy.com/course/python-3-al-completo-desde-cero/?couponCode=2522EB41FF2C2033D661" target="_blank">
                        <img src="/cdn/assets/python.png" style="width:100%;justify-self:center;align-self:center;"/>
                      </a>
                    </div>
                  
                

                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">Tabla de contenidos</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#creando-nuestro-proyecto" title="Creando nuestro proyecto" class="md-nav__link toc__link">
    Creando nuestro proyecto
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#adaptando-el-diseno-y-las-paginas" title="Adaptando el diseño y las páginas" class="md-nav__link toc__link">
    Adaptando el diseño y las páginas
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#adaptando-el-componente-card" title="Adaptando el componente Card" class="md-nav__link toc__link">
    Adaptando el componente Card
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#anadiendo-una-ventana-modal" title="Añadiendo una ventana modal" class="md-nav__link toc__link">
    Añadiendo una ventana modal
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#axios-y-primera-peticion" title="Axios y primera petición" class="md-nav__link toc__link">
    Axios y primera petición
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#peticiones-cors-a-la-api-de-django" title="Peticiones CORS a la API de Django" class="md-nav__link toc__link">
    Peticiones CORS a la API de Django
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#cargando-las-peliculas" title="Cargando las películas" class="md-nav__link toc__link">
    Cargando las películas
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#buscador-de-peliculas-por-titulo" title="Buscador de películas por título" class="md-nav__link toc__link">
    Buscador de películas por título
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#manejando-la-autenticacion" title="Manejando la autenticación" class="md-nav__link toc__link">
    Manejando la autenticación
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#creando-nuestro-store" title="Creando nuestro store" class="md-nav__link toc__link">
    Creando nuestro store
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#manejando-el-registro" title="Manejando el registro" class="md-nav__link toc__link">
    Manejando el registro
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#pagina-de-peliculas-favoritas" title="Página de películas favoritas" class="md-nav__link toc__link">
    Página de películas favoritas
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#manejando-las-favoritas-en-el-store" title="Manejando las favoritas en el store" class="md-nav__link toc__link">
    Manejando las favoritas en el store
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#anadiendo-el-boton-de-accion" title="Añadiendo el botón de acción" class="md-nav__link toc__link">
    Añadiendo el botón de acción
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#implementando-un-plugin-de-alertas" title="Implementando un plugin de alertas" class="md-nav__link toc__link">
    Implementando un plugin de alertas
  </a>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
                
                
                <h1 id="cliente-con-nuxtjs-para-api-con-drf">Cliente con Nuxt.js para API con DRF<a class="headerlink" href="#cliente-con-nuxtjs-para-api-con-drf" title="Permanent link">&para;</a></h1>
<div class="contenedor_youtube">
  <iframe width="838" height="470" src="https://www.youtube.com/embed/CgXjkh9AM08" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>
</div>

<p>Este curso es una continuación del <u><a href="/academia/django/api-rest-framework/">Proyecto API con DRF</a></u>, en el que utilizando un framework JavaScript llamado Nuxt.js (basado en Vue.js), os enseñaré a crear un cliente web SPA.</p>
<p>El cliente nos ofrecerá tanto formularios de registro como de identificación y contará con dos páginas, una para visualizar el top de películas y realizar búsquedas, y otra para gestionar sus películas favoritas, ya que éstas se podrán marcar o desmarcar fácilmente y gestionarse en la propia sección.</p>
<p>Por si fuera poco añadiremos también unas alertas <span style="font-weight:500">toast</span> asíncronas que quedan geniales.</p>
<p><strong>Repositorio</strong>: <a href="https://github.com/hektorprofe/curso-spa-peliculas-nuxt" target="_blank">https://github.com/hektorprofe/curso-spa-peliculas-nuxt</a></p>
<h2 id="creando-nuestro-proyecto">Creando nuestro proyecto<a class="headerlink" href="#creando-nuestro-proyecto" title="Permanent link">&para;</a></h2>
<p>Este curso es una continuación del <a href="/curso/proyecto-api-peliculas-django-rest-framework">Proyecto API de pelis con DRF</a>, en el que utilizando un framework JavaScript llamado Nuxt.js (basado en Vue.js), os enseñaré a crear un cliente web SPA.</p>
<p>El cliente nos ofrecerá tanto formularios de registro como de identificación y contará con dos páginas, una para visualizar el top de películas y realizar búsquedas, y otra para gestionar sus películas favoritas, ya que éstas se podrán marcar o desmarcar fácilmente y gestionarse en la propia sección.</p>
<p>Por si fuera poco añadiremos también unas alertas <span style="font-weight:500">toast</span> asíncronas que quedan geniales.</p>
<p>Dicho lo cual, teniendo Node.js instalado, desde la terminal ejecutamos:</p>
<div class="highlight"><pre><span></span><code>npx create-nuxt-app cli_peliculas
</code></pre></div>
<p>Tendremos que elegir las siguientes opciones:</p>
<ul>
<li>Project name: <strong>Enter</strong></li>
<li>Project description: <strong>Enter</strong></li>
<li>Author name: <strong>Enter</strong></li>
<li>Package manager: <strong>npm</strong></li>
<li>UI Framework: <strong>Buefy</strong></li>
<li>Custom server framework: <strong>none</strong></li>
<li>Nuxt.js modules: <strong>Axios</strong></li>
<li>Linting tools: <strong>Enter</strong></li>
<li>Test framework: <strong>Enter</strong></li>
<li>Rendering mode: <strong>SPA</strong></li>
</ul>
<p>Esto nos creará una SPA básica usando Nuxt.js y la UI de Buefy automáticamente, vamos a echarle un vistazo:</p>
<div class="highlight"><pre><span></span><code><span class="nb">cd</span> .<span class="se">\c</span>li_pelis<span class="se">\</span>
npm run dev
</code></pre></div>
<p>Si accedemos a la url <a href="http://localhost:3000">http://localhost:3000</a> podréis ver que la SPA ya cuenta con dos páginas y un diseño adaptativo basado en Bulma pero utilizando Buefy como librería de componentes para Vue.</p>
<p>Podríamos borrar lo que hay y construir nuestro cliente desde cero, pero he pensado que es mejor adaptar lo que tenemos, así nos centramos en lo importante.</p>
<h2 id="adaptando-el-diseno-y-las-paginas">Adaptando el diseño y las páginas<a class="headerlink" href="#adaptando-el-diseno-y-las-paginas" title="Permanent link">&para;</a></h2>
<p>Ya en VSC y con nuestro proyecto en marcha vamos a modificar un poco su estructura.</p>
<p>Seguramente la primera pregunta que tendréis sea... ¿cómo maneja Nuxt.js las páginas?, pues muy fácil, lo hace a través de componentes en el directorio pages.</p>
<p>Ahí encontraremos dos: <strong>index.vue</strong> e <strong>inspire.vue</strong>. La página <strong>index.vue</strong>, como podéis suponer hace referencia a la raíz del sitio, mientras que inspire es una página cualquier. De hecho, dejando de banda index, el nombre que damos al componente de la página concuerda con el que debemos poner en la URL para acceder a ella. </p>
<p>Con eso en mente vamos a modificar el nombre <strong>inspire.vue</strong> a <strong>favoritas.vue</strong>.</p>
<p>Al hacerlo dejará de funcionar, eso es porque en el menú el enlace sigue apuntando a la anterior, vamos a editarlo… ¿pero dónde se encuentra?</p>
<p>Si las páginas son componentes, éstas deben cargarse dentro de algún sitio, ¿no? Pues ese sitio es el layout principal. Lo encontraremos en <strong>layouts/default.vue</strong>, que es que se utiliza por defecto.</p>
<p>Como podréis observar en este fichero no encontramos las típicas cabeceras de html, head y body. Nuxt.js funciona con componentes y código JavaScript, de manera que para configurar esa parte hay que hacerlo editando el fichero de configuración <strong>nuxt.config.js</strong>.</p>
<p>Sea como sea vamos a editar el enlace del menú. Por defecto se nos ha creado dinámicamente, vamos a ponerlo manual y ya que estamos cambiaremos los iconos y lo haremos un poco más ancho:</p>
<p><code>layouts/default.vue</code>
<div class="highlight"><pre><span></span><code><span class="p">&lt;</span><span class="nt">aside</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;column is-3 section&quot;</span><span class="p">&gt;</span> <span class="c">&lt;!-- 3 en lugar de 2 y 9 por 10 --&gt;</span>
  <span class="p">&lt;</span><span class="nt">p</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;menu-label is-hidden-touch&quot;</span><span class="p">&gt;</span>General<span class="p">&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
  <span class="p">&lt;</span><span class="nt">ul</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;menu-list&quot;</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">li</span><span class="p">&gt;</span>
      <span class="p">&lt;</span><span class="nt">nuxt-link</span> <span class="na">to</span><span class="o">=</span><span class="s">&quot;/&quot;</span> <span class="na">exact-active-class</span><span class="o">=</span><span class="s">&quot;is-active&quot;</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">b-icon</span> <span class="na">icon</span><span class="o">=</span><span class="s">&quot;video&quot;</span><span class="p">/&gt;</span>
        Películas
      <span class="p">&lt;/</span><span class="nt">nuxt-link</span><span class="p">&gt;</span>
    <span class="p">&lt;/</span><span class="nt">li</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">li</span><span class="p">&gt;</span>
      <span class="p">&lt;</span><span class="nt">nuxt-link</span> <span class="na">to</span><span class="o">=</span><span class="s">&quot;/favoritas&quot;</span> <span class="na">exact-active-class</span><span class="o">=</span><span class="s">&quot;is-active&quot;</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">b-icon</span> <span class="na">icon</span><span class="o">=</span><span class="s">&quot;star&quot;</span><span class="p">/&gt;</span>
        Favoritas
      <span class="p">&lt;/</span><span class="nt">nuxt-link</span><span class="p">&gt;</span>
    <span class="p">&lt;/</span><span class="nt">li</span><span class="p">&gt;</span>
  <span class="p">&lt;/</span><span class="nt">ul</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">aside</span><span class="p">&gt;</span>
</code></pre></div></p>
<p>Aprovecharemos para cambiar también el título del proyecto:</p>
<div class="highlight"><pre><span></span><code><span class="p">&lt;</span><span class="nt">a</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;navbar-item&quot;</span> <span class="na">href</span><span class="o">=</span><span class="s">&quot;/&quot;</span><span class="p">&gt;</span>Super Películas<span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;</span>
</code></pre></div>
<p>Lo siguiente que podemos hacer es preparar el menú superior para mostrar los botones de registro y login. </p>
<p>Siguiendo la estructura de un navbar en bulma, tal como indican en la <a href="https://bulma.io/documentation/components/navbar/">documentación</a>, vamos a añadir un par de botones a la parte derecha:</p>
<div class="highlight"><pre><span></span><code><span class="c">&lt;!-- Contenido del menú, al nivel del navbar-brand--&gt;</span>
<span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;navbar-menu&quot;</span><span class="p">&gt;</span>
  <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;navbar-end&quot;</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;navbar-item&quot;</span><span class="p">&gt;</span>
      <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;buttons&quot;</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">a</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;button&quot;</span><span class="p">&gt;</span>
          <span class="p">&lt;</span><span class="nt">strong</span><span class="p">&gt;</span>Registro<span class="p">&lt;/</span><span class="nt">strong</span><span class="p">&gt;</span>
        <span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">a</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;button is-light&quot;</span><span class="p">&gt;</span>
          Acceder
        <span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;</span>
      <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
    <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
  <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
</code></pre></div>
<p>Implementar el funcionamiento del menú desplegable sería muy tedioso, pero gracias a Vue podemos implementar su funcionamiento en un santiamén. </p>
<p>Para forzar que se muestre el menú superior al presionar el botón en dispositivos móviles necesitamos forzar su visualización con CSS, ya que éste se esconde automáticamente.</p>
<p>Podríamos crear una variable en el componente llamada <em>isActive</em>, por defecto le daremos false indicando que el menú estará plegado:</p>
<div class="highlight"><pre><span></span><code><span class="k">export</span> <span class="k">default</span> <span class="p">{</span>
 <span class="nx">data</span><span class="p">()</span> <span class="p">{</span>
   <span class="k">return</span> <span class="p">{</span>
     <span class="nx">isActive</span><span class="o">:</span> <span class="kc">false</span><span class="p">,</span>
   <span class="p">}</span>
 <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<p>Cuando hagamos clic en la hamburguesa haremos un toggle, cambiando el valor con un evento clic:</p>
<div class="highlight"><pre><span></span><code><span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;navbar-burger&quot;</span> <span class="err">@</span><span class="na">click</span><span class="o">=</span><span class="s">&quot;isActive = !isActive&quot;</span><span class="p">&gt;</span>
</code></pre></div>
<p>A la clase CSS que siempre visualizará el contenido podríamos llamarla <em>active</em>:</p>
<div class="highlight"><pre><span></span><code><span class="p">.</span><span class="nc">active</span><span class="p">{</span>
  <span class="k">display</span><span class="p">:</span> <span class="kc">block</span> <span class="cp">!important</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div>
<p>Ya sólo nos falta añadirla condicionada al nav-menu usando el bind class:</p>
<div class="highlight"><pre><span></span><code><span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;navbar-menu&quot;</span> <span class="na">:class</span><span class="o">=</span><span class="s">&quot;{ active: isActive }&quot;</span><span class="p">&gt;</span>
</code></pre></div>
<p>Finalmente podríamos editar el contenido de las páginas, pero no lo vamos a borrar todo, dejaremos por lo menos una tarjeta para usarla como base de las películas:</p>
<p><code>pages/index.vue</code>
<div class="highlight"><pre><span></span><code><span class="p">&lt;</span><span class="nt">template</span><span class="p">&gt;</span>
 <span class="p">&lt;</span><span class="nt">section</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;section&quot;</span><span class="p">&gt;</span>
   <span class="p">&lt;</span><span class="nt">h2</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;title&quot;</span><span class="p">&gt;</span>Películas<span class="p">&lt;/</span><span class="nt">h2</span><span class="p">&gt;</span>
   <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;columns is-mobile&quot;</span><span class="p">&gt;</span>
     <span class="p">&lt;</span><span class="nt">card</span>
       <span class="na">title</span><span class="o">=</span><span class="s">&quot;Free&quot;</span>
       <span class="na">icon</span><span class="o">=</span><span class="s">&quot;github-circle&quot;</span>
     <span class="p">&gt;</span>
       Open source on 
       <span class="p">&lt;</span><span class="nt">a</span> <span class="na">href</span><span class="o">=</span><span class="s">&quot;https://github.com/buefy/buefy&quot;</span><span class="p">&gt;</span> GitHub<span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;</span>
     <span class="p">&lt;/</span><span class="nt">card</span><span class="p">&gt;</span>
   <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
 <span class="p">&lt;/</span><span class="nt">section</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">template</span><span class="p">&gt;</span>
</code></pre></div></p>
<p><code>pages/favoritas.vue</code>
<div class="highlight"><pre><span></span><code><span class="p">&lt;</span><span class="nt">template</span><span class="p">&gt;</span>
 <span class="p">&lt;</span><span class="nt">section</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;section&quot;</span><span class="p">&gt;</span>
   <span class="p">&lt;</span><span class="nt">h2</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;title&quot;</span><span class="p">&gt;</span>Favoritas<span class="p">&lt;/</span><span class="nt">h2</span><span class="p">&gt;</span>
 <span class="p">&lt;/</span><span class="nt">section</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">template</span><span class="p">&gt;</span>
</code></pre></div></p>
<h2 id="adaptando-el-componente-card">Adaptando el componente Card<a class="headerlink" href="#adaptando-el-componente-card" title="Permanent link">&para;</a></h2>
<p>Vamos a preparar el componente central en torno al que gira la SPA, la tarjeta para las películas.</p>
<p>El componente que ahora crea esa cajita en la portada se llama Card, el mismo que tiene esta estructura en Bulma. Tal como está no nos sirve, necesitamos adaptarla un poco. </p>
<p>Lo primero que podemos hacer es cambiarle el nombre, en lugar de <strong>Card.vue</strong> podríamos llamarla <strong>Peli.vue</strong>.</p>
<p>Obviamente al cambiarle el nombre dejará de funcionar, tendremos que adaptarlo al importarlo:</p>
<p><code>pages/index.vue</code>
<div class="highlight"><pre><span></span><code><span class="k">import</span> <span class="nx">Peli</span> <span class="nx">from</span> <span class="s1">&#39;~/components/Peli&#39;</span>

<span class="k">export</span> <span class="k">default</span> <span class="p">{</span>
  <span class="nx">components</span><span class="o">:</span> <span class="p">{</span>
    <span class="nx">Peli</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></p>
<p>Y al usarlo:</p>
<div class="highlight"><pre><span></span><code><span class="p">&lt;</span><span class="nt">Peli</span>
  <span class="na">title</span><span class="o">=</span><span class="s">&quot;Free&quot;</span>
  <span class="na">icon</span><span class="o">=</span><span class="s">&quot;github-circle&quot;</span>
<span class="p">&gt;</span>
  Open source on 
  <span class="p">&lt;</span><span class="nt">a</span> <span class="na">href</span><span class="o">=</span><span class="s">&quot;https://github.com/buefy/buefy&quot;</span><span class="p">&gt;</span> GitHub<span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">Peli</span><span class="p">&gt;</span>
</code></pre></div>
<p>¿Creamos algunas pelis de prueba? Mockup data que se dice.</p>
<p>Vamos a añadir una lista con objetos simulando lo que recibiremos de la API, cada uno formado por los campos: id, título, favoritos, imagen, estreno y resumen. </p>
<p>Podéis copiarlos tal cual os los dejo aquí abajo:</p>
<div class="highlight"><pre><span></span><code> <span class="err">da</span><span class="kc">ta</span><span class="p">:</span> <span class="kc">fun</span><span class="err">c</span><span class="kc">t</span><span class="err">io</span><span class="kc">n</span> <span class="err">()</span> <span class="p">{</span>
   <span class="err">re</span><span class="kc">turn</span> <span class="p">{</span>
     <span class="err">&#39;pelis&#39;</span><span class="p">:</span> <span class="p">[</span>
       <span class="p">{</span>
         <span class="err">&#39;id&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
         <span class="err">&#39;</span><span class="kc">t</span><span class="err">i</span><span class="kc">tul</span><span class="err">o&#39;</span><span class="p">:</span> <span class="err">&#39;El</span> <span class="err">Padri</span><span class="kc">n</span><span class="err">o&#39;</span><span class="p">,</span>
         <span class="err">&#39;</span><span class="kc">fa</span><span class="err">vori</span><span class="kc">t</span><span class="err">os&#39;</span><span class="p">:</span> <span class="err">&#39;</span><span class="mi">3</span><span class="err">&#39;</span><span class="p">,</span>
         <span class="err">&#39;image</span><span class="kc">n</span><span class="err">&#39;</span><span class="p">:</span> <span class="err">&#39;h</span><span class="kc">tt</span><span class="err">ps</span><span class="p">:</span><span class="err">//m.media</span><span class="mi">-</span><span class="err">amazo</span><span class="kc">n</span><span class="err">.com/images/M/MV</span><span class="mi">5</span><span class="err">BM</span><span class="mi">2</span><span class="err">MyNjYxNmU</span><span class="kc">t</span><span class="err">YTAwNi</span><span class="mi">00</span><span class="err">MTYxLWJmNWY</span><span class="kc">t</span><span class="err">YzZlODY</span><span class="mi">3</span><span class="err">ZTk</span><span class="mi">3</span><span class="err">OTFlXkEyXkFqcGdeQXVyNzkwMjQ</span><span class="mi">5</span><span class="err">NzM@._V</span><span class="mi">1</span><span class="err">_UY</span><span class="mi">268</span><span class="err">_CR</span><span class="mi">3</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">182</span><span class="p">,</span><span class="mi">268</span><span class="err">_AL_.jpg&#39;</span><span class="p">,</span>
         <span class="err">&#39;es</span><span class="kc">tren</span><span class="err">o&#39;</span><span class="p">:</span> <span class="err">&#39;</span><span class="mi">1972</span><span class="err">&#39;</span><span class="p">,</span>
         <span class="err">&#39;resume</span><span class="kc">n</span><span class="err">&#39;</span><span class="p">:</span> <span class="err">&#39;The</span> <span class="err">agi</span><span class="kc">n</span><span class="err">g</span> <span class="err">pa</span><span class="kc">tr</span><span class="err">iarch</span> <span class="err">o</span><span class="kc">f</span> <span class="err">a</span><span class="kc">n</span> <span class="err">orga</span><span class="kc">n</span><span class="err">ized</span> <span class="err">crime</span> <span class="err">dy</span><span class="kc">nast</span><span class="err">y</span> <span class="kc">transfers</span> <span class="err">co</span><span class="kc">ntr</span><span class="err">ol</span> <span class="err">o</span><span class="kc">f</span> <span class="err">his</span> <span class="err">cla</span><span class="kc">n</span><span class="err">des</span><span class="kc">t</span><span class="err">i</span><span class="kc">ne</span> <span class="err">empire</span> <span class="kc">t</span><span class="err">o</span> <span class="err">his</span> <span class="err">reluc</span><span class="kc">tant</span> <span class="err">so</span><span class="kc">n</span><span class="err">.&#39;</span><span class="p">,</span>
       <span class="p">},</span>
       <span class="p">{</span>
         <span class="err">&#39;id&#39;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span>
         <span class="err">&#39;</span><span class="kc">t</span><span class="err">i</span><span class="kc">tul</span><span class="err">o&#39;</span><span class="p">:</span> <span class="err">&#39;El</span> <span class="err">Padri</span><span class="kc">n</span><span class="err">o</span><span class="p">:</span> <span class="err">Par</span><span class="kc">te</span> <span class="mi">2</span><span class="err">&#39;</span><span class="p">,</span>
         <span class="err">&#39;</span><span class="kc">fa</span><span class="err">vori</span><span class="kc">t</span><span class="err">os&#39;</span><span class="p">:</span> <span class="err">&#39;</span><span class="mi">1</span><span class="err">&#39;</span><span class="p">,</span>
         <span class="err">&#39;image</span><span class="kc">n</span><span class="err">&#39;</span><span class="p">:</span> <span class="err">&#39;h</span><span class="kc">tt</span><span class="err">ps</span><span class="p">:</span><span class="err">//m.media</span><span class="mi">-</span><span class="err">amazo</span><span class="kc">n</span><span class="err">.com/images/M/MV</span><span class="mi">5</span><span class="err">BMWMwMGQzZTI</span><span class="kc">t</span><span class="err">Y</span><span class="mi">2</span><span class="err">JlNC</span><span class="mi">00</span><span class="err">OWZiLWIyMDc</span><span class="kc">t</span><span class="err">NDk</span><span class="mi">2</span><span class="err">ZDQ</span><span class="mi">2</span><span class="err">YjRjMWQ</span><span class="mi">0</span><span class="err">XkEyXkFqcGdeQXVyNzkwMjQ</span><span class="mi">5</span><span class="err">NzM@._V</span><span class="mi">1</span><span class="err">_UY</span><span class="mi">268</span><span class="err">_CR</span><span class="mi">3</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">182</span><span class="p">,</span><span class="mi">268</span><span class="err">_AL_.jpg&#39;</span><span class="p">,</span>
         <span class="err">&#39;es</span><span class="kc">tren</span><span class="err">o&#39;</span><span class="p">:</span> <span class="err">&#39;</span><span class="mi">1974</span><span class="err">&#39;</span><span class="p">,</span>
         <span class="err">&#39;resume</span><span class="kc">n</span><span class="err">&#39;</span><span class="p">:</span> <span class="err">&#39;The</span> <span class="err">early</span> <span class="err">li</span><span class="kc">fe</span> <span class="err">a</span><span class="kc">n</span><span class="err">d</span> <span class="err">career</span> <span class="err">o</span><span class="kc">f</span> <span class="err">Vi</span><span class="kc">t</span><span class="err">o</span> <span class="err">Corleo</span><span class="kc">ne</span> <span class="err">i</span><span class="kc">n</span> <span class="mi">1920</span><span class="err">s</span> <span class="err">New</span> <span class="err">York</span> <span class="err">Ci</span><span class="kc">t</span><span class="err">y</span> <span class="err">is</span> <span class="err">por</span><span class="kc">tra</span><span class="err">yed</span><span class="p">,</span> <span class="err">while</span> <span class="err">his</span> <span class="err">so</span><span class="kc">n</span><span class="p">,</span> <span class="err">Michael</span><span class="p">,</span> <span class="err">expa</span><span class="kc">n</span><span class="err">ds</span> <span class="err">a</span><span class="kc">n</span><span class="err">d</span> <span class="kc">t</span><span class="err">igh</span><span class="kc">tens</span> <span class="err">his</span> <span class="err">grip</span> <span class="err">o</span><span class="kc">n</span> <span class="kc">t</span><span class="err">he</span> <span class="kc">fa</span><span class="err">mily</span> <span class="err">crime</span> <span class="err">sy</span><span class="kc">n</span><span class="err">dica</span><span class="kc">te</span><span class="err">.&#39;</span><span class="p">,</span>
       <span class="p">},</span>
       <span class="p">{</span>
         <span class="err">&#39;id&#39;</span><span class="p">:</span> <span class="mi">3</span><span class="p">,</span>
         <span class="err">&#39;</span><span class="kc">t</span><span class="err">i</span><span class="kc">tul</span><span class="err">o&#39;</span><span class="p">:</span> <span class="err">&#39;El</span> <span class="err">Padri</span><span class="kc">n</span><span class="err">o</span><span class="p">:</span> <span class="err">Par</span><span class="kc">te</span> <span class="mi">3</span><span class="err">&#39;</span><span class="p">,</span>
         <span class="err">&#39;</span><span class="kc">fa</span><span class="err">vori</span><span class="kc">t</span><span class="err">os&#39;</span><span class="p">:</span> <span class="err">&#39;</span><span class="mi">0</span><span class="err">&#39;</span><span class="p">,</span>
         <span class="err">&#39;image</span><span class="kc">n</span><span class="err">&#39;</span><span class="p">:</span> <span class="err">&#39;h</span><span class="kc">tt</span><span class="err">ps</span><span class="p">:</span><span class="err">//m.media</span><span class="mi">-</span><span class="err">amazo</span><span class="kc">n</span><span class="err">.com/images/M/MV</span><span class="mi">5</span><span class="err">BNTc</span><span class="mi">1</span><span class="err">YjhiNzk</span><span class="kc">t</span><span class="err">MjEyNS</span><span class="mi">00</span><span class="err">YmNhLWExYjI</span><span class="kc">t</span><span class="err">ZDhkNWJjZjYxOWZiXkEyXkFqcGdeQXVyNzkwMjQ</span><span class="mi">5</span><span class="err">NzM@._V</span><span class="mi">1</span><span class="err">_UX</span><span class="mi">182</span><span class="err">_CR</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">182</span><span class="p">,</span><span class="mi">268</span><span class="err">_AL_.jpg&#39;</span><span class="p">,</span>
         <span class="err">&#39;es</span><span class="kc">tren</span><span class="err">o&#39;</span><span class="p">:</span> <span class="err">&#39;</span><span class="mi">1990</span><span class="err">&#39;</span><span class="p">,</span>
         <span class="err">&#39;resume</span><span class="kc">n</span><span class="err">&#39;</span><span class="p">:</span> <span class="err">&#39;I</span><span class="kc">n</span> <span class="kc">t</span><span class="err">he</span> <span class="err">mids</span><span class="kc">t</span> <span class="err">o</span><span class="kc">f</span> <span class="kc">tr</span><span class="err">yi</span><span class="kc">n</span><span class="err">g</span> <span class="kc">t</span><span class="err">o</span> <span class="err">legi</span><span class="kc">t</span><span class="err">imize</span> <span class="err">his</span> <span class="err">busi</span><span class="kc">ness</span> <span class="err">deali</span><span class="kc">n</span><span class="err">gs</span> <span class="err">i</span><span class="kc">n</span> <span class="err">New</span> <span class="err">York</span> <span class="err">Ci</span><span class="kc">t</span><span class="err">y</span> <span class="err">a</span><span class="kc">n</span><span class="err">d</span> <span class="err">I</span><span class="kc">tal</span><span class="err">y</span> <span class="err">i</span><span class="kc">n</span> <span class="mi">1979</span><span class="p">,</span> <span class="err">agi</span><span class="kc">n</span><span class="err">g</span> <span class="err">Ma</span><span class="kc">f</span><span class="err">ia</span> <span class="err">Do</span><span class="kc">n</span> <span class="err">Michael</span> <span class="err">Corleo</span><span class="kc">ne</span> <span class="err">seeks</span> <span class="kc">t</span><span class="err">o</span> <span class="err">avow</span> <span class="kc">f</span><span class="err">or</span> <span class="err">his</span> <span class="err">si</span><span class="kc">ns</span><span class="p">,</span> <span class="err">while</span> <span class="kc">ta</span><span class="err">ki</span><span class="kc">n</span><span class="err">g</span> <span class="err">his</span> <span class="kc">ne</span><span class="err">phew</span> <span class="err">Vi</span><span class="kc">n</span><span class="err">ce</span><span class="kc">nt</span> <span class="err">Ma</span><span class="kc">n</span><span class="err">ci</span><span class="kc">n</span><span class="err">i</span> <span class="err">u</span><span class="kc">n</span><span class="err">der</span> <span class="err">his</span> <span class="err">wi</span><span class="kc">n</span><span class="err">g.&#39;</span><span class="p">,</span>
       <span class="p">}</span>
     <span class="p">]</span>
   <span class="p">}</span>
 <span class="p">},</span>
</code></pre></div>
<p>Ahora necesitamos iterar este array y enviar los datos de cada peli al componente. Es muy fácil:</p>
<div class="highlight"><pre><span></span><code><span class="p">&lt;</span><span class="nt">Peli</span>
 <span class="na">v-for</span><span class="o">=</span><span class="s">&quot;peli in pelis&quot;</span>
 <span class="na">:key</span><span class="o">=</span><span class="s">&quot;peli.id&quot;</span>
 <span class="na">:peli</span><span class="o">=</span><span class="s">&quot;peli&quot;</span>
<span class="p">/&gt;</span>
</code></pre></div>
<p>Usando el v-for repetimos el componente para cada película que guardamos en peli. El v-for requiere indicar una :key única para identificar cada componente, le podemos asignar la id de la película. Por último podemos enviar una propiedad con todo el objeto peli al componente.</p>
<p>Con esto veremos que se crean 3 cajas, pero sin contenido. Lo que debemos hacer es adaptar el componente para extraer los datos de la propiedad peli y hacer uso de ellos:</p>
<div class="highlight"><pre><span></span><code><span class="k">export</span> <span class="k">default</span> <span class="p">{</span>
 <span class="nx">props</span><span class="o">:</span> <span class="p">{</span>
   <span class="nx">peli</span><span class="o">:</span> <span class="p">{</span>
     <span class="nx">type</span><span class="o">:</span> <span class="nb">Object</span>
   <span class="p">}</span>
 <span class="p">},</span>
<span class="p">}</span>
</code></pre></div>
<p>La estructura de la película es algo más tediosa de programar porque requiere código de Bulma, os voy a facilitar un template básico para no liarnos demasiado:</p>
<p><code>components/Peli.vue</code>
<div class="highlight"><pre><span></span><code><span class="p">&lt;</span><span class="nt">template</span><span class="p">&gt;</span>
 <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;column is-full-mobile is-half-tablet </span>
<span class="s">             is-one-third-desktop is-one-quarter-widescreen&quot;</span><span class="p">&gt;</span>
   <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;card&quot;</span><span class="p">&gt;</span>
     <span class="p">&lt;</span><span class="nt">header</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;card-header&quot;</span><span class="p">&gt;</span>
       <span class="p">&lt;</span><span class="nt">p</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;card-header-title&quot;</span><span class="p">&gt;</span>{{ peli.titulo }}<span class="p">&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
     <span class="p">&lt;/</span><span class="nt">header</span><span class="p">&gt;</span>
     <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;card-image&quot;</span><span class="p">&gt;</span>
       <span class="p">&lt;</span><span class="nt">figure</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;image&quot;</span><span class="p">&gt;</span>
         <span class="p">&lt;</span><span class="nt">img</span> <span class="na">:src</span><span class="o">=</span><span class="s">&quot;peli.imagen&quot;</span><span class="p">&gt;</span>
       <span class="p">&lt;/</span><span class="nt">figure</span><span class="p">&gt;</span>
     <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
     <span class="p">&lt;</span><span class="nt">footer</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;card-footer&quot;</span><span class="p">&gt;</span>
       <span class="p">&lt;</span><span class="nt">a</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;button is-light card-footer-item&quot;</span><span class="p">&gt;</span>
         <span class="p">&lt;</span><span class="nt">span</span><span class="p">&gt;</span>{{ peli.favoritos }}<span class="p">&lt;/</span><span class="nt">span</span><span class="p">&gt;</span>
         <span class="p">&lt;</span><span class="nt">b-icon</span> <span class="na">icon</span><span class="o">=</span><span class="s">&quot;star&quot;</span><span class="p">&gt;&lt;/</span><span class="nt">b-icon</span><span class="p">&gt;</span>
       <span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;</span>
     <span class="p">&lt;/</span><span class="nt">footer</span><span class="p">&gt;</span>
   <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
 <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">template</span><span class="p">&gt;</span>
</code></pre></div></p>
<p>Este diseño se adapta a las diferentes pantallas usando la grid de columnas de Bulma, parecido a como funciona Boostrap.</p>
<p>Sea como sea ya deberían aparecer las películas, lo malo es que nos surgirá un pequeño problema al estrechar la pantalla, y es que desaparecen las pelis horizontalmente. </p>
<p>El fallo lo podemos solucionar fácilmente indicando que el contenedor de columns en el <strong>index.vue</strong> acepta multilíneas:</p>
<p><code>pages/index.vue</code>
<div class="highlight"><pre><span></span><code><span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;columns is-multiline&quot;</span><span class="p">&gt;</span>
</code></pre></div></p>
<h2 id="anadiendo-una-ventana-modal">Añadiendo una ventana modal<a class="headerlink" href="#anadiendo-una-ventana-modal" title="Permanent link">&para;</a></h2>
<p>Con lo que tenemos hasta ahora vamos más que sobrados, pero me pareció interesante ilustraros lo que nos facilita buefy tareas como crear una ventana modal.</p>
<p>La idea es que al hacer clic en la película nos aparezca el resumen en este componente emergente. Esto podría parecer un gran trabajo, pero como cada peli es una instancia del mismo componente es muy fácil de implementar. </p>
<p>Primero necesitamos una variable para controlar si mostrar o no una ventana modal:</p>
<p><code>components/Peli.vue</code>
<div class="highlight"><pre><span></span><code><span class="nx">data</span><span class="p">()</span> <span class="p">{</span>
  <span class="k">return</span> <span class="p">{</span>
    <span class="nx">isModalActive</span><span class="o">:</span> <span class="kc">false</span>
  <span class="p">};</span>
<span class="p">},</span>
</code></pre></div></p>
<p>Ahora siguiendo el ejemplo de la <a href="https://buefy.org/documentation/modal/">documentación</a> de Buefy os facilito el código de la modal, que podemos poner justo debajo del footer de la peli o donde queráis, ya que a fin de cuentas emergerá por encima de todo lo demás:</p>
<div class="highlight"><pre><span></span><code><span class="c">&lt;!-- Modal para el resumen y año de estreno --&gt;</span>
<span class="p">&lt;</span><span class="nt">b-modal</span> <span class="na">:active</span><span class="err">.</span><span class="na">sync</span><span class="o">=</span><span class="s">&quot;isModalActive&quot;</span><span class="p">&gt;</span>
 <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;card&quot;</span><span class="p">&gt;</span>
   <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;card-content&quot;</span><span class="p">&gt;</span>
     <span class="p">&lt;</span><span class="nt">h2</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;title&quot;</span><span class="p">&gt;</span>
       {{ peli.titulo }}
       <span class="p">&lt;</span><span class="nt">small</span><span class="p">&gt;</span>({{ peli.estreno }})<span class="p">&lt;/</span><span class="nt">small</span><span class="p">&gt;</span>
     <span class="p">&lt;/</span><span class="nt">h2</span><span class="p">&gt;</span>
     <span class="p">&lt;</span><span class="nt">p</span><span class="p">&gt;</span>{{peli.resumen}}<span class="p">&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
   <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
 <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">b-modal</span><span class="p">&gt;</span>
</code></pre></div>
<p>Fijaros en el atributo <strong>active:sync</strong>, ahí es donde pasamos la variable que controla si mostrar o no la modal; así que como podéis suponer sólo necesitamos añadir el evento clic a algún lado y cambiar su valor de false a true. Ese sitio puede ser la propia imagen de la película:</p>
<div class="highlight"><pre><span></span><code> <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;card-image&quot;</span> <span class="err">@</span><span class="na">click</span><span class="o">=</span><span class="s">&quot;isModalActive=true&quot;</span><span class="p">&gt;</span>
</code></pre></div>
<p>Si queréis un efecto más chulo podéis añadir un poco de CSS cambiando el cursor a manita tanto en la imagen como en el fondo oscuro de la modal, eso daría una pista al usuario de que puede hacer clic ahí:</p>
<div class="highlight"><pre><span></span><code><span class="p">.</span><span class="nc">card-image</span><span class="o">,</span>
<span class="p">.</span><span class="nc">modal-background</span> <span class="p">{</span>
  <span class="k">cursor</span><span class="p">:</span> <span class="kc">pointer</span> <span class="cp">!important</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div>
<p>Tomaos un descanso porque en la siguiente sección empezamos a darle caña a la API.</p>
<h2 id="axios-y-primera-peticion">Axios y primera petición<a class="headerlink" href="#axios-y-primera-peticion" title="Permanent link">&para;</a></h2>
<p>Axios es un cliente http basado en promesas que nos permitirá interactuar fácilmente con la api, para hacerlo deberemos configurar la ruta raíz en el fichero <strong>nuxt.config.js</strong>:</p>
<p><code>nuxt.config.js</code>
<div class="highlight"><pre><span></span><code><span class="nx">axios</span><span class="o">:</span> <span class="p">{</span>
  <span class="nx">baseURL</span><span class="o">:</span> <span class="s2">&quot;http://127.0.0.1:8844/api/v1&quot;</span>
<span class="p">},</span>
</code></pre></div></p>
<p>Para cargar las películas en la portada de nuestra página vamos a utilizar el método asyncData de Nuxt.js. En él importamos el módulo axios y realizaremos la petición:</p>
<p><code>pages/index.vue</code>
<div class="highlight"><pre><span></span><code><span class="nx">asyncData</span> <span class="p">({</span> <span class="nx">$axios</span> <span class="p">})</span> <span class="p">{</span>
  <span class="k">return</span> <span class="nx">$axios</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;/peliculas/&#39;</span><span class="p">)</span>
  <span class="p">.</span><span class="nx">then</span><span class="p">((</span><span class="nx">res</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">res</span><span class="p">)</span>
  <span class="p">})</span>
<span class="p">}</span>
</code></pre></div></p>
<p>Ahora si tenemos funcionando la API que enseñé a crear en mi otro curso y cargamos la página veremos que nos da un error cuando axios hace la petición, en la consola podremos leer:</p>
<div class="highlight"><pre><span></span><code>Access to XMLHttpRequest at &#39;http://127.0.0.1:8844/api/v1/peliculas/&#39;
from origin &#39;http://localhost:3000&#39; has been blocked by CORS policy: 
No &#39;Access-Control-Allow-Origin&#39; header is present on the requested 
resource.
</code></pre></div>
<p>¿Qué significa el error y cómo lo solucionamos? Lo veremos en la próxima lección.</p>
<h2 id="peticiones-cors-a-la-api-de-django">Peticiones CORS a la API de Django<a class="headerlink" href="#peticiones-cors-a-la-api-de-django" title="Permanent link">&para;</a></h2>
<p>El error nos está indicando que el servidor Django no está configurado para aceptar el intercambio de recursos de origen cruzado o CORS (Cross-origin resource sharing en inglés). En otras palabras, pese a que el cliente y la API se ejecutan en la misma ip local 127.0.0.1, al estar en puertos diferentes no se permite el acceso.</p>
<p>Para solucionarlo deberemos hacer un inciso y modificar nuestro servidor para permitir las peticiones desde la URL 127.0.0.1:3000 que es donde se ejecuta el cliente en desarrollo.</p>
<p>Lo único que tendremos que hacer es instalar y configurar una app de Django llamada <a href="https://github.com/ottoyiu/django-cors-headers/">Django Cors Headers</a>:</p>
<div class="highlight"><pre><span></span><code>pipenv install django-cors-headers<span class="o">==</span><span class="m">2</span>.4.0
</code></pre></div>
<p>Ahora tenemos que activarla y configurarla en el <strong>settings.py</strong> añadiendo en la lista blanca la ip o dominios donde queremos permitir CORS:</p>
<div class="highlight"><pre><span></span><code><span class="n">INSTALLED_APPS</span> <span class="o">=</span> <span class="p">(</span>  <span class="o">...</span>
  <span class="s1">&#39;corsheaders&#39;</span><span class="p">,</span>
<span class="p">)</span>

<span class="n">MIDDLEWARE</span> <span class="o">=</span> <span class="p">[</span>  <span class="o">...</span>
  <span class="s1">&#39;corsheaders.middleware.CorsMiddleware&#39;</span><span class="p">,</span>
  <span class="s1">&#39;django.middleware.common.CommonMiddleware&#39;</span><span class="p">,</span>
<span class="p">]</span>

<span class="n">CORS_ORIGIN_WHITELIST</span> <span class="o">=</span> <span class="p">(</span>
  <span class="s1">&#39;localhost:3000&#39;</span><span class="p">,</span>
  <span class="s1">&#39;127.0.0.1:3000&#39;</span>
<span class="p">)</span>
</code></pre></div>
<p>Un vez configurados los cors headers si actualizamos la página del cliente ya debería cargar los datos, lo podemos comprobar en el apartado Network del inspector de Chrome.</p>
<h2 id="cargando-las-peliculas">Cargando las películas<a class="headerlink" href="#cargando-las-peliculas" title="Permanent link">&para;</a></h2>
<p>Ahora que tenemos la información sólo tenemos que sustituir los datos de prueba por los que recibimos. Lo haremos borrando el array 'pelis' de data y devolviendo el nuevo 'data' asíncrono en el método asyncData de Nuxt.js:</p>
<p><code>pages/index.vue</code>
<div class="highlight"><pre><span></span><code><span class="nx">asyncData</span> <span class="p">({</span> <span class="nx">$axios</span> <span class="p">})</span> <span class="p">{</span>
  <span class="k">return</span> <span class="nx">$axios</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;/peliculas/&#39;</span><span class="p">)</span>
  <span class="p">.</span><span class="nx">then</span><span class="p">((</span><span class="nx">res</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
    <span class="k">return</span> <span class="p">{</span>
      <span class="s1">&#39;pelis&#39;</span><span class="o">:</span> <span class="nx">res</span><span class="p">.</span><span class="nx">data</span>
    <span class="p">}</span>
  <span class="p">})</span>
<span class="p">}</span>
</code></pre></div></p>
<p>Con esto tenemos la magia hecha y al cargar la página ya nos aparecerán las películas en la portada cargadas a través de la API.</p>
<p>Si quisiéramos que aparezcan las películas ordenadas de más a menos favoritos, podríamos cambiar la query de axios añadiendo el filtro programado en DRF:</p>
<div class="highlight"><pre><span></span><code><span class="k">return</span> <span class="nx">$axios</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;/peliculas/?ordering=-favoritos&#39;</span><span class="p">)</span>
</code></pre></div>
<h2 id="buscador-de-peliculas-por-titulo">Buscador de películas por título<a class="headerlink" href="#buscador-de-peliculas-por-titulo" title="Permanent link">&para;</a></h2>
<p>Lo último que nos falta en la portada sería añadir un pequeño buscador por título. La API que creamos cuenta un sistema de búsqueda así que podríamos hacer uso de él.</p>
<p>Vamos a empezar creando una variable reactiva para controlar un input de texto:</p>
<p><code>pages/index.vue</code>
<div class="highlight"><pre><span></span><code><span class="nx">data</span><span class="p">()</span> <span class="p">{</span>
  <span class="k">return</span> <span class="p">{</span>
    <span class="nx">searchText</span><span class="o">:</span> <span class="s1">&#39;&#39;</span>
  <span class="p">};</span>
<span class="p">},</span>
</code></pre></div></p>
<p>El formulario que manejará esta parte tendrá in input con un v-model que enlazará esta variable, y además un par de botones para buscar y reiniciar el filtro, podéis copiarlo tal cual:</p>
<div class="highlight"><pre><span></span><code><span class="c">&lt;!-- Empieza la parte de la búsqueda --&gt;</span>
<span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;columns&quot;</span><span class="p">&gt;</span>
  <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;column&quot;</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">form</span> <span class="na">action</span><span class="o">=</span><span class="s">&quot;&quot;</span> <span class="na">v-on:submit</span><span class="err">.</span><span class="na">prevent</span><span class="o">=</span><span class="s">&quot;search&quot;</span><span class="p">&gt;</span>
      <span class="p">&lt;</span><span class="nt">b-input</span>
        <span class="na">type</span><span class="o">=</span><span class="s">&quot;text&quot;</span>
        <span class="na">id</span><span class="o">=</span><span class="s">&quot;searchInput&quot;</span>
        <span class="na">v-model</span><span class="o">=</span><span class="s">&quot;searchText&quot;</span>
        <span class="na">placeholder</span><span class="o">=</span><span class="s">&quot;Filtro por título&quot;</span>
        <span class="na">required</span><span class="p">&gt;</span>
      <span class="p">&lt;/</span><span class="nt">b-input</span><span class="p">&gt;</span>
    <span class="p">&lt;/</span><span class="nt">form</span><span class="p">&gt;</span>
  <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
  <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;column&quot;</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">a</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;button is-primary&quot;</span> <span class="err">@</span><span class="na">click</span><span class="o">=</span><span class="s">&quot;search&quot;</span><span class="p">&gt;</span>Buscar<span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;</span> <span class="ni">&amp;nbsp;</span>
    <span class="p">&lt;</span><span class="nt">a</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;button is-info&quot;</span> <span class="err">@</span><span class="na">click</span><span class="o">=</span><span class="s">&quot;clear&quot;</span><span class="p">&gt;</span>Limpiar<span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;</span>
  <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">br</span><span class="p">&gt;</span>
<span class="c">&lt;!-- Fin de la búsqueda --&gt;</span>
</code></pre></div>
<p>Ahora crearemos los dos métodos que se encargarán de hacer la petición, así como desactivar el input, algo importante sobretodo en dispositivos móviles para esconder el teclado virtual:</p>
<div class="highlight"><pre><span></span><code><span class="nx">search</span> <span class="p">()</span> <span class="p">{</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">pelis</span> <span class="o">=</span> <span class="p">[]</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">$el</span><span class="p">.</span><span class="nx">querySelector</span><span class="p">(</span><span class="s1">&#39;#searchInput&#39;</span><span class="p">).</span><span class="nx">blur</span><span class="p">()</span>  <span class="c1">// esconder teclado</span>
  <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">$axios</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;/peliculas/&#39;</span><span class="p">,</span> <span class="p">{</span>
    <span class="nx">params</span><span class="o">:</span> <span class="p">{</span>
      <span class="s1">&#39;search&#39;</span><span class="o">:</span> <span class="k">this</span><span class="p">.</span><span class="nx">searchText</span><span class="p">,</span>
      <span class="s1">&#39;ordering&#39;</span><span class="o">:</span> <span class="s1">&#39;-favoritos&#39;</span>
    <span class="p">}</span>
  <span class="p">})</span>
  <span class="p">.</span><span class="nx">then</span><span class="p">((</span><span class="nx">res</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">pelis</span> <span class="o">=</span> <span class="nx">res</span><span class="p">.</span><span class="nx">data</span>
  <span class="p">})</span>
<span class="p">},</span>
<span class="nx">clear</span> <span class="p">()</span> <span class="p">{</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">searchText</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="p">;</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">search</span><span class="p">()</span>
<span class="p">}</span>
</code></pre></div>
<p>Con esto tendremos el sistema de búsqueda implementado.</p>
<h2 id="manejando-la-autenticacion">Manejando la autenticación<a class="headerlink" href="#manejando-la-autenticacion" title="Permanent link">&para;</a></h2>
<p>Empezamos esta sección donde implementaremos el sistema de usuarios en el cliente, primeros haremos la parte de la autenticación y cuando la tengamos añadiremos el registro.</p>
<p>Vamos a crear un pequeño formulario de login que aparezca en una ventana modal cuando hacemos clic en el enlace del menú superior.</p>
<p>Este es el código de la modal, podéis copiarlo directamente:</p>
<p><code>layouts/default.vue</code>
<div class="highlight"><pre><span></span><code><span class="c">&lt;!-- Modal para el login --&gt;</span>
<span class="p">&lt;</span><span class="nt">b-modal</span> <span class="na">:active</span><span class="err">.</span><span class="na">sync</span><span class="o">=</span><span class="s">&quot;isLoginActive&quot;</span><span class="p">&gt;</span>
  <span class="p">&lt;</span><span class="nt">form</span> <span class="na">action</span><span class="o">=</span><span class="s">&quot;&quot;</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;modal-card&quot;</span> <span class="na">style</span><span class="o">=</span><span class="s">&quot;width: auto&quot;</span><span class="p">&gt;</span>
      <span class="p">&lt;</span><span class="nt">header</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;modal-card-head&quot;</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">p</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;modal-card-title&quot;</span><span class="p">&gt;</span>Identificación<span class="p">&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
      <span class="p">&lt;/</span><span class="nt">header</span><span class="p">&gt;</span>
      <span class="p">&lt;</span><span class="nt">section</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;modal-card-body&quot;</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">b-field</span> <span class="na">label</span><span class="o">=</span><span class="s">&quot;Email&quot;</span><span class="p">&gt;</span>
          <span class="p">&lt;</span><span class="nt">b-input</span>
            <span class="na">type</span><span class="o">=</span><span class="s">&quot;email&quot;</span>
            <span class="na">v-model</span><span class="o">=</span><span class="s">&quot;loginEmail&quot;</span>
            <span class="na">placeholder</span><span class="o">=</span><span class="s">&quot;Tu email&quot;</span>
            <span class="na">required</span><span class="p">&gt;</span>
          <span class="p">&lt;/</span><span class="nt">b-input</span><span class="p">&gt;</span>
        <span class="p">&lt;/</span><span class="nt">b-field</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">b-field</span> <span class="na">label</span><span class="o">=</span><span class="s">&quot;Contraseña&quot;</span><span class="p">&gt;</span>
          <span class="p">&lt;</span><span class="nt">b-input</span>
            <span class="na">type</span><span class="o">=</span><span class="s">&quot;password&quot;</span> 
            <span class="na">v-model</span><span class="o">=</span><span class="s">&quot;loginPassword&quot;</span>
            <span class="na">password-reveal</span>
            <span class="na">placeholder</span><span class="o">=</span><span class="s">&quot;Tu contraseña&quot;</span>
            <span class="na">required</span><span class="p">&gt;</span>
          <span class="p">&lt;/</span><span class="nt">b-input</span><span class="p">&gt;</span>
        <span class="p">&lt;/</span><span class="nt">b-field</span><span class="p">&gt;</span>
    <span class="p">&lt;/</span><span class="nt">section</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">footer</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;modal-card-foot&quot;</span><span class="p">&gt;</span>
      <span class="p">&lt;</span><span class="nt">button</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;button is-primary&quot;</span><span class="p">&gt;</span>Acceder<span class="p">&lt;/</span><span class="nt">button</span><span class="p">&gt;</span>
    <span class="p">&lt;/</span><span class="nt">footer</span><span class="p">&gt;</span>
    <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
  <span class="p">&lt;/</span><span class="nt">form</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">b-modal</span><span class="p">&gt;</span>
</code></pre></div></p>
<p>Hace uso de tres variables reactivas, dos cadenas con un email y un password (al que podemos dar datos de prueba para ahorrarnos tiempo), y también otra variable para controlar si se muestra o no:</p>
<div class="highlight"><pre><span></span><code><span class="nx">isLoginActive</span><span class="o">:</span> <span class="kc">false</span><span class="p">,</span>

<span class="nx">loginEmail</span><span class="o">:</span> <span class="s1">&#39;test@test.com&#39;</span><span class="p">,</span>
<span class="nx">loginPassword</span><span class="o">:</span> <span class="s1">&#39;TEST1234A&#39;</span><span class="p">,</span>
</code></pre></div>
<p>Como podéis suponer esta variable la modificaremos al hacer clic en el botón de Acceder:</p>
<div class="highlight"><pre><span></span><code><span class="p">&lt;</span><span class="nt">a</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;button is-light&quot;</span> <span class="err">@</span><span class="na">click</span><span class="o">=</span><span class="s">&quot;isLoginActive=true&quot;</span><span class="p">&gt;</span>
  Acceder
<span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;</span>
</code></pre></div>
<p>Lo siguiente es capturar el momento que se envía el formulario y en lugar de hacer una petición automática ejecutar un método para gestionar la petición, por ejemplo 'login':</p>
<div class="highlight"><pre><span></span><code><span class="nx">methods</span><span class="o">:</span> <span class="p">{</span>
  <span class="nx">login</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">$axios</span><span class="p">.</span><span class="nx">post</span><span class="p">(</span><span class="s1">&#39;/auth/login/&#39;</span><span class="p">,</span> <span class="p">{</span>
      <span class="nx">email</span><span class="o">:</span> <span class="k">this</span><span class="p">.</span><span class="nx">loginEmail</span><span class="p">,</span>
      <span class="nx">password</span><span class="o">:</span> <span class="k">this</span><span class="p">.</span><span class="nx">loginPassword</span>
    <span class="p">})</span>
    <span class="p">.</span><span class="nx">then</span><span class="p">((</span><span class="nx">res</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">res</span><span class="p">.</span><span class="nx">data</span><span class="p">.</span><span class="nx">key</span><span class="p">){</span>
      <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">res</span><span class="p">.</span><span class="nx">data</span><span class="p">.</span><span class="nx">key</span><span class="p">)</span>
      <span class="p">}</span>
    <span class="p">})</span>
    <span class="p">.</span><span class="k">catch</span><span class="p">((</span><span class="nx">err</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
      <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">err</span><span class="p">);</span>
    <span class="p">})</span>
  <span class="p">}</span>
 <span class="p">}</span>
</code></pre></div>
<p>Para prevenir el envío automático y llamar al método lo haremos así:</p>
<div class="highlight"><pre><span></span><code><span class="p">&lt;</span><span class="nt">form</span> <span class="na">action</span><span class="o">=</span><span class="s">&quot;&quot;</span> <span class="na">v-on:submit</span><span class="err">.</span><span class="na">prevent</span><span class="o">=</span><span class="s">&quot;login&quot;</span><span class="p">&gt;</span>
</code></pre></div>
<p>Si probamos deberíamos recibir correctamente la key, o sea el token. </p>
<p>El siguiente paso será almacenarlo para poder utilizarlo en cualquier lugar de nuestra aplicación, de manera que podamos saber en todo momento si estamos o no autenticados.</p>
<h2 id="creando-nuestro-store">Creando nuestro store<a class="headerlink" href="#creando-nuestro-store" title="Permanent link">&para;</a></h2>
<p>Un store es como un almacén de datos transversal accesible desde cualquier parte de nuestra aplicación. Nuxt implementa el store <a href="https://nuxtjs.org/guide/vuex-store/">Vuex</a> en su núcleo, por lo que es relativamente fácil empezar a trabajar, sólo tenemos que crear el fichero <strong>index.js</strong> dentro del directorio <em>store/</em>.</p>
<p>Sin embargo hay dos cosas a tener en cuenta sobre Vuex:</p>
<ul>
<li>
<p>Los estados (o datos del store, por decirlo de alguna forma) son reactivos, de manera que si se modifica, el cambio se reflejará instantáneamente en toda la aplicación.</p>
</li>
<li>
<p>El segundo es que no se puede mutar un estado directamente, es necesario hacer lo que denomina un “commit”. Esto asegura que los cambios dejan un rastro, lo que nos permite entender mejor nuestras aplicaciones.</p>
</li>
</ul>
<p>Hay dos estados que vamos a manejar en nuestra aplicación, el primero es el token y el segundo un "nombre" de usuario. En realidad no será el nombre, simplemente extraemos la primera parte del email.</p>
<p>Para añadir nuestros los dos estados lo haremos así:</p>
<p><code>store/index.js</code>
<div class="highlight"><pre><span></span><code><span class="k">export</span> <span class="kd">const</span> <span class="nx">state</span> <span class="o">=</span> <span class="p">()</span> <span class="p">=&gt;</span> <span class="p">({</span>
  <span class="nx">token</span><span class="o">:</span> <span class="kc">null</span><span class="p">,</span>
  <span class="nx">user</span><span class="o">:</span> <span class="kc">null</span>
<span class="p">})</span>
</code></pre></div></p>
<p>Justo debajo necesitamos crear un par de mutaciones para establecer sus valores:</p>
<div class="highlight"><pre><span></span><code><span class="k">export</span> <span class="kd">const</span> <span class="nx">mutations</span> <span class="o">=</span> <span class="p">{</span>
  <span class="nx">saveUser</span><span class="p">(</span><span class="nx">state</span><span class="p">,</span> <span class="nx">user</span><span class="p">){</span>
    <span class="nx">state</span><span class="p">.</span><span class="nx">user</span> <span class="o">=</span> <span class="nx">user</span><span class="p">;</span>
  <span class="p">},</span>
  <span class="nx">saveToken</span><span class="p">(</span><span class="nx">state</span><span class="p">,</span> <span class="nx">token</span><span class="p">){</span>
    <span class="nx">state</span><span class="p">.</span><span class="nx">token</span> <span class="o">=</span> <span class="nx">token</span><span class="p">;</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<p>Una vez lo tengamos podemos empezar a trabajar con nuestro Store. </p>
<p>Justo en el momento del login almacenaremos los valores si recibimos correctamente el token de la API, también esconderemos la ventana modal del formulario de login:</p>
<p><code>layouts/default.vue</code>
<div class="highlight"><pre><span></span><code><span class="nx">login</span><span class="p">()</span> <span class="p">{</span>
  <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">$axios</span><span class="p">.</span><span class="nx">post</span><span class="p">(</span><span class="s1">&#39;/auth/login/&#39;</span><span class="p">,</span> <span class="p">{</span>
    <span class="nx">email</span><span class="o">:</span> <span class="k">this</span><span class="p">.</span><span class="nx">loginEmail</span><span class="p">,</span>
    <span class="nx">password</span><span class="o">:</span> <span class="k">this</span><span class="p">.</span><span class="nx">loginPassword</span>
  <span class="p">})</span>
  <span class="p">.</span><span class="nx">then</span><span class="p">((</span><span class="nx">res</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">res</span><span class="p">.</span><span class="nx">data</span><span class="p">.</span><span class="nx">key</span><span class="p">){</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">$store</span><span class="p">.</span><span class="nx">commit</span><span class="p">(</span><span class="s1">&#39;saveToken&#39;</span><span class="p">,</span> <span class="nx">res</span><span class="p">.</span><span class="nx">data</span><span class="p">.</span><span class="nx">key</span><span class="p">)</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">$store</span><span class="p">.</span><span class="nx">commit</span><span class="p">(</span><span class="s1">&#39;saveUser&#39;</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">loginEmail</span><span class="p">.</span><span class="nx">split</span><span class="p">(</span><span class="s2">&quot;@&quot;</span><span class="p">)[</span><span class="mf">0</span><span class="p">])</span>
      <span class="c1">// Reiniciamos los campos</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">loginEmail</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">loginPassword</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
      <span class="c1">// Escondemos la modal</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">isLoginActive</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
    <span class="p">}</span>
  <span class="p">})</span>
  <span class="p">.</span><span class="k">catch</span><span class="p">((</span><span class="nx">error</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
    <span class="nx">alert</span><span class="p">(</span><span class="nb">Object</span><span class="p">.</span><span class="nx">values</span><span class="p">(</span><span class="nx">error</span><span class="p">.</span><span class="nx">response</span><span class="p">.</span><span class="nx">data</span><span class="p">))</span>
  <span class="p">})</span>
<span class="p">},</span>
</code></pre></div></p>
<p>Con esto deberíamos ser capaces de identificarnos al hacer login, el problema es que no podemos saber si realmente estamos identificados o no. Bueno, sí que podemos, debugeando el valor de nuestros estados en medio del código o usando la extensión <a href="https://chrome.google.com/webstore/detail/vuejs-devtools/nhdogjmejiglipccpnnnanhbledajbpd?hl=es">Vue Devtools</a> de Chrome, bastante recomendable para estos casos.</p>
<p>Una forma interesante de acceder a los estados es usar un valor computado, esto evita algunos errores sobretodo usando apps universales con SSR.</p>
<div class="highlight"><pre><span></span><code><span class="nx">computed</span><span class="o">:</span> <span class="p">{</span>
  <span class="nx">user</span><span class="o">:</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
    <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">$store</span><span class="p">.</span><span class="nx">state</span><span class="p">.</span><span class="nx">user</span><span class="p">;</span>
  <span class="p">}</span>
<span class="p">},</span>
</code></pre></div>
<p>Con esto podemos consultar el nombre del usuario autenticado en todo momento y alternar algunas opciones en el menú superior:</p>
<div class="highlight"><pre><span></span><code><span class="p">&lt;</span><span class="nt">a</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;button&quot;</span> <span class="na">v-if</span><span class="o">=</span><span class="s">&quot;!user&quot;</span><span class="p">&gt;</span>
  <span class="p">&lt;</span><span class="nt">strong</span><span class="p">&gt;</span>Registro<span class="p">&lt;/</span><span class="nt">strong</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">a</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;button is-primary&quot;</span> <span class="na">v-else</span><span class="p">&gt;</span>
  Bienvenido  😄
<span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">a</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;button is-light&quot;</span> <span class="err">@</span><span class="na">click</span><span class="o">=</span><span class="s">&quot;isLoginActive=true&quot;</span> <span class="na">v-if</span><span class="o">=</span><span class="s">&quot;!user&quot;</span><span class="p">&gt;</span>
  Acceder
<span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">a</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;button is-light&quot;</span> <span class="err">@</span><span class="na">click</span><span class="o">=</span><span class="s">&quot;logout&quot;</span> <span class="na">v-else</span><span class="p">&gt;</span>
  Salir
<span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;</span>
</code></pre></div>
<p>Ya sólo nos faltaría crear el método para hacer el Logout, cuyo propósito sería simplemente establecer los estados a null:</p>
<div class="highlight"><pre><span></span><code><span class="nx">logout</span><span class="p">()</span> <span class="p">{</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">$store</span><span class="p">.</span><span class="nx">commit</span><span class="p">(</span><span class="s1">&#39;saveToken&#39;</span><span class="p">,</span> <span class="kc">null</span><span class="p">)</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">$store</span><span class="p">.</span><span class="nx">commit</span><span class="p">(</span><span class="s1">&#39;saveUser&#39;</span><span class="p">,</span> <span class="kc">null</span><span class="p">)</span>
<span class="p">}</span>
</code></pre></div>
<h2 id="manejando-el-registro">Manejando el registro<a class="headerlink" href="#manejando-el-registro" title="Permanent link">&para;</a></h2>
<p>Como podéis suponer el proceso de registro no será muy diferente al de autenticación. Necesitaremos pasar un email y dos contraseñas repetidas. Si es correcto directamente se devolverá el token y haremos el login.</p>
<p>Evidentemente en un desarrollo más profesional deberíamos enviar el email de verificación a los usuarios, pero como este proyecto es para aprender el funcionamiento general los registraremos directamente.</p>
<p>Empezaremos creando una segunda modal para el registro, podemos ponerla debajo de la de login:</p>
<p><code>layouts/default.vue</code>
<div class="highlight"><pre><span></span><code><span class="c">&lt;!-- Modal para el registro --&gt;</span>
<span class="p">&lt;</span><span class="nt">b-modal</span> <span class="na">:active</span><span class="err">.</span><span class="na">sync</span><span class="o">=</span><span class="s">&quot;isRegisterActive&quot;</span><span class="p">&gt;</span>
  <span class="p">&lt;</span><span class="nt">form</span> <span class="na">action</span><span class="o">=</span><span class="s">&quot;&quot;</span> <span class="na">v-on:submit</span><span class="err">.</span><span class="na">prevent</span><span class="o">=</span><span class="s">&quot;register&quot;</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;modal-card&quot;</span> <span class="na">style</span><span class="o">=</span><span class="s">&quot;width: auto&quot;</span><span class="p">&gt;</span>
      <span class="p">&lt;</span><span class="nt">header</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;modal-card-head&quot;</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">p</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;modal-card-title&quot;</span><span class="p">&gt;</span>Registro<span class="p">&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
      <span class="p">&lt;/</span><span class="nt">header</span><span class="p">&gt;</span>
      <span class="p">&lt;</span><span class="nt">section</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;modal-card-body&quot;</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">b-field</span> <span class="na">label</span><span class="o">=</span><span class="s">&quot;Email&quot;</span><span class="p">&gt;</span>
          <span class="p">&lt;</span><span class="nt">b-input</span>
            <span class="na">type</span><span class="o">=</span><span class="s">&quot;email&quot;</span>
            <span class="na">v-model</span><span class="o">=</span><span class="s">&quot;registerEmail&quot;</span>
            <span class="na">placeholder</span><span class="o">=</span><span class="s">&quot;Tu email&quot;</span>
            <span class="na">required</span><span class="p">&gt;</span>
          <span class="p">&lt;/</span><span class="nt">b-input</span><span class="p">&gt;</span>
        <span class="p">&lt;/</span><span class="nt">b-field</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">b-field</span> <span class="na">label</span><span class="o">=</span><span class="s">&quot;Contraseña&quot;</span><span class="p">&gt;</span>
          <span class="p">&lt;</span><span class="nt">b-input</span>
            <span class="na">type</span><span class="o">=</span><span class="s">&quot;password&quot;</span> 
            <span class="na">v-model</span><span class="o">=</span><span class="s">&quot;registerPassword1&quot;</span>
            <span class="na">password-reveal</span>
            <span class="na">placeholder</span><span class="o">=</span><span class="s">&quot;Tu contraseña&quot;</span>
            <span class="na">required</span><span class="p">&gt;</span>
          <span class="p">&lt;/</span><span class="nt">b-input</span><span class="p">&gt;</span>
        <span class="p">&lt;/</span><span class="nt">b-field</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">b-field</span> <span class="na">label</span><span class="o">=</span><span class="s">&quot;Repite la contraseña&quot;</span><span class="p">&gt;</span>
          <span class="p">&lt;</span><span class="nt">b-input</span>
            <span class="na">type</span><span class="o">=</span><span class="s">&quot;password&quot;</span> 
            <span class="na">v-model</span><span class="o">=</span><span class="s">&quot;registerPassword2&quot;</span>
            <span class="na">password-reveal</span>
            <span class="na">placeholder</span><span class="o">=</span><span class="s">&quot;Tu contraseña&quot;</span>
            <span class="na">required</span><span class="p">&gt;</span>
          <span class="p">&lt;/</span><span class="nt">b-input</span><span class="p">&gt;</span>
        <span class="p">&lt;/</span><span class="nt">b-field</span><span class="p">&gt;</span>
      <span class="p">&lt;/</span><span class="nt">section</span><span class="p">&gt;</span>
      <span class="p">&lt;</span><span class="nt">footer</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;modal-card-foot&quot;</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">button</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;button is-primary&quot;</span><span class="p">&gt;</span>Registrarse<span class="p">&lt;/</span><span class="nt">button</span><span class="p">&gt;</span>
      <span class="p">&lt;/</span><span class="nt">footer</span><span class="p">&gt;</span>
    <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
  <span class="p">&lt;/</span><span class="nt">form</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">b-modal</span><span class="p">&gt;</span>
</code></pre></div></p>
<p>Ésta hará uso de las siguientes variables:</p>
<div class="highlight"><pre><span></span><code><span class="nx">isRegisterActive</span><span class="o">:</span> <span class="kc">false</span><span class="p">,</span>

<span class="nx">registerEmail</span><span class="o">:</span> <span class="s1">&#39;&#39;</span><span class="p">,</span>
<span class="nx">registerPassword1</span><span class="o">:</span> <span class="s1">&#39;&#39;</span><span class="p">,</span>
<span class="nx">registerPassword2</span><span class="o">:</span><span class="s1">&#39;&#39;</span><span class="p">,</span>
</code></pre></div>
<p>Y se abrirá al hacer clic en el botón de registro del menú superior:</p>
<div class="highlight"><pre><span></span><code><span class="p">&lt;</span><span class="nt">a</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;button&quot;</span> <span class="na">v-if</span><span class="o">=</span><span class="s">&quot;!user&quot;</span> <span class="err">@</span><span class="na">click</span><span class="o">=</span><span class="s">&quot;isRegisterActive=true&quot;</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">strong</span><span class="p">&gt;</span>Registro<span class="p">&lt;/</span><span class="nt">strong</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;</span>
</code></pre></div>
<p>Al completar el formulario llamaremos al método register():</p>
<div class="highlight"><pre><span></span><code><span class="nx">register</span><span class="p">()</span> <span class="p">{</span>
 <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">$axios</span><span class="p">.</span><span class="nx">post</span><span class="p">(</span><span class="s1">&#39;/auth/registration/&#39;</span><span class="p">,</span> <span class="p">{</span>
   <span class="nx">email</span><span class="o">:</span> <span class="k">this</span><span class="p">.</span><span class="nx">registerEmail</span><span class="p">,</span>
   <span class="nx">password1</span><span class="o">:</span> <span class="k">this</span><span class="p">.</span><span class="nx">registerPassword1</span><span class="p">,</span>
   <span class="nx">password2</span><span class="o">:</span> <span class="k">this</span><span class="p">.</span><span class="nx">registerPassword2</span>
 <span class="p">})</span>
 <span class="p">.</span><span class="nx">then</span><span class="p">((</span><span class="nx">res</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
   <span class="k">if</span> <span class="p">(</span><span class="nx">res</span><span class="p">.</span><span class="nx">data</span><span class="p">.</span><span class="nx">key</span><span class="p">){</span>
     <span class="k">this</span><span class="p">.</span><span class="nx">$store</span><span class="p">.</span><span class="nx">commit</span><span class="p">(</span><span class="s1">&#39;saveToken&#39;</span><span class="p">,</span> <span class="nx">res</span><span class="p">.</span><span class="nx">data</span><span class="p">.</span><span class="nx">key</span><span class="p">)</span>
     <span class="k">this</span><span class="p">.</span><span class="nx">$store</span><span class="p">.</span><span class="nx">commit</span><span class="p">(</span><span class="s1">&#39;saveUser&#39;</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">registerEmail</span><span class="p">.</span><span class="nx">split</span><span class="p">(</span><span class="s2">&quot;@&quot;</span><span class="p">)[</span><span class="mf">0</span><span class="p">])</span>
     <span class="c1">// Reiniciamos los campos</span>
     <span class="k">this</span><span class="p">.</span><span class="nx">registerEmail</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
     <span class="k">this</span><span class="p">.</span><span class="nx">registerPassword1</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
     <span class="k">this</span><span class="p">.</span><span class="nx">registerPassword2</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
     <span class="c1">// Escondemos la modal</span>
     <span class="k">this</span><span class="p">.</span><span class="nx">isRegisterActive</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
   <span class="p">}</span>
 <span class="p">})</span>
 <span class="p">.</span><span class="k">catch</span><span class="p">((</span><span class="nx">error</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
   <span class="nx">alert</span><span class="p">(</span><span class="nb">Object</span><span class="p">.</span><span class="nx">values</span><span class="p">(</span><span class="nx">error</span><span class="p">.</span><span class="nx">response</span><span class="p">.</span><span class="nx">data</span><span class="p">))</span>
 <span class="p">})</span>
<span class="p">},</span>
</code></pre></div>
<p>Con esto ya debería funcionar el formulario y cuando el usuario se registre accederá automáticamente al establecerse su token y usuario en el store.</p>
<p>En caso de que algo no funcione, como estamos mostrando los fallos que nos devuelve la API podremos verlo en un alert, cuyo idioma nos aparecerán automáticamente en el que tenga configurado Django, ¡es genial!</p>
<h2 id="pagina-de-peliculas-favoritas">Página de películas favoritas<a class="headerlink" href="#pagina-de-peliculas-favoritas" title="Permanent link">&para;</a></h2>
<p>Antes de nada, la sección de películas favoritas debería aparecer únicamente si el usuario está autenticado, así que en lugar de generar el menú dinámicamente vamos a hacerlo a mano comprobando esa posibilidad:</p>
<p><code>pages/favoritas.vue</code>
<div class="highlight"><pre><span></span><code><span class="p">&lt;</span><span class="nt">ul</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;menu-list&quot;</span><span class="p">&gt;</span>
  <span class="p">&lt;</span><span class="nt">li</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">nuxt-link</span> <span class="na">to</span><span class="o">=</span><span class="s">&quot;/pelis&quot;</span> <span class="na">exact-active-class</span><span class="o">=</span><span class="s">&quot;is-active&quot;</span><span class="p">&gt;</span>
      <span class="p">&lt;</span><span class="nt">b-icon</span> <span class="na">icon</span><span class="o">=</span><span class="s">&quot;video&quot;</span><span class="p">/&gt;</span>
      Películas
    <span class="p">&lt;/</span><span class="nt">nuxt-link</span><span class="p">&gt;</span>
  <span class="p">&lt;/</span><span class="nt">li</span><span class="p">&gt;</span>
  <span class="p">&lt;</span><span class="nt">li</span> <span class="na">v-if</span><span class="o">=</span><span class="s">&quot;user&quot;</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">nuxt-link</span> <span class="na">to</span><span class="o">=</span><span class="s">&quot;/favoritas&quot;</span> <span class="na">exact-active-class</span><span class="o">=</span><span class="s">&quot;is-active&quot;</span><span class="p">&gt;</span>
      <span class="p">&lt;</span><span class="nt">b-icon</span> <span class="na">icon</span><span class="o">=</span><span class="s">&quot;star&quot;</span><span class="p">/&gt;</span>
      Favoritas
    <span class="p">&lt;/</span><span class="nt">nuxt-link</span><span class="p">&gt;</span>
  <span class="p">&lt;/</span><span class="nt">li</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">ul</span><span class="p">&gt;</span>
</code></pre></div></p>
<p>Otra opción importante es que no se pueda visitar esta página si  no estamos autenticados. </p>
<p>Para manejar la situación usaremos el fetch, un método que se ejecuta antes de montar la página y que está indicado para gestionar el store. En él podemos comprobar si hay un usuario y si no redireccionar a otra página:</p>
<div class="highlight"><pre><span></span><code><span class="nx">fetch</span> <span class="p">({</span> <span class="nx">store</span><span class="p">,</span> <span class="nx">redirect</span> <span class="p">})</span> <span class="p">{</span>
  <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">store</span><span class="p">.</span><span class="nx">state</span><span class="p">.</span><span class="nx">user</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">redirect</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">)</span>
  <span class="p">}</span>
<span class="p">},</span>
</code></pre></div>
<p>Si intentamos visitar <em>/favoritas</em> sin iniciar sesión seremos redirigidos automáticamente a la portada.</p>
<p>Por supuesto también tenemos que tener en cuenta que al cerrar la sesión se redireccione a la portada, así que modificaremos el logout() para hacerlo, esta vez usando el módulo <em>$router</em> de Nuxt.js:</p>
<p><code>layouts/default.vue</code>
<div class="highlight"><pre><span></span><code><span class="nx">logout</span><span class="p">()</span> <span class="p">{</span>
  <span class="p">...</span>
  <span class="c1">// Redireccionamos a la portada al salir</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">$router</span><span class="p">.</span><span class="nx">replace</span><span class="p">({</span> <span class="nx">path</span><span class="o">:</span> <span class="s1">&#39;/&#39;</span> <span class="p">})</span>
<span class="p">}</span>
</code></pre></div></p>
<p>El siguiente paso será recuperar las pelis favoritas del usuario al cargar la página, para ello necesitaremos consultar la API pasando el token de autenticación:</p>
<p><code>pages/favoritas.vue</code>
<div class="highlight"><pre><span></span><code><span class="nx">asyncData</span> <span class="p">({</span> <span class="nx">store</span><span class="p">,</span> <span class="nx">$axios</span> <span class="p">})</span> <span class="p">{</span>
  <span class="k">if</span> <span class="p">(</span><span class="nx">store</span><span class="p">.</span><span class="nx">state</span><span class="p">.</span><span class="nx">token</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">$axios</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;/favoritas/&#39;</span><span class="p">,</span> <span class="p">{</span>
      <span class="nx">headers</span><span class="o">:</span> <span class="p">{</span>
        <span class="s1">&#39;Authorization&#39;</span><span class="o">:</span> <span class="sb">`Token </span><span class="si">${</span><span class="nx">store</span><span class="p">.</span><span class="nx">state</span><span class="p">.</span><span class="nx">token</span><span class="si">}</span><span class="sb">`</span>
      <span class="p">}</span>
    <span class="p">})</span>
    <span class="p">.</span><span class="nx">then</span><span class="p">((</span><span class="nx">res</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
      <span class="k">return</span> <span class="p">{</span>
        <span class="s1">&#39;favoritas&#39;</span><span class="o">:</span> <span class="nx">res</span><span class="p">.</span><span class="nx">data</span>
      <span class="p">}</span>
    <span class="p">})</span>
  <span class="p">}</span>
<span class="p">},</span>
</code></pre></div></p>
<p>Si inspeccionamos las peticiones veremos si se está llamando correctamente a la API.</p>
<p>Sólo tenemos que copiar literalmente la visualización de películas de la portada a esta página y debería funcionar:</p>
<div class="highlight"><pre><span></span><code><span class="p">&lt;</span><span class="nt">template</span><span class="p">&gt;</span>
 <span class="p">&lt;</span><span class="nt">section</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;section&quot;</span><span class="p">&gt;</span>
   <span class="p">&lt;</span><span class="nt">h2</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;title&quot;</span><span class="p">&gt;</span>Favoritas<span class="p">&lt;/</span><span class="nt">h2</span><span class="p">&gt;</span>
   <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;columns is-multiline&quot;</span><span class="p">&gt;</span>
     <span class="p">&lt;</span><span class="nt">Peli</span>
       <span class="na">v-for</span><span class="o">=</span><span class="s">&quot;favorita in favoritas&quot;</span>
       <span class="na">:key</span><span class="o">=</span><span class="s">&quot;favorita.pelicula.id&quot;</span>
       <span class="na">:peli</span><span class="o">=</span><span class="s">&quot;favorita.pelicula&quot;</span>
     <span class="p">/&gt;</span>
   <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
 <span class="p">&lt;/</span><span class="nt">section</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">template</span><span class="p">&gt;</span>
</code></pre></div>
<p>Lo mejor de todo es que podemos editar el componente Card para modificar la estructura de todas las películas de la web, tanto de la portada como las de nuestro perfil.</p>
<p>Por cierto, un detalle muy útil sería redireccionar al usuario a sus pelis favoritas cuando se identifique, es fácil usando el módulo <em>$router</em> de Nuxt.js: </p>
<p><code>layouts/default.vue</code>
<div class="highlight"><pre><span></span><code><span class="p">.</span><span class="nx">then</span><span class="p">((</span><span class="nx">res</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
  <span class="k">if</span> <span class="p">(</span><span class="nx">res</span><span class="p">.</span><span class="nx">data</span><span class="p">.</span><span class="nx">key</span><span class="p">){</span>
    <span class="p">...</span>
    <span class="c1">// Redireccionamos a las pelis favoritas</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">$router</span><span class="p">.</span><span class="nx">replace</span><span class="p">({</span> <span class="nx">path</span><span class="o">:</span> <span class="s1">&#39;/favoritas&#39;</span> <span class="p">})</span>
  <span class="p">}</span>
<span class="p">})</span>
</code></pre></div></p>
<h2 id="manejando-las-favoritas-en-el-store">Manejando las favoritas en el store<a class="headerlink" href="#manejando-las-favoritas-en-el-store" title="Permanent link">&para;</a></h2>
<p>Vamos a hacer que el usuario pueda marcar y desmarcar películas como favoritas, sin embargo antes necesitamos controlar en todo momento las películas que ya son favoritas, por ejemplo teniendo la lista en el store.</p>
<p>No necesitamos guardar toda la información, nos bastaría con un array que contenga sólo los id:</p>
<p><code>store/index.js</code>
<div class="highlight"><pre><span></span><code><span class="k">export</span> <span class="kd">const</span> <span class="nx">state</span> <span class="o">=</span> <span class="p">()</span> <span class="p">=&gt;</span> <span class="p">({</span>
  <span class="p">...</span>
  <span class="nx">favIds</span><span class="o">:</span> <span class="p">[]</span>
<span class="p">})</span>
</code></pre></div></p>
<p>Para manejarlo podemos crear una mutación llamada <em>toggleFavorite</em> que añada o borre un id a la lista:</p>
<div class="highlight"><pre><span></span><code><span class="nx">toggleFavorite</span><span class="p">(</span><span class="nx">state</span><span class="p">,</span> <span class="nx">id</span><span class="p">){</span>
  <span class="kd">var</span> <span class="nx">index</span> <span class="o">=</span> <span class="nx">state</span><span class="p">.</span><span class="nx">favIds</span><span class="p">.</span><span class="nx">indexOf</span><span class="p">(</span><span class="nx">id</span><span class="p">)</span>
  <span class="k">if</span> <span class="p">(</span><span class="nx">index</span> <span class="o">!==</span> <span class="o">-</span><span class="mf">1</span><span class="p">)</span> <span class="nx">state</span><span class="p">.</span><span class="nx">favIds</span><span class="p">.</span><span class="nx">splice</span><span class="p">(</span><span class="nx">index</span><span class="p">,</span> <span class="mf">1</span><span class="p">)</span>
  <span class="k">else</span> <span class="nx">state</span><span class="p">.</span><span class="nx">favIds</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">id</span><span class="p">)</span>
<span class="p">}</span>
</code></pre></div>
<p>El momento perfecto para añadirlas en el store es al acceder al visitar la página de pelis favoritas, pero sólo si el arregla está vacío será necesario agregarlas:</p>
<p><code>pages/favoritas.js</code>
<div class="highlight"><pre><span></span><code><span class="p">.</span><span class="nx">then</span><span class="p">((</span><span class="nx">res</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
  <span class="c1">// Añadimos los ids de las pelis favoritas al store</span>
  <span class="k">if</span> <span class="p">(</span><span class="nx">store</span><span class="p">.</span><span class="nx">state</span><span class="p">.</span><span class="nx">favIds</span><span class="p">.</span><span class="nx">length</span> <span class="o">==</span> <span class="mf">0</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">res</span><span class="p">.</span><span class="nx">data</span><span class="p">.</span><span class="nx">forEach</span><span class="p">((</span><span class="nx">fav</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
      <span class="nx">store</span><span class="p">.</span><span class="nx">commit</span><span class="p">(</span><span class="s1">&#39;toggleFavorite&#39;</span><span class="p">,</span> <span class="nx">fav</span><span class="p">.</span><span class="nx">pelicula</span><span class="p">.</span><span class="nx">id</span><span class="p">)</span>
    <span class="p">});</span>
  <span class="p">}</span>
  <span class="k">return</span> <span class="p">{</span>
    <span class="s1">&#39;favoritas&#39;</span><span class="o">:</span> <span class="nx">res</span><span class="p">.</span><span class="nx">data</span>
  <span class="p">}</span>
<span class="p">})</span>
</code></pre></div></p>
<p>Comprobando el store con la extensión de Vue podemos ver cómo se ejecuta un commit cada vez que se añade una peli a favoritos.</p>
<p>Con esto ya podemos controlar los cambios en la memoria de la aplicación, no nos costaría mucho añadir una clase activa al botón si la peli actual forma parte de la lista en el store:</p>
<p><code>components/Peli.vue</code>
<div class="highlight"><pre><span></span><code><span class="p">&lt;</span><span class="nt">a</span> 
  <span class="na">class</span><span class="o">=</span><span class="s">&quot;button is-light card-footer-item&quot;</span>
  <span class="na">:class</span><span class="o">=</span><span class="s">&quot;{ &#39;is-primary&#39;: </span>
<span class="s">            this.$store.state.favIds.indexOf(peli.id) !== -1 }&quot;</span>
<span class="p">&gt;</span>
</code></pre></div></p>
<p>Como estamos trabajando con componentes esto nos funcionará tanto en la portada como en la sección películas.</p>
<h2 id="anadiendo-el-boton-de-accion">Añadiendo el botón de acción<a class="headerlink" href="#anadiendo-el-boton-de-accion" title="Permanent link">&para;</a></h2>
<p>Vamos a hacer que funcione ese botón para manejar las películas favoritas.</p>
<p>Lo primero será crear un método para manejar la petición autenticada y establecer o borrar el favorito:</p>
<p><code>components/Peli.vue</code>
<div class="highlight"><pre><span></span><code><span class="nx">methods</span><span class="o">:</span> <span class="p">{</span>
  <span class="nx">toggleFavorite</span><span class="p">()</span> <span class="p">{</span>
    <span class="c1">// Si estamos identificados... que lo deberíamos</span>
    <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">$store</span><span class="p">.</span><span class="nx">state</span><span class="p">.</span><span class="nx">token</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">$axios</span>
        <span class="p">.</span><span class="nx">post</span><span class="p">(</span>
          <span class="s2">&quot;/favorita/&quot;</span><span class="p">,</span>
          <span class="p">{</span> <span class="nx">id</span><span class="o">:</span> <span class="k">this</span><span class="p">.</span><span class="nx">peli</span><span class="p">.</span><span class="nx">id</span> <span class="p">},</span>
          <span class="p">{</span>
            <span class="nx">headers</span><span class="o">:</span> <span class="p">{</span>
              <span class="nx">Authorization</span><span class="o">:</span> <span class="sb">`Token </span><span class="si">${</span><span class="k">this</span><span class="p">.</span><span class="nx">$store</span><span class="p">.</span><span class="nx">state</span><span class="p">.</span><span class="nx">token</span><span class="si">}</span><span class="sb">`</span>
            <span class="p">}</span>
          <span class="p">}</span>
        <span class="p">)</span>
        <span class="p">.</span><span class="nx">then</span><span class="p">(</span><span class="nx">res</span> <span class="p">=&gt;</span> <span class="p">{</span>
          <span class="k">if</span> <span class="p">(</span><span class="nx">res</span><span class="p">.</span><span class="nx">data</span><span class="p">.</span><span class="nx">id</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">this</span><span class="p">.</span><span class="nx">$store</span><span class="p">.</span><span class="nx">commit</span><span class="p">(</span><span class="s2">&quot;toggleFavorite&quot;</span><span class="p">,</span> <span class="nx">res</span><span class="p">.</span><span class="nx">data</span><span class="p">.</span><span class="nx">id</span><span class="p">);</span>
          <span class="p">}</span>
        <span class="p">})</span>
        <span class="p">.</span><span class="k">catch</span><span class="p">(</span><span class="nx">error</span> <span class="p">=&gt;</span> <span class="p">{</span>
          <span class="nx">alert</span><span class="p">(</span><span class="nb">Object</span><span class="p">.</span><span class="nx">values</span><span class="p">(</span><span class="nx">error</span><span class="p">.</span><span class="nx">response</span><span class="p">.</span><span class="nx">data</span><span class="p">));</span>
        <span class="p">});</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
      <span class="nx">alert</span><span class="p">(</span><span class="s2">&quot;Necesitas identificarte para marcar pelis favoritas&quot;</span><span class="p">);</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></p>
<div class="highlight"><pre><span></span><code><span class="p">&lt;</span><span class="nt">a</span>
  <span class="na">class</span><span class="o">=</span><span class="s">&quot;button is-light card-footer-item&quot;</span>
  <span class="na">:class</span><span class="o">=</span><span class="s">&quot;{ &#39;is-primary&#39;: </span>
<span class="s">            this.$store.state.favIds.indexOf(peli.id) !== -1} &quot;</span>
  <span class="err">@</span><span class="na">click</span><span class="o">=</span><span class="s">&quot;toggleFavorite&quot;</span>
<span class="p">&gt;</span>
</code></pre></div>
<p>Sólo nos faltaría sumar o restar al número de favoritos dependiendo del resultado:</p>
<div class="highlight"><pre><span></span><code><span class="p">.</span><span class="nx">then</span><span class="p">(</span><span class="nx">res</span> <span class="p">=&gt;</span> <span class="p">{</span>
  <span class="k">if</span> <span class="p">(</span><span class="nx">res</span><span class="p">.</span><span class="nx">data</span><span class="p">.</span><span class="nx">id</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">$store</span><span class="p">.</span><span class="nx">commit</span><span class="p">(</span><span class="s2">&quot;toggleFavorite&quot;</span><span class="p">,</span> <span class="nx">res</span><span class="p">.</span><span class="nx">data</span><span class="p">.</span><span class="nx">id</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">res</span><span class="p">.</span><span class="nx">data</span><span class="p">.</span><span class="nx">favorita</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">peli</span><span class="p">.</span><span class="nx">favoritos</span> <span class="o">+=</span> <span class="mf">1</span><span class="p">;</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">peli</span><span class="p">.</span><span class="nx">favoritos</span> <span class="o">-=</span> <span class="mf">1</span><span class="p">;</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">})</span>
</code></pre></div>
<p>Como podéis observar trabajar con componentes nos ahorra mucho trabajo.</p>
<h2 id="implementando-un-plugin-de-alertas">Implementando un plugin de alertas<a class="headerlink" href="#implementando-un-plugin-de-alertas" title="Permanent link">&para;</a></h2>
<p>La aplicación ya está funcionando perfectamente, pero hay un detalle que podemos perfeccionar, me refiero a esos alerts() que hemos puesto.</p>
<p>Los alerts son como ventanas emergentes que bloquean la ejecución del código. </p>
<p>Vamos a usar una librería llamada <a href="https://github.com/CodeSeven/toastr">Toastr</a> para sustituirlos y crear un efecto non-blocking mucho más interesante y elegante.</p>
<p>Pero  no vamos a utilizarla desde CDN, aprovecharemos que Vue tiene una versión llamada <a href="https://www.npmjs.com/package/vue-toasted">vue-toaster</a> que podemos instalar de la siguiente forma:</p>
<div class="highlight"><pre><span></span><code>npm install vue-toasted --save
</code></pre></div>
<p>Ahora vamos a crear un plugin para poder utilizarlo en nuestra app:</p>
<p><code>plugins/toast.js</code>
<div class="highlight"><pre><span></span><code><span class="k">import</span> <span class="nx">Vue</span> <span class="nx">from</span> <span class="s1">&#39;vue&#39;</span>
<span class="k">import</span> <span class="nx">Toasted</span> <span class="nx">from</span> <span class="s1">&#39;vue-toasted&#39;</span><span class="p">;</span>

<span class="kd">var</span> <span class="nx">options</span> <span class="o">=</span> <span class="p">{</span>
  <span class="nx">position</span><span class="o">:</span> <span class="s1">&#39;top-center&#39;</span><span class="p">,</span>
  <span class="nx">duration</span><span class="o">:</span> <span class="mf">4000</span><span class="p">,</span>  <span class="c1">// milisegundos de vida</span>
<span class="p">}</span>

<span class="nx">Vue</span><span class="p">.</span><span class="nx">use</span><span class="p">(</span><span class="nx">Toasted</span><span class="p">,</span> <span class="nx">options</span><span class="p">)</span>
</code></pre></div></p>
<p>Para activar el plugin, y dado que sólo funcionará en el lado del cliente lo haremos así en:</p>
<p><code>nuxt.config.js</code>
<div class="highlight"><pre><span></span><code><span class="nx">plugins</span><span class="o">:</span> <span class="p">[</span>
  <span class="p">{</span> <span class="nx">src</span><span class="o">:</span> <span class="s1">&#39;~/plugins/toast&#39;</span><span class="p">,</span> <span class="nx">ssr</span><span class="o">:</span> <span class="kc">false</span><span class="p">},</span>
<span class="p">],</span>
</code></pre></div></p>
<p>Ahora sólo tenemos que hacer uso de la librería sustituyendo los alerts de los errores, por ejemplo del registro y el login:</p>
<p><code>layouts/default.vue</code>
<div class="highlight"><pre><span></span><code><span class="c1">// alert(Object.values(error.response.data))</span>
<span class="k">this</span><span class="p">.</span><span class="nx">$toasted</span><span class="p">.</span><span class="nx">error</span><span class="p">(</span><span class="nb">Object</span><span class="p">.</span><span class="nx">values</span><span class="p">(</span><span class="nx">error</span><span class="p">.</span><span class="nx">response</span><span class="p">.</span><span class="nx">data</span><span class="p">))</span>
</code></pre></div></p>
<p>El resultado es simplemente genial.</p>
<p>Hay varias opciones, para mostrar mensajes satisfactorios, errores y más, echad una ojeada a la <a href="https://github.com/shakee93/vue-toasted#usage">documentación de vue-toasted</a> para aprender más.</p>
<hr />
<p><small class="edited"><i>Última edición: 17 de Marzo de 2021</i></small></p>
                
                  
                
              
              
                


              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
  <div class="md-footer-nav">
    <nav class="md-footer-nav__inner md-grid">
      
      <a
        href="../chat-heroku/"
        title="Proyecto chat online"
        class="md-flex md-footer-nav__link md-footer-nav__link--prev"
        rel="prev"
      >
        <div class="md-flex__cell md-flex__cell--shrink">
          <i class="md-icon md-icon--arrow-back md-footer-nav__button"></i>
        </div>
        <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
          <span class="md-flex__ellipsis">
            <span class="md-footer-nav__direction">
              Anterior
            </span>
            Proyecto chat online
          </span>
        </div>
      </a>
       
      <a
        href="../../gnu-linux/ubuntu-server-web/"
        title="Configurar Ubuntu Server"
        class="md-flex md-footer-nav__link md-footer-nav__link--next"
        rel="next"
      >
        <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
          <span class="md-flex__ellipsis">
            <span class="md-footer-nav__direction">
              Siguiente
            </span>
            Configurar Ubuntu Server
          </span>
        </div>
        <div class="md-flex__cell md-flex__cell--shrink">
          <i class="md-icon md-icon--arrow-forward md-footer-nav__button"></i>
        </div>
      </a>
      
    </nav>
  </div>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        <!--<div class="md-footer-links__highlight">
          <a href="/comunidad/">Comunidad</a> · <a href="/politica-de-cookies/">Política de cookies</a> · <a href="/sobre-mi/">Sobre mí</a>
        </div>-->
        <div class="md-footer-copyright__highlight">
          2015 - 2021 &copy; Héctor Costa Guzmán (<u
            ><a
              href="https://creativecommons.org/licenses/by/4.0/deed.es"
              target="_blank"
              rel="nofollow"
              >Licencia CC BY 4.0</a
            ></u
          >)
        </div>
      </div>
       
<style>.md-footer-social__link {transition: 0.3s;}</style>
<div class="md-footer-social" style="font-size: 2.5rem; margin-top: -6px!important; padding: 0px!important; margin-bottom: -6px; overflow: hidden!important;">
  <a href="https://github.com/hcosta" title="Github" target="_blank" class="md-footer-social__link fa fa-github-square"></a>
  <a href="https://www.youtube.com/c/HektorProfe" title="Youtube" target="_blank" class="md-footer-social__link fa fa-youtube-square"></a>
  &nbsp;
</div>
 
    </div>
  </div>
  <script>
    (function (i, s, o, g, r, a, m) {
      i["GoogleAnalyticsObject"] = r;
      (i[r] =
        i[r] ||
        function () {
          (i[r].q = i[r].q || []).push(arguments);
        }),
        (i[r].l = 1 * new Date());
      (a = s.createElement(o)), (m = s.getElementsByTagName(o)[0]);
      a.async = 1;
      a.src = g;
      m.parentNode.insertBefore(a, m);
    })(
      window,
      document,
      "script",
      "https://www.google-analytics.com/analytics.js",
      "ga"
    );
    ga("create", "UA-124845547-1", "auto");
    ga("send", "pageview");
  </script>
</footer>
      
      <a id="anchorID" href="https://www.hektorprofe.net/" target="_blank"></a>
    </div>
  <script type='text/javascript' src="/assets/javascripts/application.a26c1c21.js"></script>
  <script src="/assets/javascripts/tingle.min.js"></script>
  <script type='text/javascript'>
    var modalButtonOnly = new tingle.modal({
        closeMethods: [],
        footer: true,
        stickyFooter: true
    });
    var btn5 = document.querySelector('.js-tingle-modal-5');

    // set content
    modalButtonOnly.setContent(`
    <div style="display:grid;grid-template-columns:32% 32% 32%;grid-column-gap: 1.33%;" id="supermodal">
      <div class="course">
        <a href="https://www.udemy.com/course/python-3-al-completo-desde-cero/?couponCode=2522EB41FF2C2033D661" target="_blank"><img src="/cdn/assets/python.png" style="width:100%;justify-self:center;align-self:center;"/></a>
      </div>
      <div class="course">
        <a href="https://www.udemy.com/course/curso-django-2-practico-desarrollo-web-python-3/?couponCode=E17DBAD5E52D963F824D" target="_blank"><img src="/cdn/assets/django.png" style="width:100%;justify-self:center;align-self:center;"/></a>
      </div>
      <div class="course">
        <a href="https://www.udemy.com/course/python-desarrollo-interfaces-graficas-qt-pyside/?couponCode=7C3871B53669F4129BE9" target="_blank"><img src="/cdn/assets/pyside.png" style="width:100%;justify-self:center;align-self:center;"/></a>
      </div>
    </div>`);

    modalButtonOnly.addFooterBtn('Cerrar', 'tingle-btn tingle-btn--default tingle-btn--pull-right', function(){
      modalButtonOnly.close();
    });

    app.initialize({version:"1.1.2",url:{base:"../../.."}})
    var _extends=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var o in n)Object.prototype.hasOwnProperty.call(n,o)&&(t[o]=n[o])}return t},_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t};!function(t,e){"object"===("undefined"==typeof exports?"undefined":_typeof(exports))&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):t.LazyLoad=e()}(this,function(){"use strict";function t(t,e,n){var o=e._settings;!n&&i(t)||(C(o.callback_enter,t),R.indexOf(t.tagName)>-1&&(N(t,e),I(t,o.class_loading)),E(t,e),a(t),C(o.callback_set,t))}var e={elements_selector:"img",container:document,threshold:300,thresholds:null,data_src:"src",data_srcset:"srcset",data_sizes:"sizes",data_bg:"bg",class_loading:"loading",class_loaded:"loaded",class_error:"error",load_delay:0,callback_load:null,callback_error:null,callback_set:null,callback_enter:null,callback_finish:null,to_webp:!1},n=function(t){return _extends({},e,t)},o=function(t,e){return t.getAttribute("data-"+e)},r=function(t,e,n){var o="data-"+e;null!==n?t.setAttribute(o,n):t.removeAttribute(o)},a=function(t){return r(t,"was-processed","true")},i=function(t){return"true"===o(t,"was-processed")},s=function(t,e){return r(t,"ll-timeout",e)},c=function(t){return o(t,"ll-timeout")},l=function(t){return t.filter(function(t){return!i(t)})},u=function(t,e){return t.filter(function(t){return t!==e})},d=function(t,e){var n,o=new t(e);try{n=new CustomEvent("LazyLoad::Initialized",{detail:{instance:o}})}catch(t){(n=document.createEvent("CustomEvent")).initCustomEvent("LazyLoad::Initialized",!1,!1,{instance:o})}window.dispatchEvent(n)},f=function(t,e){return e?t.replace(/\.(jpe?g|png)/gi,".webp"):t},_="undefined"!=typeof window,v=_&&!("onscroll"in window)||/(gle|ing|ro)bot|crawl|spider/i.test(navigator.userAgent),g=_&&"IntersectionObserver"in window,h=_&&"classList"in document.createElement("p"),b=_&&function(){var t=document.createElement("canvas");return!(!t.getContext||!t.getContext("2d"))&&0===t.toDataURL("image/webp").indexOf("data:image/webp")}(),m=function(t,e,n,r){for(var a,i=0;a=t.children[i];i+=1)if("SOURCE"===a.tagName){var s=o(a,n);p(a,e,s,r)}},p=function(t,e,n,o){n&&t.setAttribute(e,f(n,o))},y=function(t,e){var n=b&&e.to_webp,r=o(t,e.data_src),a=o(t,e.data_bg);if(r){var i=f(r,n);t.style.backgroundImage='url("'+i+'")'}if(a){var s=f(a,n);t.style.backgroundImage=s}},w={IMG:function(t,e){var n=b&&e.to_webp,r=e.data_srcset,a=t.parentNode;a&&"PICTURE"===a.tagName&&m(a,"srcset",r,n);var i=o(t,e.data_sizes);p(t,"sizes",i);var s=o(t,r);p(t,"srcset",s,n);var c=o(t,e.data_src);p(t,"src",c,n)},IFRAME:function(t,e){var n=o(t,e.data_src);p(t,"src",n)},VIDEO:function(t,e){var n=e.data_src,r=o(t,n);m(t,"src",n),p(t,"src",r),t.load()}},E=function(t,e){var n=e._settings,o=t.tagName,r=w[o];if(r)return r(t,n),e._updateLoadingCount(1),void(e._elements=u(e._elements,t));y(t,n)},I=function(t,e){h?t.classList.add(e):t.className+=(t.className?" ":"")+e},L=function(t,e){h?t.classList.remove(e):t.className=t.className.replace(new RegExp("(^|\\s+)"+e+"(\\s+|$)")," ").replace(/^\s+/,"").replace(/\s+$/,"")},C=function(t,e){t&&t(e)},O=function(t,e,n){t.addEventListener(e,n)},k=function(t,e,n){t.removeEventListener(e,n)},x=function(t,e,n){O(t,"load",e),O(t,"loadeddata",e),O(t,"error",n)},A=function(t,e,n){k(t,"load",e),k(t,"loadeddata",e),k(t,"error",n)},z=function(t,e,n){var o=n._settings,r=e?o.class_loaded:o.class_error,a=e?o.callback_load:o.callback_error,i=t.target;L(i,o.class_loading),I(i,r),C(a,i),n._updateLoadingCount(-1)},N=function(t,e){var n=function n(r){z(r,!0,e),A(t,n,o)},o=function o(r){z(r,!1,e),A(t,n,o)};x(t,n,o)},R=["IMG","IFRAME","VIDEO"],S=function(e,n,o){t(e,o),n.unobserve(e)},M=function(t){var e=c(t);e&&(clearTimeout(e),s(t,null))},j=function(t,e,n){var o=n._settings.load_delay,r=c(t);r||(r=setTimeout(function(){S(t,e,n),M(t)},o),s(t,r))},D=function(t){return t.isIntersecting||t.intersectionRatio>0},T=function(t){return{root:t.container===document?null:t.container,rootMargin:t.thresholds||t.threshold+"px"}},U=function(t,e){this._settings=n(t),this._setObserver(),this._loadingCount=0,this.update(e)};return U.prototype={_manageIntersection:function(t){var e=this._observer,n=this._settings.load_delay,o=t.target;n?D(t)?j(o,e,this):M(o):D(t)&&S(o,e,this)},_onIntersection:function(t){t.forEach(this._manageIntersection.bind(this))},_setObserver:function(){g&&(this._observer=new IntersectionObserver(this._onIntersection.bind(this),T(this._settings)))},_updateLoadingCount:function(t){this._loadingCount+=t,0===this._elements.length&&0===this._loadingCount&&C(this._settings.callback_finish)},update:function(t){var e=this,n=this._settings,o=t||n.container.querySelectorAll(n.elements_selector);this._elements=l(Array.prototype.slice.call(o)),!v&&this._observer?this._elements.forEach(function(t){e._observer.observe(t)}):this.loadAll()},destroy:function(){var t=this;this._observer&&(this._elements.forEach(function(e){t._observer.unobserve(e)}),this._observer=null),this._elements=null,this._settings=null},load:function(e,n){t(e,this,n)},loadAll:function(){var t=this;this._elements.forEach(function(e){t.load(e)})}},_&&function(t,e){if(e)if(e.length)for(var n,o=0;n=e[o];o+=1)d(t,n);else d(t,e)}(U,window.lazyLoadOptions),U});
    var myLazyLoad = new LazyLoad({elements_selector: ".lazy"});
    const mdMenuItems = document.querySelectorAll('.md-nav__link');
    function doNav(){ document.getElementById("main__list").innerHTML = '<li class="md-nav__item"><a class="md-nav__link" href="/cursos/">Cursos</a></li><li class="md-nav__item"><a class="md-nav__link" href="/blog/">Blog</a></li>';}
    for (i = 0; i < mdMenuItems.length; i++) {  var item = mdMenuItems[i]; var htmlstring = item.innerHTML; htmlstring = (htmlstring.trim) ? htmlstring.trim() : htmlstring.replace(/^\s+/,''); if (htmlstring == 'Servidor de encuentro') { item.parentNode.removeChild(item);continue; }  if (htmlstring == 'Política de Cookies') { item.parentNode.removeChild(item);continue; } if (htmlstring == 'Buscador') { item.parentNode.removeChild(item); continue; } }
    try { var topPos = document.querySelector('#md__active_link').offsetTop; document.querySelector('#md__sidebar__scroll').scrollTop = topPos - 60; } catch (err) {}
  </script>
  </body>
</html>